/**
 * 评价区
 * @param {Object} $M => mui
 * @param {Object} $  => zepto
 * @name  zqyou
 * @date  2017-02-04
 * @return {Object}
 */
(function($M, $) {

    var evaluate = {
        charts: function(data) {
            var total = (data.oneStarCount + data.twoStarCount + data.threeStarCount + data.fourStarCount + data.fiveStarCount) || 1,
                arr_data = [{ name: '一星', value: data.oneStarCount / total },
                    { name: '二星', value: data.twoStarCount / total },
                    { name: '三星', value: data.threeStarCount / total },
                    { name: '四星', value: data.fourStarCount / total },
                    { name: '五星', value: data.fiveStarCount / total }
                ];
            var chart = echarts.init(document.getElementById('chart'));
            var option = {
                title: {
                    text: '',
                    subtext: '',
                    x: 'center'
                },
                color: ['#1bad86', '#35e968', '#375ed1', '#e157eb', 'fdea37'],
                tooltip: {
                    trigger: 'item',
                    formatter: "{a} <br/>{b} : {c} ({d}%)"
                },
                legend: {
                    orient: 'vertical',
                    left: 'right',
                    top: 'middle',
                    align: 'left',
                    selectedMode: false,
                    formatter: function(name) {
                        var str = 0;
                        $.each(arr_data, function(i, v) {
                            if (v.name == name) {
                                str = (v.value * 100).toFixed(2);
                            }
                        });
                        return name + str + '%';
                    },
                    data: arr_data
                },
                series: [{
                    name: '',
                    type: 'pie',
                    radius: '55%',
                    center: ['40%', '40%'],
                    selectedMode: "normal",
                    label: {
                        normal: {
                            show: false,
                            position: 'outside'
                        }
                    },
                    data: [
                        { value: data.oneStarCount, name: '一星' },
                        { value: data.twoStarCount, name: '二星' },
                        { value: data.threeStarCount, name: '三星' },
                        { value: data.fourStarCount, name: '四星' },
                        { value: data.fiveStarCount, name: '五星' }
                    ],
                    itemStyle: {
                        emphasis: {
                            shadowBlur: 10,
                            shadowOffsetX: 0,
                            shadowColor: 'rgba(0, 0, 0, 0.5)'
                        }
                    }
                }]
            };


            chart.setOption(option);
            return this;
        },
        load: function() {
            var message = { "method": "load" };
            window.webkit.messageHandlers.interOp.postMessage(message);
            return this;
        },
        /**
         * 扩展辅助方法
         * @return {this}
         */
        helper: function() {
            //对字符串进行编码
            template.config('escape', false);
            return this;
        },
        /**
         * 载入
         * @return {null}
         */
        init: function() {
            this.helper().load();
        }
    };
    evaluate.init();
    window.evaluate = evaluate

}(mui, Zepto));