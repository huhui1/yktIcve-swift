(function($M, $) {

    var attachmenthomeworkPreview = {
        /**
         * 获取作业作答记录信息
         * @return this
         */
        get: function(r) {
            $('.storm_title').text(r.data.homeworkTitle);
            $('#stormContent').html(template('attachmentList', { list: r.data.questions }));
            $('#answer').html(template('stuAttachmentList', { list: r.data.answer }));
            return this;
        },
        /**
         * 事件绑定
         * @return this
         */
        events: function() {
            var _this = this;
            // 模拟滚动
            $M('.mui-scroll-wrapper').scroll();
            $('.content').on('singleTap', '.moreramrk', function() {
                $(this).parent().html(_this.stuRemark);
            });

            $("#stormContent").on('singleTap', 'a.preview', function() {
                var $elem = $(this),
                    id = $elem.data('id');
                var message = { "method": "getUrlById", "Id": id };
                window.webkit.messageHandlers.interOp.postMessage(message);
            });
            $(".stupic-info").on('singleTap', 'a.preview', function() {
                var $elem = $(this),
                    id = $elem.data('id');
                var message = { "method": "getUrlById", "Id": id };
                window.webkit.messageHandlers.interOp.postMessage(message);
            });
            $("#answer").on('singleTap', 'a.preview', function() {
                var $elem = $(this),
                    id = $elem.data('id');
                var message = { "method": "getUrlById", "Id": id };
                window.webkit.messageHandlers.interOp.postMessage(message);
            });
            $(".pic-info").on('singleTap', 'a.preview', function() {
                var $elem = $(this),
                    id = $elem.data('id');
                var message = { "method": "getUrlById", "Id": id };
                window.webkit.messageHandlers.interOp.postMessage(message);
            });
            //del
            $('.pic-info').on('singleTap', '.delimg', function() {
                var $elem = $(this);
                $elem.parent().remove();
            });
            $('.pic-info').on('singleTap', '.seeImg', function() {
                var $elem = $(this);
                setTimeout(function() {
                    // 打开白板
                    $M.openWindow({
                        url: '/view/teacher/whiteboard/whiteboard.html',
                        id: 'teacher-whiteboard',
                        extras: {
                            img: $elem.attr('src'),
                            fromRes: true,
                            isPcLocal: false,
                            webview: "teacher-discuss-createDiscuss"
                        }
                    });
                }, 300);
            });
            //查看视频
            $('.pic-info').on('singleTap', '.video', function() {
                var $elem = $(this),
                    resourceurl = {
                        preview: $elem.attr('data-videourl') + '/360.mp4'
                    };
                setTimeout(function() {
                    // 打开白板
                    $M.openWindow({
                        url: '/view/teacher/video-controls/attachHomeworkVideo.html',
                        vid: 'teacher-attachHomeworkVideo',
                        extras: {
                            resourceurl: resourceurl
                        }
                    });
                }, 300);
            });
            //template渲染附件预览
            $('.pic-info').on('singleTap', '.temp-info', function() {
                var $elem = $(this),
                    id = $elem.data('id');
                var message = { "method": "getUrlById", "Id": id };
                window.webkit.messageHandlers.interOp.postMessage(message);
            });

            return this;
        },
        helper: function() {
            var _this = this;
            template.config('escape', false);
            return this;
        },
        load: function() {
            var message = { "method": "load" };
            window.webkit.messageHandlers.interOp.postMessage(message);
            return this;
        },
        /**
         * 初始化
         * @return this
         */
        init: function() {
            var _this = this;
            this.stuRemark = "";
            _this.helper().load().events();
            return this;
        }
    };


    attachmenthomeworkPreview.init();
    window.attachmenthomeworkPreview = attachmenthomeworkPreview

}(mui, Zepto));