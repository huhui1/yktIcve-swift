/**
 * 课堂互动，题目详情
 * @param {Object} $M => mui
 * @param {Object} $  => zepto
 * @name  zqyou
 * @date  2016-11-3
 * @return {Object}
 */
(function($M, $) {

    var info = {
        /**
         * 事件绑定
         * @return {this}
         */
        events: function() {
            var _this = this;

            $M('.mui-scroll-wrapper').scroll();
            //公式查看
            $('#exam-single-question').on('singleTap', 'img', function() {
                var url = $(this).attr('src');
                if (url) {
                    var message = { "method": "previewImg", "url": url };
                    window.webkit.messageHandlers.interOp.postMessage(message);
                }

            });

            $('#exam-single-question').on('singleTap', 'p > a', function() {
                var $elem = $(this);
                if ($elem.data('url')) {
                    var message = { "method": "getFileInfoByUrl", "url": $elem.data('url') };
                    window.webkit.messageHandlers.interOp.postMessage(message);
                }

            });

            return this;
        },

        /**
         * 数据加载
         * @return {this}
         */
        set: function(data) {
            var _this = this;
            $('.mui-scroll').html(template('question-single', { data: data }));
            return this;
        },

        /**
         * 扩展辅助方法
         * @return {this}
         */
        helper: function() {
            var _this = this;
            template.helper('typeName', function(type) {
                var arr = ["单选题", "多选题", "判断题"];
                type = Number(type);
                return arr[type - 1];
            });
            template.helper('answerhtml', function(v) {
                var arr = JSON.parse(v),
                    html = template('tmpl-answer-list', { list: arr });
                return html;

            });

            template.helper('tostranswer', function(i, type) {
                var str = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N'];
                var msg = "";
                if (type == 3) {
                    str = ['错误', '正确'];
                    msg = str[i];
                } else {
                    $.each(i.split(","), function(i, v) {
                        msg += str[Number(v)]
                    });
                }
                return msg;
            });
            template.helper('selectNum', function(num) {
                var str = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N'];
                return str[num];
            });

            template.helper('content', function(content) {
                return content.toString().replace(/<(?!(\/?img))[^>]+>/ig, "");
            });

            return this;
        },
        load: function() {
            var message = { "method": "load" };
            window.webkit.messageHandlers.interOp.postMessage(message);
            return this;
        },
        /**
         * 载入
         * @return {this}
         */
        init: function() {
            this.helper().load().events();
            return this;
        }
    };


    info.init();
    window.info = info


}(mui, Zepto));