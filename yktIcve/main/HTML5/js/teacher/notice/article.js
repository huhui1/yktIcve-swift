/**
 * 当前课程公告 公告详情页
 * @param {Object} $M => mui
 * @param {Object} $  => zepto
 * @name  zqyou
 * @date  2017-02-20
 * @return {Object}
 */
(function($M, $) {


    var article = {
        /**
         * 获取数据
         * @return {this}
         */
        get: function() {
            var _this = this,
                $loading = $('#mask'),
                $elem = $('#notice');
            if (_this.docJson) {
                var
                    arr = [];
                $.each(_this.docJson, function(i, v) {
                    arr.push({ src: v.docPreview, oss: v.docOssPreview })
                });
                var data = {
                    title: _this.title,
                    content: _this.content,
                    dateCreated: _this.dateCreated,
                };
                $('#notice').html(template('notice-tpl', { data: data, arr: arr }));
            } else if (_this.title.length > 0 && _this.content) {
                var data = {
                    title: _this.title,
                    content: _this.content,
                    dateCreated: _this.dateCreated,
                };
                $('#notice').html(template('notice-tpl', { data: data }));
            }

            return this;
        },

        /**
         * 添加事件
         * @return {this}
         */
        events: function() {
            var _this = this;
            // 模拟滚动
            $M('.mui-scroll-wrapper').scroll();

            //查看阅读人数详情
            $('#stu-num').on('click', function() {
                $M.openWindow({
                    url: '/view/teacher/notice/readinfo.html',
                    id: 'teacher-notice-readinfo',
                    extras: {
                        courseOpenId: _this.courseOpenId,
                        noticeId: _this.noticeId
                    }
                });
            });
            $('#notice').on('singleTap', 'img', function() {
                var url = $(this).data('oss');
                if (url) {
                    var message = { "method": "previewImg", "url": url };
                    window.webkit.messageHandlers.interOp.postMessage(message);
                }

                // setTimeout(function() {
                //     $M.openWindow({
                //         url: '/view/teacher/preview/img.html',
                //         id: 'teacher-preview-img',
                //         extras: {
                //             imgUrl: url
                //         }
                //     });
                // }, 100);
            });
            return this;
        },
        getParameter: function(content, title, dateCreated, docJson) {
            var _this = this;
            _this.title = title;
            _this.content = content;
            _this.dateCreated = dateCreated;
            if (docJson) {
                _this.docJson = docJson
            }
            _this.get();
        },
        load: function() {
            var message = { "method": "load" };
            window.webkit.messageHandlers.interOp.postMessage(message);
            return this;
        },
        /**
         * 辅助方法
         * @return {this}
         */
        helper: function() {

            template.config('escape', false);

            return this;
        },

        /**
         * 载入
         * @return {this}
         */
        init: function() {
            var _this = this;
            this.title = "";
            this.content = "";
            this.docJson = [];
            this.dateCreated = "";
            this.helper().load().events();

            return this;
        }
    };


    article.init();
    window.article = article;

}(mui, Zepto));