/**
 * 调查问卷分析
 * @param {Object} $M => mui
 * @param {Object} $  => zepto
 * @name  hx
 * @date  2018-1-11
 * @return {Object}
 */
(function($M, $) {



    var questionSurwayAnalysis = {

        /**
         * 获取数据
         * @return {this}
         */
        get: function(r) {
            var _this = this;
            $('#percent').text(r.data.unSubmitStuCount);
            $('#totalNum').text(r.data.openClassStuCount - r.data.unSubmitStuCount);
            _this.total = r.data.openClassStuCount;
            _this.questionList = r.data.questionList;
            $('#analysis-list').html(template('analysis-list-tpl', { list: r.data.questionList }));

            return this;
        },
        /**
         * 事件绑定
         * @return {this}
         */
        events: function() {
            var _this = this;

            // 滚动
            $M('.mui-scroll-wrapper').scroll();

            //单题解析
            $('#analysis-list').on('singleTap', 'li', function() {
                var order = $(this).attr('data-order');
                var message = { "method": "preview", "order": String(order), "questionList": JSON.stringify(_this.questionList) };
                window.webkit.messageHandlers.interOp.postMessage(message);

            });
            $('#percent,#totalNum').on('singleTap', function() {
                var type = $(this).data('type');
                var message = { "method": "studone", "type": String(type) };
                window.webkit.messageHandlers.interOp.postMessage(message);
            });

            return this;
        },

        /**
         * 扩展辅助方法
         * @return {this}
         */
        helper: function() {
            var _this = this;

            template.helper('replaceTime', function(data) {
                if (!data) return 0;
                return _this.MillisecondToDate(Number(data) * 1000);
            });
            template.helper('replaceToPrecent', function(data) {
                if (!data) return 0;
                return (data / _this.total * 100).toFixed(2);
            });
            return this;
        },
        load: function() {
            var message = { "method": "load" };
            window.webkit.messageHandlers.interOp.postMessage(message);
            return this;
        },
        /**
         * 载入
         * @return {this}
         */
        init: function() {

            this.total = '';
            this.questionList = [""];


            this.helper().load().events();

            return this;
        }
    };


    questionSurwayAnalysis.init();
    window.questionSurwayAnalysis = questionSurwayAnalysis;

}(mui, Zepto));