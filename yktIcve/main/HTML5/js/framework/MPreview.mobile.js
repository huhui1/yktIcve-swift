!function(i,t){"use strict";var e,s=/scale(?:3d)?\(([^\)]+)\)/,n=/translate(?:3d)?\(([^\)]+)\)/,o={url:null,data:null,title:"【浏览】",params:{},wrap:"body",direction:"top",placeholder:"images/placeholder.gif",init:null,close:null},h='<div class="ui-MPreview-wrap">   <div class="ui-MPreview-row">       <div class="ui-MPreview-toolbar">            <div class="ui-MPreview-back"><a href="javascript:;"><i class="iconfont icon-arrow-left"></i></a></div>            <div class="ui-MPreview-title">{{title}}</div>            <div class="ui-MPreview-pages"><span class="ui-MPreview-currentPage">00</span>/<span class="ui-MPreview-countPage">00</span></div>        </div>        <div class="ui-MPreview-view">            <div class="ui-MPreview-imgbox">                <ul class="ui-MPreview-imglist"></ul>            </div>            <div class="ui-MPreview-loading"></div>        </div>   </div></div>',r=function(i,t){var e,i=i||{};for(e in t)void 0===i[e]&&(i[e]=t[e]);return i},a=function(){var i,t=document.createElement("div"),e={WebkitTransition:"webkitTransitionEnd",OTransition:"oTransitionEnd",MozTransition:"transitionend",transition:"transitionend"};for(i in e)if(void 0!==t.style[i])return e[i]},c=function(i){return i.toString().length<2?"0"+i:i},l=function(i){return new l.fn.init(i)};l.fn=l.prototype={constructor:l,init:function(i){return e=a(),this.config=r(i,o),this.topics={},"function"==typeof this.config.init&&this.config.init(),this._action(),this.publish("init").publish("ajax").publish("touch").publish("zoom").publish("resize"),this},subscribe:function(i,t){return this.topics[i]||(this.topics[i]=[]),this.topics[i].push(t),this},unsubscribe:function(i){return this.topics[i]&&delete this.topics[i],this},publish:function(i){if(!this.topics[i])return!1;var t=this.topics[i],e=t?t.length:0,s=[].slice.call(arguments);s.shift();for(var n=0;e>n;n++)t[n].apply(this,s);return this},getTransform:function(i,e){i=t(i);var o,h,r,a,c=i.css("transform")||i.css("-webkit-transform"),l="none"===c;return"translate"===e?(a=n,(l||-1==c.indexOf(e))&&(l=!0,h=r=0)):"scale"===e&&(a=s,(l||-1==c.indexOf(e))&&(l=!0,h=r=1)),l||(o=c.match(a),o=o[1].split(","),h=parseFloat(o[0]),r=parseFloat(o[1])),{x:h,y:r}},scale:function(i){if(!i.width||!i.height)return{width:"100%",height:"100%"};var t,e=i.width,s=i.height,n=parseInt(this.offset.width),o=parseInt(this.offset.height);return e>n&&(t=n/e,e=n,s=Math.floor(s*t)),s>o&&(t=o/s,s=o,e=Math.floor(e*t)),{width:e,height:s}},distance:function(i,t){if(i&&t){var e=(i.x+t.x)/2,s=(i.y+t.y)/2;return{x:e,y:s}}},getOrigin:function(i,e){var s,n,o,h,r,a=void 0===e?i.touch.x:this.distance(i.touch.touches[0],i.touch.touches[1]).x,c=void 0===e?i.touch.y:this.distance(i.touch.touches[0],i.touch.touches[1]).y,l={width:void 0===e?this.size[this.index-1].width:parseInt(t(i.target).css("width"))*e,height:void 0===e?this.size[this.index-1].height:parseInt(t(i.target).css("height"))*e},d=void 0===e?this.scale(l):{width:parseInt(t(i.target).css("width")),height:parseInt(t(i.target).css("height"))},u=this.screen,f=e||l.width/d.width,g=(u.width-d.width)/2,p=(u.height-d.height)/2,m=a-g,v=c-p;return l.width<=parseInt(this.offset.width,10)&&l.height<=parseInt(this.offset.height,10)?!1:(l.width>u.width?(s=l.width-d.width,n=(s*(m/d.width)-g)/f,o=0-(s*((d.width-m)/d.width)-g)/f,0>n&&(n=0,m=g/s*d.width,o=0-(s*((d.width-m)/d.width)-g)/f),o>0&&(o=0,m=d.width-g/s*d.width,n=s*(g/d.width)/f)):m=d.width/2,l.height>u.height?(s=l.height-d.height,h=(s*(v/d.height)-p)/f,r=0-(s*((d.height-v)/d.height)-p)/f,0>h&&(h=0,v=p/s*d.height,r=0-(s*((d.height-v)/d.height)-p)/f),r>0&&(r=0,v=d.height-p/s*d.height,h=(s*(v/d.height)-p)/f)):v=d.height/2,{scale:f,x:m+"px",y:v+"px",scope:{maxTx:n,minTx:o,maxTy:h,minTy:r}})},destroy:function(){var i;"function"==typeof this.config.close&&(i=this.config.close()),i!==!1&&(t(this.config.wrap).empty(),t(this.config.wrap).removeAttr("style"),t(document).off("touchmove"),t(window).off(this.resizeType))},_action:function(){return this.subscribe("init",function(){var i=this,e="width: 100%; height: 100%; overflow: hidden; background: #000";this.data=null,this.DOM=null,this.index=1,this.size={},this.isExec=!1,this.touch=null,this.isScroll=!1,this.isScale=!1,this.isZoom=!1,this.imgMoveData=null,this.zoomInertia=null,this.zoomRecord=1,this.screen={width:window.innerWidth,height:window.innerHeight},this.resizeType="number"==typeof window.orientation?"orientationchange":"resize",this.config.direction="left"==this.config.direction?!0:!1,t(i.config.wrap)[0].style.cssText=e,t(document).on("touchmove",function(i){i.preventDefault()})}),this.subscribe("init",function(){var i,e={},s=h.replace("{{title}}",this.config.title),n=t(this.config.wrap),o=this.screen;n.html(s),i=n.find("*"),i.each(function(i,s){if(s.className.indexOf("ui-MPreview-")>-1){var n=s.className.replace("ui-MPreview-","");e[n]=t(s)}});var r=parseInt(e.toolbar.style("height"),10);e.wrap.style("width",o.width+"px"),e.wrap.style("height",o.height+"px"),e.view.style("height",o.height-r+"px"),e.view.style("top",r+"px"),this.offset={width:e.view.style("width"),height:e.view.style("height")},this.DOM=e}),this.subscribe("init",function(){var i=this;this.DOM.back.on("touch",function(t){t.preventDefault(),i.destroy()})}),this.subscribe("load",function(i,e,s){var n=this,o=function(i){n.size[e]||(n.size[e]=i),s&&s.call(n,i),setTimeout(function(){n.DOM.loading.addClass("ui-MPreview-hide")},100)};t.each(i,function(i,t){n.DOM.loading.removeClass("ui-MPreview-hide");var e=new Image;e.src=t,e.complete?o({width:e.width,height:e.height}):e.onload=function(){o({width:e.width,height:e.height}),e.onload=null}})}),this.subscribe("ajax",function(){if(this.config.data||this.config.url){var i=this,e=function(i){this.data=i.imgs,this.publish("load",[i.imgs[0]],0,function(i){this.publish("append",i).publish("setPage").publish("preloading","next")})};return this.config.data&&this.config.data.length?void e.call(this,{imgs:this.config.data}):void t.ajax({url:this.config.url,data:this.config.params,dataType:"json",success:function(t){t.code>0&&t.imgs&&t.imgs.length&&e.call(i,t)},error:function(){alert("获取数据失败")}})}}),this.subscribe("append",function(i){var t="",e=this.DOM,s='<li data-index="{{index}}" style="width: '+this.offset.width+"; height: "+this.offset.height+';"><img src="{{src}}" style="width: {{width}}; height: {{height}};" /></li>',n=this.data.length>2?3:this.data.length;i=this.scale(i);for(var o=0;n>o;o++){var h=0===o?this.data[o]:this.config.placeholder,r=0===o?i.width+"px":"100%",a=0===o?i.height+"px":"100%";t+=s.replace("{{index}}",o).replace("{{src}}",h).replace("{{width}}",r).replace("{{height}}",a)}e.imglist.html(t),e.imglist.style(this.config.direction?"width":"height",parseInt(this.offset[this.config.direction?"width":"height"],10)*n+"px"),e.imglist.vendor("transform-origin","50% 50% 0px"),e.imgbox.addClass("ui-MPreview-show"),e.loading.addClass("ui-MPreview-hide")}),this.subscribe("append",function(){this.DOM.countPage.text(c(this.data.length))}),this.subscribe("setPage",function(){this.DOM.currentPage.text(c(this.index))}),this.subscribe("preloading",function(i,e){var s=document.createElement("li"),n=this,o=this.DOM,h="next"==i?this.index+1:this.index-1,r=function(i,t,s){n.publish("load",[t],s,function(s){s=n.scale(s),i.html('<img src="'+t+'" style="width: '+s.width+"px; height: "+s.height+'px" />'),e&&e()})};if(h--,s.style.width=n.offset.width,s.style.height=n.offset.height,!(0>h||h>this.data.length-1||"prev"==i&&this.index==this.data.length-1)){if("next"==i&&n.index<3)return void r(t(o.imglist.find("li").get(n.index)),this.data[h],h);s.setAttribute("data-index",h),o.imglist.find("li")["next"==i?"first":"last"]().remove(),o.imglist["next"==i?"append":"prepend"](s),r(t(s),this.data[h],h)}}),this.subscribe("touchStyle",function(i,t,e,s){var n=this.DOM.imglist;i=i||0,t=t||0,e=e||0,n.vendor("transition","-webkit-transform "+i+"ms "+s+" 0s"),n.vendor("transform","translate3d("+t+"px, "+e+"px, 0px)")}),this.subscribe("touch",function(){var i,t,s,n,o=this,h=parseInt(o.offset.width,10),r=parseInt(o.offset.height,10),a=parseInt(parseInt(this.offset.width)/3,10),c=parseInt(parseInt(this.offset.height)/3,10),l=this.DOM,d=function(){if(o.isScroll=!1,o.isExec=!1,n){o.publish("preloading",s?"next":"prev");var i=(o.index-1)*(o.config.direction?h:r)-(o.config.direction?h:r);1==o.index&&(i=0),o.index==o.data.length&&(i-=o.config.direction?h:r),l.imglist.style(o.config.direction?"left":"top",0>i?"0px":i+"px")}};l.imgbox.on("touchstart",function(e){e.preventDefault(),o.isExec||o.isScale||e.touches.length>1||(i=e.touches[0].clientX,t=e.touches[0].clientY)}),l.imgbox.on("touchmove",function(e){if(e.preventDefault(),!(o.isExec||o.isScale||e.touches.length>1)){var n=Math.abs(o.config.direction?e.touches[0].clientX-i:e.touches[0].clientY-t);1===e.touches.length&&n>20&&(o.isScroll=!0);var h,r=e.touches[0],a=r.clientX,c=r.clientY,l=o.index>1?(o.index-1)*parseInt(o.config.direction?o.offset.width:o.offset.height,10):0;s=o.config.direction?i-a>0?!0:!1:t-c>0?!0:!1;var d=Math.abs(o.config.direction?i-a:t-c);h=s||1!=o.index?s?-(d+l):-(l-d):d,o.config.direction?o.publish("touchStyle",0,h,0,"ease"):o.publish("touchStyle",0,0,h,"ease")}}),l.imgbox.on("touchend",function(e){if(e.preventDefault(),!(o.isExec||o.isScale||e.touches.length>1)){var l=e.changedTouches[0],d=l.clientX,u=l.clientY;o.isExec=!0,n=o.config.direction?Math.abs(i-d)>a:Math.abs(t-u)>c,n&&(s?o.index++:o.index--),o.index>o.data.length&&(o.index=o.data.length),o.index<1&&(o.index=1);var f=-(o.index-1)*(o.config.direction?h:r);o.config.direction?o.publish("touchStyle",300,f,0,"ease-out"):o.publish("touchStyle",300,0,f,"ease-out"),n&&o.publish("setPage")}}),l.imgbox.on(e,d)}),this.subscribe("untouch",function(){var i=this.DOM;i.imgbox.off("touchstart"),i.imgbox.off("touchmove"),i.imgbox.off("touchend"),i.imgbox.off(e)}),this.subscribe("zoom",function(){var i=this.DOM,e=this;i.imglist.on("doubleTap","li",function(i){e.publish(e.isScale?"zoomOut":"zoomIn",i)}),i.imglist.on("pinchIn","img",function(i){if(i.preventDefault(),!e.isScroll){var s=t(i.target);s.off("touchstart"),s.off("touchmove"),e.zoomInertia.scale<=1?(e.isScale=!1,s.vendor("transition","-webkit-transform 300ms ease 0s"),s.vendor("transform-origin",e.zoomInertia.x+" "+e.zoomInertia.y+" 0px"),s.vendor("transform","scale3d(1, 1, 1)")):e.zoomInertia.scope&&(s.on("touchstart",function(i){e.publish("imgTouchStart",i,this)}),s.on("touchmove",function(i){e.publish("imgTouchMove",i,this,e.zoomInertia.scope)})),e.publish("zoomRecord",i.target)}}),i.imglist.on("pinching","img",function(i){i.preventDefault(),e.isScroll||e.publish("zoomInertia",i)}),i.imglist.on("pinchOut","img",function(i){if(i.preventDefault(),!e.isScroll){var s=t(i.target);s.off("touchstart"),s.off("touchmove"),e.zoomInertia.scope&&(s.on("touchstart",function(i){e.publish("imgTouchStart",i,this)}),s.on("touchmove",function(i){e.publish("imgTouchMove",i,this,e.zoomInertia.scope)})),e.publish("zoomRecord",i.target)}}),i.imglist.on("touchend","img",function(i){i.touches.length||e.isScale||!e.isZoom||(e.isZoom=!1,e.isExec=!1,setTimeout(function(){e.publish("touch")},10))})}),this.subscribe("zoomRecord",function(i){this.zoomRecord=this.getTransform(i,"scale").x}),this.subscribe("zoomIn",function(i){var e=this,s="IMG"===i.target.nodeName?t(i.target):t(i.target).find("img").first(),n=this.getOrigin(i);n&&(e.isZoom=!0,this.publish("untouch"),this.isScale=!0,s.on("touchstart",function(i){e.publish("imgTouchStart",i,this)}),s.on("touchmove",function(i){e.publish("imgTouchMove",i,this,n.scope)}),s.vendor("transform-origin",n.x+" "+n.y+" 0px"),s.vendor("transition","-webkit-transform 300ms ease-out 0s"),s.vendor("transform","scale3d("+n.scale+", "+n.scale+", 1)"),this.publish("zoomRecord",s[0]))}),this.subscribe("zoomOut",function(i){var e="IMG"!==i.target.nodeName?t(i.target).find("img").first():t(i.target),s=e.css("transform-origin")||e.css("-webkit-transform-origin");this.isScale=!1,this.isZoom=!1,e.off("touchstart"),e.off("touchmove"),e.vendor("transform-origin",s),e.vendor("transition","-webkit-transform 300ms ease-out 0s"),e.vendor("transform","scale3d(1, 1, 1)"),this.publish("touch"),this.publish("zoomRecord",e[0])}),this.subscribe("zoomInertia",function(i){i.preventDefault();var e,s,n,o=t(i.target),h=i.touch.delta,r=parseInt(o.css("width"),10),a=r*this.zoomRecord,c=this.size[this.index-1].width,l=c/r;0!==h&&(this.isScale||(this.isScale=!0,this.isZoom=!0,this.publish("untouch")),h>0?(n=h/a*c,e=Math.abs(1-(a+n)/a),s=this.zoomRecord+e):(n=h/r*a,e=Math.abs(1-(r+n)/r),s=this.zoomRecord-e),.5>s&&(s=.5),s>l&&(s=l),this.zoomInertia=this.getOrigin(i,s),this.zoomInertia||(this.zoomInertia={scale:s,x:"50%",y:"50%"}),this.imgMoveData={scale:{x:s,y:s},client:{x:i.touch.touches[0].x,y:i.touch.touches[0].y}},o.vendor("transition","-webkit-transform 0ms ease 0s"),o.vendor("transform-origin",this.zoomInertia.x+" "+this.zoomInertia.y+" 0px"),o.vendor("transform","scale3d("+s+", "+s+", 1)"))}),this.subscribe("imgTouchStart",function(i,e){var s=this.getTransform(e,"scale"),n=i.touches[0];this.imgMoveData={scale:s,client:{x:n.clientX,y:n.clientY}},t(e).vendor("transition","-webkit-transform 0ms ease 0s")}),this.subscribe("imgTouchMove",function(i,e,s){i.preventDefault();var n=this.getTransform(e,"translate"),o=t(e),h=this.imgMoveData,r=i.touches,a=r[0].clientX,c=r[0].clientY,l=(a-h.client.x)/h.scale.x,d=(c-h.client.y)/h.scale.y;r.length>1||void 0===h.scale.x||void 0===h.scale.y||(this.imgMoveData.client.x=r[0].clientX,this.imgMoveData.client.y=r[0].clientY,void 0!==s.maxTx&&void 0!==s.minTx&&(n.x+=l,n.x>s.maxTx?n.x=s.maxTx:n.x<s.minTx&&(n.x=s.minTx)),void 0!==s.maxTy&&void 0!==s.minTy&&(n.y+=d,n.y>s.maxTy?n.y=s.maxTy:n.y<s.minTy&&(n.y=s.minTy)),o.vendor("transform","scale3d("+h.scale.x+", "+h.scale.y+", 1) translate3d("+n.x+"px, "+n.y+"px, 0px)"))}),this.subscribe("resize",function(){var i,e=this.DOM,s=this,n=function(){s.screen={width:window.innerWidth,height:window.innerHeight},s.isExec=!1,s.isZoom=!1,s.isScroll=!1,s.isScale=!1;var i=parseInt(e.toolbar.style("height"),10),n=s.screen.width,o=s.screen.height,h=o-i,r=(s.index-1)*(s.config.direction?n:h)-(s.config.direction?n:h),a=-(s.index-1)*(s.config.direction?n:h);1==s.index&&(r=0),s.index==s.data.length&&(r-=s.config.direction?n:h),s.offset={width:n+"px",height:h+"px"},e.wrap[0].style.cssText="width: "+n+"px; height: "+o+"px;",e.view[0].style.cssText="top: "+i+"px; height: "+h+"px;",e.imglist.find("li").each(function(i,e){var n=t(e).find("img"),o=parseInt(t(e).attr("data-index"),10),h=s.size[o]&&s.scale(s.size[o]);e.style.cssText="width:"+s.offset.width+"; height: "+s.offset.height+";",h&&(n[0].style.cssText="width: "+h.width+"px; height: "+h.height+"px;"),n.vendor("transform-origin","50% 50% 0px"),n.vendor("transition","-webkit-transform 0ms ease 0s"),n.vendor("transform","scale3d(1, 1, 1) translate3d(0px, 0px, 0px);"),n.off("touchstart"),n.off("touchmove")}),e.imglist.css(s.config.direction?"left":"top",0>r?"0px":r+"px"),e.imglist.css(s.config.direction?"width":"height",(s.config.direction?n:h)*(s.data.length>2?3:s.data.length)+"px"),s.config.direction?s.publish("touchStyle",0,a,0,"ease"):s.publish("touchStyle",0,0,a,"ease"),s.publish("untouch").publish("touch")};t(window).on(s.resizeType,function(){clearTimeout(i),i=setTimeout(n,300)})}),this}},l.fn.init.prototype=l.fn,i.MPreview=l}(window,$$);