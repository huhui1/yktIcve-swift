/**
 * app 应用入口子页面
 * @param {Object} $M => mui
 * @param {Object} $  => zepto
 * @name  zqyou
 * @date  2017-01-14
 * @return {Object}
 */
(function($M, mui) {

    var locker = {

        /**
         * 操作完成
         * @return {this}
         */
        done: function(event) {
            var rs = event.detail,
                $elem = $('#holder-alert');

            // 手势判断操作
            if (rs.points.length < 4) {
                rs.sender.clear();
                return;
            }

            locker.points = rs.points;
            $elem.text('手势设定完成').addClass('mui-hidden');
            $('#reset, #done').removeClass('mui-hidden');

            return this;
        },

        /**
         * 绑定事件
         * @return {this}
         */
        events: function() {
            var _this = this;

            $M('.mui-scroll-wrapper').scroll();

            // 锁屏操作
            $('#holder')[0].addEventListener('done', _this.done, false);

            // 重设
            $('#reset').on('touchend', function() {
                $('#reset, #done').addClass('mui-hidden');
                $('#holder')[0].locker.clear();
                $('#hoder-button').addClass('mui-hidden').prev().removeClass('mui-hidden').text('请设置手势');
            });

            // 完成
            $('#done').on('touchend', function() {
                //  $('#holder')[0].locker.clear();
                setTimeout(function() {
                    var message = { "method": "tapSign", "gestrue": _this.points.join('') };
                    window.webkit.messageHandlers.interOp.postMessage(message);

                }, 100);

            });

            return this;
        },

        ListenerstuSigned: function(r) {
            var _this = this;
            _this.signCount++;
            _this.charts(1.0 * _this.signCount / _this.studycount * 100, _this.studycount).bulletScreen(r.displayName);
            return this;
        },
        /**
         * 载入
         * @return {this}
         */
        init: function() {
            var _this = this;
            this.lines = [];
            this.tempLines = [];
            this.speeds = [];

            this.signCount = 0
            this.studycount = 0
            _this.events();

            return this;
        }
    };


    locker.init();


}(mui, Zepto));