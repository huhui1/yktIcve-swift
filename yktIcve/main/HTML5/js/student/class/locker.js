/**
 * app 学生手势签到应用入口子页面
 * @param {Object} $M => mui
 * @param {Object} $  => zepto
 * @name  zqyou
 * @date  2017-03-02
 * @return {Object}
 */
(function($M, mui) {

    var locker = {
        /**
         * 操作完成
         * @return {this}
         */
        done: function(event) {
            var rs = event.detail,
                $elem = $('#holder-alert');

            if (this.gesture === rs.points.join('')) {
                rs.sender.clear();
                $elem.html('<span style="color: #14d6ec;">签到成功！跳转中...</span>');
                var message = { "method": "done" };
                window.webkit.messageHandlers.interOp.postMessage(message);
            } else {
                rs.sender.clear();
                $elem.html('<span style="color: red;">手势绘制错误，请重新绘制</span>');
                clearTimeout(this.cle);
                this.cle = setTimeout(function() {
                    $elem.html('');
                }, 2000);
            }

            return this;
        },
        /**
         * 绑定事件
         * @return {this}
         */
        events: function() {
            var _this = this;

            // 锁屏操作
            document.querySelector('#holder').addEventListener('done', function(event) {
                _this.done(event);
            });

            return this;
        },
        load: function() {
            var message = { "method": "load" };
            window.webkit.messageHandlers.interOp.postMessage(message);
            return this;
        },
        /**
         * 载入
         * @return {this}
         */
        setgesture: function(gesture) {
            this.gesture = gesture;
            return this;
        },
        /**
         * 载入
         * @return {this}
         */
        init: function() {
            this.gesture = "";
            this.load().events();

            return this;
        }
    };


    locker.init();
    window.locker = locker
}(mui, Zepto));