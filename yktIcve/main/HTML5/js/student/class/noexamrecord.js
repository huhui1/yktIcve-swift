/**
 * 随堂检测未做报告
 * @param {Object} $M => mui
 * @param {Object} $  => zepto
 * @name  zqyou
 * @date  2015-07-28
 * @return {Object}
 */
(function($M, $) {
    var letter = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z'];

    var report = {
        /**
         * 获取数据
         * @return {this}
         */
        get: function(data) {
            var _this = this;
            if (data.code > 0) {

                _this.examTitle = data.classTestInfo.title;
                $.each(data.classTestQuestionList, function(i, v) {
                    if (v.questionType === 3) {
                        v.dataJson = '[{ "SortOrder": "错误", "Content": "错误", "IsAnswer": "" }, { "SortOrder": "正确", "Content": "正确", "IsAnswer": "" }]';
                    }
                    v.rightAnswer = v.Answer;
                    v.dataJson = JSON.parse(v.dataJson);
                    if (v.isRight != 1) {
                        _this.errorQuestionList.push(v);
                    }

                    _this.allQuestionList.push(v);
                });
                $('#report').html(template('report-tpl', {
                    classTestInfo: data.classTestInfo,
                    classTestQuestionList: data.classTestQuestionList
                }));

            }
            return this;
        },

        /**
         * 事件绑定
         * @return {this}
         */
        events: function() {
            var _this = this;

            $M('.mui-scroll-wrapper').scroll();

            // 单个题目预览
            $('#report').on('singleTap', 'div.answer-list > ul > li > a', function(e) {
                var $elem = $(this),
                    index = $elem.parent().index();
                var message = { "method": "singleRecord", "extrasData": JSON.stringify(_this.allQuestionList), "start": String(index) };
                window.webkit.messageHandlers.interOp.postMessage(message);

            });

            // 所有错题解析
            $('#error-exam').on('singleTap', function(e) {
                var message = { "method": "singleTitleRecord", "extrasData": JSON.stringify(_this.errorQuestionList) };
                window.webkit.messageHandlers.interOp.postMessage(message);
            });

            // 所有题目解析
            $('#all-exam').on('singleTap', function(e) {
                var message = { "method": "allTitleRecord", "extrasData": JSON.stringify(_this.allQuestionList) };
                window.webkit.messageHandlers.interOp.postMessage(message);
            });

            return this;
        },
        load: function() {
            var message = { "method": "load" };
            window.webkit.messageHandlers.interOp.postMessage(message);
            return this;
        },
        /**
         * 载入
         * @return {null}
         */
        init: function() {
            this.errorQuestionList = [];
            this.allQuestionList = [];
            this.examTitle = "";
            this.load().events();
        }
    };


    report.init();
    window.report = report;

}(mui, Zepto));