/**
 * 讨论区
 * @param {Object} $M => mui
 * @param {Object} $  => zepto
 * @name  zqyou
 * @date  2017-02-21
 * @return {Object}
 */
(function($M, $) {

    var bbs = {
        /**
         * 活动结束回调
         * @return this
         */
        endCallBack: function() {
            var _this = this;

            //同步数据直接跳转到列表页
            setTimeout(function() {
                $M.openWindow({
                    url: '/view/student/discuss/discuss.html',
                    id: 'student-discuss',
                    extras: {
                        courseOpenId: _this.courseOpenId,
                        openClassId: _this.openClassId,
                        activityId: _this.activityId
                    }
                });
            }, 100);

            var view = plus.webview.getWebviewById('student-discuss');
            $M.fire(view, 'reload');

            setTimeout(function() {
                var view = plus.webview.currentWebview();
                view.close();
            }, 500);

            return this;
        },
        /**
         * 载入
         * @return {null}
         */
        init: function() {
            var _this = this;

            this.view = plus.webview.currentWebview();
            this.courseOpenId = this.view.courseOpenId;
            this.openClassId = this.view.openClassId;
            this.activityId = this.view.activityId;
            this.discussId = this.view.discussId || '';
            this.title = this.view.title;
            this.creatorId = this.view.creatorId;
            this.content = this.view.content;
            this.time = this.view.time;
            this.status = this.view.status;
            // 修改侧滑
            var view = this.view;
            view.setStyle({ 'popGesture': 'close' });

            // 设置软键盘
            view.setStyle({ 'softinputMode': 'adjustPan' });
            // 加载子页面
            $M.init({
                swipeBack: true,
                beforeback: function() {},
                subpages: [{
                    url: '/view/student/discuss/list.html',
                    id: 'student-discuss-list',
                    styles: {
                        top: plus.navigator.isImmersedStatusbar() ? '94px' : '64px',
                        bottom: '0px'
                    },
                    extras: {
                        courseOpenId: this.courseOpenId,
                        openClassId: this.openClassId,
                        creatorId: this.creatorId,
                        activityId: this.activityId,
                        discussId: this.discussId,
                        status: this.status
                    }
                }]
            });

        }
    };

    $M.plusReady(function() {
        bbs.init();
    });

}(mui, Zepto));