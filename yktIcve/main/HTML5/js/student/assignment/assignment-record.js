(function($M, $) {

    var record = {
        /**
         * 获取作业作答记录信息
         * @return this
         */
        get: function(me) {
            var _this = this;
            $http.post(app.studentAPI.Homework.getHomeworkStuRecord, {
                courseOpenId: _this.courseOpenId,
                openClassId: _this.openClassId,
                homeworkId: _this.homeWorkId,
                homeworkTermTimeId: _this.homeworkTermTimeId,
                stuId: _this.stuId,
                userType: 1
            }, function(r) {
                if (r.code == 1) {
                    $('#mask').addClass('mui-hidden');
                    if (!me) {
                        if (r.isTakeHomework) {
                            $('#done').removeClass('mui-hidden');
                        }
                        if (r.stuHomeworkList.length) {
                            var html = template('tmpl-record-list', { list: r.stuHomeworkList });
                            $('#content-record-list').html(html);
                        } else {
                            if (!r.isTakeHomework) {
                                $('#content-record-list').html('<li ><h6 class="nodata">暂不允许作答 造成此现象的原因可能为未开始，已经超过截止时间或已经作答等原因</h6></li>');
                            } else {
                                $('#content-record-list').html('<li ><h6 class="nodata">暂无任何作答记录信息</h4></li>');
                            }
                        }
                    }
                    me && me.resetload();
                }
            });

            return this;
        },


        /**
         * 事件绑定
         * @return this
         */
        events: function() {
            var _this = this;

            $('#mine-wrap').dropload({
                domUp: {
                    domClass: 'dropload-up',
                    domRefresh: '<div class="dropload-refresh">↓ 下拉可以刷新</div>',
                    domUpdate: '<div class="dropload-update">↑ 释放立即刷新</div>',
                    domLoad: '<div class="dropload-load"><span class="loading"></span> 正在刷新中...</div>'
                },
                domDown: {
                    domClass: 'dropload-down',
                    domRefresh: '<div class="dropload-refresh">↑ 上拉加载更多</div>',
                    domLoad: '<div class="dropload-load"><span class="loading"></span> 正在刷新中...</div>',
                    domNoData: '<div class="dropload-noData"></div>'
                },
                loadUpFn: function(me) {
                    _this.get(me);
                }
            });
            // 模拟滚动
            $M('.mui-scroll-wrapper').scroll();

            $('#content-record-list').on('singleTap', 'li.record', function() {
                var $elem = $(this),
                    state = $elem.data('state'),
                    homeworkStuId = $elem.data('homeworkstuid');
                var message = { "method": "recordList", "state": String(state), "homeworkStuId": homeworkStuId };
                window.webkit.messageHandlers.interOp.postMessage(message);
            });

            $('#done').on('singleTap', function() {
                var message = { "method": "done", " homeworkStuId": _this.homeworkStuId };
                window.webkit.messageHandlers.interOp.postMessage(message);
            });
            return this;
        },
        getparameter: function(courseOpenId, openClassId, homeWorkId, homeworkTermTimeId, ztWay, stuId) {
            var _this = this;
            _this.courseOpenId = courseOpenId;
            _this.openClassId = openClassId;
            _this.homeWorkId = homeWorkId;
            _this.homeworkTermTimeId = homeworkTermTimeId;
            _this.stuId = stuId;
            _this.ztWay = ztWay
            _this.get().events();
            return this
        },
        load: function() {
            var _this = this;
            var message = { "method": "load" };
            window.webkit.messageHandlers.interOp.postMessage(message);
            return this
        },
        /**
         * 初始化
         * @return this
         */
        init: function() {
            var _this = this;
            this.courseOpenId = "";
            this.openClassId = "";
            this.homeWorkId = "";
            this.homeworkStuId = ""
            this.homeworkTermTimeId = "";
            this.stuId = "";
            this.ztWay = "";

            _this.load().events();

            return this;
        }
    };
    record.init();
    window.record = record

}(mui, Zepto));