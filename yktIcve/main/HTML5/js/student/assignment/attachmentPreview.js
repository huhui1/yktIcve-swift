(function($M, $) {

    var attachmentPreview = {
        /**
         * 获取作业作答记录信息
         * @return this
         */
        get: function(me) {
            var _this = this;
            $http.post(app.studentAPI.Homework.getStuFileHomeworkPreview, {
                courseOpenId: _this.courseOpenId,
                openClassId: _this.openClassId,
                homeworkId: _this.homeWorkId,
                homeworkStuId: _this.homeworkStuId,
                stuId: _this.stuId
            }, function(r) {
                if (r.code == 1) {
                    $('.storm_title').text(r.data.homeworkTitle);
                    $('.content').html(r.data.stuRemark);
                    $('.commentary').html(r.data.commentary);
                    $('#stormContent').html(template('attachmentList', { list: r.data.questions }));
                    $('.pic-info').html(template('stuAttachmentList', { list: r.data.stuAnswers }));
                    if (r.data.state == 2) {
                        $('#answer').html(template('attachmentList', { list: r.data.answer }));
                    }
                    $('#attachCommentary').html(template('commentaryList', { list: r.data.commentaryFileData }));
                    me && me.resetload();
                }
            });

            return this;
        },


        /**
         * 事件绑定
         * @return this
         */
        events: function() {
            var _this = this;
            // 模拟滚动
            $M('.mui-scroll-wrapper').scroll();

            $("#stormContent").on('singleTap', 'a.preview', function() {
                var $elem = $(this),
                    id = $elem.data('id');
                var message = { "method": "getUrlById", "Id": id };
                window.webkit.messageHandlers.interOp.postMessage(message);
            });
            $(".pic-info").on('singleTap', 'a.preview', function() {
                var $elem = $(this),
                    id = $elem.data('id');
                var message = { "method": "getUrlById", "Id": id };
                window.webkit.messageHandlers.interOp.postMessage(message);
            });
            $('#answer').on('singleTap', 'a.preview', function() {
                var $elem = $(this),
                    id = $elem.data('id');
                var message = { "method": "getUrlById", "Id": id };
                window.webkit.messageHandlers.interOp.postMessage(message);
            });
            $('#attachCommentary').on('singleTap', 'a.preview', function() {
                var $elem = $(this),
                    id = $elem.data('id');
                var message = { "method": "getUrlById", "Id": id };
                window.webkit.messageHandlers.interOp.postMessage(message);
            });
            return this;
        },

        helper: function() {
            var _this = this;

            return this;
        },
        getparameter: function(courseOpenId, openClassId, homeWorkId, stuId, homeworkStuId) {
            var _this = this;
            _this.courseOpenId = courseOpenId;
            _this.openClassId = openClassId;
            _this.homeWorkId = homeWorkId;
            _this.homeworkStuId = homeworkStuId;
            _this.stuId = stuId;
            _this.get().events();
            return this
        },
        load: function() {
            var _this = this;
            var message = { "method": "load" };
            window.webkit.messageHandlers.interOp.postMessage(message);
            return this
        },
        /**
         * 初始化
         * @return this
         */
        init: function() {
            var _this = this;
            this.courseOpenId = "";
            this.openClassId = "";
            this.homeWorkId = "";
            this.homeworkStuId = "";
            this.stuId = "";
            _this.load();
            return this;
        }
    };


    attachmentPreview.init();
    window.attachmentPreview = attachmentPreview

}(mui, Zepto));