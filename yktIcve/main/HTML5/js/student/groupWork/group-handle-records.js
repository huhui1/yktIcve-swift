(function($M, $) {


    var handlerecord = {
        /**
         * 获取作业作答记录信息
         * @return this
         */
        get: function(r) {
            var _this = this;
            $('.commentaryStyle').hide();
            $('.storm_title').text(r.data.content);
            _this.previewUrl = r.data.stuAnswerPreviewUrl;
            $('.content').html(r.data.stuAnswerContent);
            $('.commentary').html(r.data.commentary);
            $('#stormContent').html(template('attachmentList', { list: r.data.questions }));
            $('.pic-info').html(template('stuAttachmentList', { list: r.data.stuAnswerDocJson }));


            return this;
        },
        getPreview: function(r) {
            var _this = this;

            $('.storm_title').text(r.data.content);
            $('.content').html(r.data.stuAnswerContent);
            $('.commentary').html(r.data.comment);
            $('#stormContent').html(template('attachmentList', { list: r.data.questions }));
            $('.pic-info').html(template('stuCompleteAttachmentList', { list: r.data.stuAnswerDocJson }));

            return this;
        },

        /**
         * 事件绑定
         * @return this
         */
        events: function() {
            var _this = this;
            // 模拟滚动
            $M('.mui-scroll-wrapper').scroll();
            $("#stormContent").on('singleTap', 'a', function() {
                var $elem = $(this),
                    id = $elem.data('id');
                var message = { "method": "getUrlById", "Id": id };
                window.webkit.messageHandlers.interOp.postMessage(message);
            });
            $(".pic-info").on('singleTap', 'a', function() {
                var $elem = $(this),
                    id = $elem.data('id');
                var message = { "method": "getUrlById", "Id": id };
                window.webkit.messageHandlers.interOp.postMessage(message);
            });
            return this;
        },
        load: function() {
            var message = { "method": "load" };
            window.webkit.messageHandlers.interOp.postMessage(message);
            return this;
        },
        helper: function() {
            var _this = this;
            //对字符串进行编码
            template.config('escape', false);
            //拼接URL
            template.helper('Stitching', function(v) {
                return _this.previewUrl.replace('?', v + '?');
            });
            //拼接URLoss 70——70
            template.helper('StitchingOSS', function(v) {
                var arr = v.split("?")
                return arr[0] + "?x-oss-process=image/resize,w_70,h_70/quality,q_70"
            });

            return this;
        },

        /**
         * 初始化
         * @return this
         */
        init: function() {
            var _this = this;

            _this.helper().load().events();

            return this;
        }
    };


    handlerecord.init();

    window.handlerecord = handlerecord;

}(mui, Zepto));