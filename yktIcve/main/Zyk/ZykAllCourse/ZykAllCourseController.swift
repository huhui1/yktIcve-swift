//
//  ZykAllCourseController.swift
//  云课堂2
//
//  Created by 志辉教育 on 2018/7/2.
//  Copyright © 2018年 zqyou. All rights reserved.
//
import UIKit
import SwiftyJSON
import Alamofire
extension ZykAllCourseView{
    func getAllCourseList(isRefresh:Bool,likes:String){
        XLBallLoading.show(in: self.view)
        let dict = ["projectId": self.projectId,
                    "schollId":self.schollId,
                    "type":"",
                    "coursetype":self.type,
                    "page":self.page,
                    "likes":likes,
                    "token":Account.defaultAccount.token!] as [String : Any]
        Alamofire.request(ZYKAPI.course_getAllCourse, method: .post, parameters: dict, encoding: URLEncoding.default).responseJSON { response in
            if let value = response.result.value {
                XLBallLoading.hide(in: self.view)
                let json = JSON(value);
                if json["code"] == 1{
                   
                    self.Coursetotal = json["total"].intValue
                   
                    common.share.setTableFootView_noData(self.tableView, list: json["list"].arrayValue as NSArray)
                    for data in json["list"]{
                        let Allcourse = ZykAllCourseModel.init(json: data.1)
                        self.AllCourseList.append(Allcourse)
                    }
                    if(!isRefresh){
                        //结束刷新
                        self.tableView.mj_header.endRefreshing()
                        self.tableView.mj_footer.endRefreshing()
                    }
                    self.tableView.reloadData()
                }else{
                    ZKProgressHUD.showError(json["msg"].stringValue);
                }
            }else{
                ZKProgressHUD.showError("网络异常请稍后再试！");
                XLBallLoading.hide(in: self.view)
            }
        }
    }
    
    
    
    
    
    func presentVC(tag:Int){
        let vc = ZykselectCourseByProjectAndSchool();
        vc.type = tag
        if tag == 1{
            vc.isProject = true
            vc.title = "项目"
        }else{
            vc.isProject = false
            vc.title = "学校和企业"
        }
        vc.SchoolId = self.schollId
        vc.ProjectId = self.projectId
        vc.SchoolName = self.SchoolName
        vc.ProjectName = self.ProjectName
        vc.reloadlistCourse = {(ProjectId,SchoolId) in
            self.schollId = SchoolId
            self.projectId = ProjectId
            self.AllCourseList.removeAll()
            self.getAllCourseList(isRefresh: false, likes: "")
        }
        vc.ProjectNameandSchoolName = {(ProjectName,SchoolName) in
            self.SchoolName = SchoolName
            self.ProjectName = ProjectName
           
            if self.SchoolName == "学校和企业" {
                self.SchoolName = "学校和企业\u{e607}"
            }
            if self.ProjectName == "项目" {
                self.ProjectName = "项目\u{e607}"
            }
            if SchoolName.isEmpty {
                self.btn_SchoolAndName.setTitle(self.btn_SchoolAndName.titleLabel?.text, for: .normal)
            }
            else {
                self.btn_SchoolAndName.setTitle(self.SchoolName, for: .normal)
            }
            if ProjectName.isEmpty {
                self.btn_project.setTitle(self.btn_project.titleLabel?.text, for: .normal)
            }
            else {
                self.btn_project.setTitle(self.ProjectName, for: .normal)
            }
        }
        
        vc.view.backgroundColor = UIColor(red: 0, green: 0, blue: 0, alpha: 0.2);
        self.navigationController?.pushViewController(vc, animated: true)
    }
}
