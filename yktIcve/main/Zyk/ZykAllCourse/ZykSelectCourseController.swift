//
//  ZykSelectCourseController.swift
//  云课堂2
//
//  Created by 志辉教育 on 2018/7/3.
//  Copyright © 2018年 zqyou. All rights reserved.
//

import UIKit
import SwiftyJSON
import Alamofire
extension ZykSelectCourseView{
    func getAllCourseList(isRefresh:Bool,likes:String){
        XLBallLoading.show(in: self.view)
        let dict = ["projectId": self.projectId,
                    "schollId":self.schollId,
                    "type":"",
                    "coursetype":self.type,
                    "page":self.page,
                    "likes":likes,
                    "token":Account.defaultAccount.token!] as [String : Any]
        Alamofire.request(ZYKAPI.course_getAllCourse, method: .post, parameters: dict, encoding: URLEncoding.default).responseJSON { response in
            if let value = response.result.value {
                XLBallLoading.hide(in: self.view)
                let json = JSON(value);
                if json["code"] == 1{
                    self.Coursetotal = json["total"].intValue
                    common.share.setTableFootView_noData(self.tableView, list: json["list"].arrayValue as NSArray)
                    for data in json["list"]{
                        let Allcourse = ZykAllCourseModel.init(json: data.1)
                        self.AllCourseList.append(Allcourse)
                    }
                    if(!isRefresh){
                        //结束刷新
                        self.tableView.mj_header.endRefreshing()
                        self.tableView.mj_footer.endRefreshing()
                    }
                    self.tableView.reloadData()
                }else{
                    ZKProgressHUD.showError(json["msg"].stringValue);
                }
            }else{
                ZKProgressHUD.showError("网络异常请稍后再试！");
                XLBallLoading.hide(in: self.view)
            }
        }
    }
}


