//
//  MyProfessionalView.swift
//  云课堂2
//
//  Created by 志辉教育 on 2018/7/2.
//  Copyright © 2018年 zqyou. All rights reserved.
//

import UIKit
import SwiftyJSON


@objc protocol MyProfessionalViewDategate{

    @objc optional func actionMore() -> ()
    @objc optional func returnId(Id:String,professionTitle:String) -> ()

}
class MyProfessionalView: UIView {
    @IBOutlet weak var labMore: UILabel!
    @IBOutlet weak var collectionView: UICollectionView!
    
    @IBOutlet weak var line: UILabel!
    var  MyProfessionalDetegate :MyProfessionalViewDategate!
    override init(frame: CGRect) {
        super.init(frame: frame)
        awakeFromNib()
    }
    var list = [JSON]()

    required init?(coder aDecoder: NSCoder) {
        fatalError("init(coder:) has not been implemented")
    }

    override func awakeFromNib() {
        super.awakeFromNib()

        let subView : UIView = Bundle.main.loadNibNamed("MyProfessionalView", owner: self, options: nil)?.first as! UIView
        subView.frame = self.frame
        self.addSubview(subView)
        self.setCollectionUI()
        let ges = UITapGestureRecognizer.init(target: self, action: #selector(self.actionMore))
        self.labMore.isUserInteractionEnabled = true
        self.labMore.addGestureRecognizer(ges)
    }
    override func layoutSubviews() {
        super.layoutSubviews()
        self.line.backgroundColor = UIColor.bg

    }

    func reloadCollectionView(r:JSON){
        self.list = r.arrayValue
        self.collectionView.reloadData()
    }

    @objc func actionMore(){
        self.MyProfessionalDetegate?.actionMore!()
    }
}

extension MyProfessionalView:UICollectionViewDelegate,UICollectionViewDataSource{

    func setCollectionUI(){
        self.collectionView.delegate = self
        self.collectionView.dataSource = self
        // 注册CollectionViewCell
        self.collectionView!.register(UINib(nibName:"MyProfessionalCell", bundle:nil),
                                      forCellWithReuseIdentifier: "myCell")
    }
    func collectionView(_ collectionView: UICollectionView, didSelectItemAt indexPath: IndexPath) {
           let d = self.list[indexPath.row]
        self.MyProfessionalDetegate?.returnId!(Id: d["Id"].stringValue,professionTitle:d["ProjectName"].stringValue)
    }

    func collectionView(_ collectionView: UICollectionView, numberOfItemsInSection section: Int) -> Int {
        return self.list.count
    }

    func collectionView(_ collectionView: UICollectionView, cellForItemAt indexPath: IndexPath) -> UICollectionViewCell {
        let cell = self.collectionView.dequeueReusableCell(withReuseIdentifier: "myCell", for:indexPath) as! MyProfessionalCell
        let d = self.list[indexPath.row]
        common.share.setSDImg(str:  d["ProImg"].stringValue , imgview: cell.imgView)
        cell.imgView.image = UIImage.init(named: "nocover.png")
        cell.lab_title.text = d["ProjectName"].stringValue
        cell.backgroundColor = UIColor.red
        return cell
    }
}
