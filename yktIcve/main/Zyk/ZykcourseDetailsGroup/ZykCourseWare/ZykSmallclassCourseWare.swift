//
//  ZykSmallclassCourseWare.swift
//  云课堂2
//
//  Created by 志辉教育 on 2018/7/5.
//  Copyright © 2018年 zqyou. All rights reserved.
//

import UIKit
import SwiftyJSON
import Alamofire
class ZykSmallclassCourseWare: UIViewController,UITableViewDelegate,UITableViewDataSource {
   
    @IBOutlet var tableView: UITableView!
    override func viewDidLoad() {
        super.viewDidLoad()
        // Do any additional setup after loading the view.
        self.setTableUI()
        let item = UIBarButtonItem(title: "返回", style: .plain, target: self, action: nil)
        self.isrefesh = true
        self.navigationItem.backBarButtonItem = item
    }
    init() {
        super.init(nibName: "ZykSmallclassCourseWare", bundle: nil)
    }
    required init?(coder aDecoder: NSCoder) {
        fatalError("init(coder:) has not been implemented")
    }
    func setTableUI(){
//        var ht = 0
//        if common.share.isX(){
//            ht = 30
//        }
//        self.tableView = UITableView.init(frame:  CGRect(x:0, y:0, width:self.view.bounds.width, height:self.view.bounds.height - 70 - CGFloat(ht)))
//        self.tableView.register(ZykMineCourseCell.self, forCellReuseIdentifier: "SwiftCell")
        self.tableView.delegate = self;
        self.tableView.dataSource = self;
        // 设置分割线的样式为None.
        self.tableView.tableFooterView = UIView(frame:CGRect.zero)//除去多余的cell
        self.tableView.separatorInset = UIEdgeInsets.zero;
        self.tableView.layoutMargins = UIEdgeInsets.zero;
        
        if #available(iOS 9.0, *) {
            self.tableView.cellLayoutMarginsFollowReadableWidth = false
        } else {
            // Fallback on earlier versions
        }
        self.view.addSubview(self.tableView);
        
    }
    
    func numberOfSections(in tableView: UITableView) -> Int {
        // #warning Incomplete implementation, return the number of sections
        return 1
    }
    
    func tableView(_ tableView: UITableView, numberOfRowsInSection section: Int) -> Int {
        // #warning Incomplete implementation, return the number of rows
        return courseList.count
    }
    func tableView(_ tableView: UITableView, heightForRowAt indexPath: IndexPath) -> CGFloat {
        return 52
    }
    func tableView(_ tableView: UITableView, cellForRowAt indexPath: IndexPath) -> UITableViewCell {
        self.tableView.register(UINib(nibName:"ZykSmallclassCourseWareCell", bundle:nil),
                                forCellReuseIdentifier:"ZykSmallclassCourseWareCell")
        let cell:ZykSmallclassCourseWareCell = tableView.dequeueReusableCell(withIdentifier: "ZykSmallclassCourseWareCell")
            as! ZykSmallclassCourseWareCell
        //去除点击cell变灰
        cell.selectionStyle = UITableViewCellSelectionStyle.none
        let json = self.courseList[indexPath.row]
        cell.setJSON(data: json)
        return cell
        
    }
    func tableView(_ tableView: UITableView, didSelectRowAt indexPath: IndexPath) {
        if !self.ishas{
            ZKProgressHUD.showMessage("必须参加学习后才能观看该课程资源！");
            return
        }
        let json = self.courseList[indexPath.row]
        self._ZykCourseKjModel?.cellType.cellId = json["Id"].stringValue
        self._ZykCourseKjModel?.cellType.courseOpenId = self.courseId
        self._ZykCourseKjModel?.cellType.cellName = json["CellType"].stringValue
        self._ZykCourseKjModel?.cellType.celltitle = json["Title"].stringValue
        self._ZykCourseKjModel?.cellType.resId = json["ResId"].stringValue
        self._ZykCourseKjModel?.cellType.isSmallclass = true
        self._ZykCourseKjModel?.cellType.type = json["ResType"].intValue
    }
    

    func getData(){
        let dict = ["courseId": self.courseId,
                    "type":2,
                    "token":Account.defaultAccount.token!] as [String : Any]
        Alamofire.request(ZYKAPI.course_courseChapter, method: .post, parameters: dict, encoding: URLEncoding.default).responseJSON { response in
            if let value = response.result.value {
                let json = JSON(value);
                if json["code"] == 1{
                    self.courseList.removeAll()
                    self.courseList = json["slist"].arrayValue
                    self.tableView.reloadData()
                }
            }
        }
    }
    
    override func didReceiveMemoryWarning() {
        super.didReceiveMemoryWarning()
        // Dispose of any resources that can be recreated.
    }
    
    /*
    // MARK: - Navigation

    // In a storyboard-based application, you will often want to do a little preparation before navigation
    override func prepare(for segue: UIStoryboardSegue, sender: Any?) {
        // Get the new view controller using segue.destinationViewController.
        // Pass the selected object to the new view controller.
    }
    */
    var isrefesh:Bool = false
    var isFirst:Bool = true
    var _ZykCourseKjModel: ZykCourseKjModel?
    lazy var ishas:Bool = false
    lazy var courseId : String = {return ""}()
    lazy var courseList = [JSON]()
}


