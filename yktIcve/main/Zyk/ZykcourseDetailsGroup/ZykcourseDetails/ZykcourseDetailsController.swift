//
//  ZykcourseDetailsController.swift
//  云课堂2
//
//  Created by cc on 2018/7/3.
//  Copyright © 2018年 zqyou. All rights reserved.
//

import UIKit
import Alamofire
import SwiftyJSON

extension ZykcourseDetailsView{
    //获取数据
    func getData(){
        XLBallLoading.show(in: self.view)
        let dict = ["courseId": self.courseId,
                    "type":self.type,
                    "token":Account.defaultAccount.token!] as [String : Any]
        Alamofire.request(ZYKAPI.course_courseChapter, method: .post, parameters: dict, encoding: URLEncoding.default).responseJSON { response in
            if let value = response.result.value {
                XLBallLoading.hide(in: self.view)
                let json = JSON(value);
                if json["code"] == 1{
                    common.share.setSDImg(str:json["course"]["Cover"].stringValue, imgview: self.img_cover)
                    self.IsHas(isHas: json["ishas"].intValue)
                    self.vc1.content = json["course"]["CourseDes"].stringValue
                    self.moduleList = json["slist"].arrayValue
                    if self.type == 1{
                       self.vc2.sentionTitles =  self.moduleList
                       self.vc2.isHas = json["ishas"].boolValue
                    }else{
                       self.vc3.courseList = self.moduleList
                       self.vc3.ishas = json["ishas"].boolValue
                    }
                    
                }else{
                    ZKProgressHUD.showError(json["msg"].stringValue);
                }
            }else{
                ZKProgressHUD.showError("网络异常请稍后再试！");
                XLBallLoading.hide(in: self.view)
            }
        }
    }
    //加入学习
    @objc func joinZYKCourse(_ btn :UIButton){
        let dict = ["courseId":self.courseId,
                    "token":Account.defaultAccount.token!]
        Alamofire.request(ZYKAPI.course_joinStudy, method: .post, parameters: dict, encoding: URLEncoding.default).responseJSON { response in
            if let value = response.result.value {
                let json = JSON(value)
                if json["code"] == 1{
                    ZKProgressHUD.showMessage("加入学习成功")
                    self.btn_join.setTitle("\u{e76c} 已参加学习", for: .normal)
                    self.btn_join.isEnabled = false
                    if self.type == 1{
                       self.vc2.isHas = true
                    }else{
                       self.vc3.ishas = true
                    }
                    if self.slideMenu?.currentIndex == 1 && self.type == 1{
                       self.vc2.tableview.reloadData()
                    }else if (self.slideMenu?.currentIndex == 1 && self.type == 2){
                       self.vc3.tableView.reloadData()
                    }
                    
                }else{
                    ZKProgressHUD.showMessage("网络异常请稍后再试！");
                }
            }else{
                ZKProgressHUD.showMessage("网络异常请稍后再试！");
            }
        }
    }

    
    //判断
    func IsHas(isHas:Int){
        if isHas == 1{
            self.btn_join.setTitle("\u{e76c} 已参加学习", for: .normal)
            self.btn_join.isEnabled = false
            if self.type == 1{
               self.vc2.isHas = true
            }else{
               self.vc3.ishas = true
            }
        }else{
            if self.type == 1{
                self.vc2.isHas = false
            }else{
                self.vc3.ishas = false
            }
            self.btn_join.setTitle("\u{e72e} 参加学习", for: .normal)
            self.btn_join.isEnabled = true
            
        }
    }

    
//    //监听跳转课件
//      @objc func courseKJ(course:NSNotification){
//        let dict = course.object as! Dictionary<String ,String>
//        let cellType = dict["cellType"]!
//        let cellName = dict["cellName"]!
//        switch cellType {
//        //（1.视频2.随堂检测3.讨论4.文档5.富文本6.知识点），
//          case "4":
//                switch cellName {
//                case "audio":
//                    self.getZykaudioResources(id: dict["Id"]!, cellTittle: dict["celltitle"]!)
//                case "flash":
//                    ZKProgressHUD.showMessage("该资源暂不支持手机查看，请从网页下载查看")
//                default:
//                    let vc = ZykPPT_Img_WordPreview()
//                    vc.docId = dict["Id"]!
//                    vc.courseId = dict["courseId"]!
//                    vc.isFromZykKj = true
//                    self.isPushed = true
//                    self.navigationController?.pushViewController(vc, animated: true)
//                }
//         
//            case "1":
//                let vc = videoPlayView()
//                vc.docId = dict["Id"]!
//                vc.courseOpenId = dict["courseId"]!
//                vc.IsFromZyk = true
//                vc.videotittle = dict["celltitle"]!
//                self.isPushed = true
//                self.navigationController?.pushViewController(vc, animated: true)
//
//            default:
//                ZKProgressHUD.showMessage("该资源暂不支持手机查看，请从网页下载查看")
//            }
//        
//    }
//   @objc func SmallClasscourseKJ(course:NSNotification){
//        let dict = course.object as! Dictionary<String ,String>
//        let cellType = dict["cellType"]!
//        let cellName = dict["cellName"]!
//        let cellTittle = dict["Title"]!
//        switch cellType {
//        //（1.视频2.随堂检测3.讨论4.文档5.富文本6.知识点），
//        case "4":
//            switch cellName {
//            case "audio":
//
//                self.getZykaudioResources(id: dict["Id"]!, cellTittle: cellTittle)
//                //self.navigationController?.pushViewController(vc, animated: true)
//            case "flash":
//                ZKProgressHUD.showMessage("该资源暂不支持手机查看，请从网页下载查看")
//            default:
//                let vc = ZykPPT_Img_WordPreview()
//                vc.docId = dict["Id"]!
//                vc.courseId = dict["courseId"]!
//                vc.isFromZykKj = true
//                self.isPushed = true
//               
//                self.navigationController?.pushViewController(vc, animated: true)
//            }
//       case "1":
//            let vc = videoPlayView()
//            vc.docId = dict["Id"]!  
//            vc.courseOpenId = dict["courseId"]!
//            vc.IsFromZyk = true
//            vc.videotittle = dict["Title"]!
//            self.isPushed = true
//            self.navigationController?.pushViewController(vc, animated: true)
//        
//        default:
//            ZKProgressHUD.showMessage("请前往网页下载查看")
//        }
//    }
//    
//    func getZykaudioResources(id:String,cellTittle:String){
//        XLBallLoading.show(in: self.view)
//        let dict = ["id": id,
//                    "courseId":self.courseId,
//                    "type":1,
//                    "token":Account.defaultAccount.token!] as [String : Any]
//        Alamofire.request(ZYKAPI.course_getVideo, method: .post, parameters: dict, encoding: URLEncoding.default).responseJSON { response in
//            if let value = response.result.value {
//                XLBallLoading.hide(in: self.view)
//                let json = JSON(value)
//                if json["code"] == 1{
//                    let vc = audioViewController()
//                    vc.audiourl = JSON.init(parseJSON: json["list"][0]["url"].stringValue)["urls"]["_360p"].stringValue
//                    vc.isNet = true
//                    vc.title = cellTittle
//                    vc.isAllowDownLoad = false
//                    vc.courseOpenId = self.courseId
//                    self.isPushed = true
//                    self.navigationController?.pushViewController(vc, animated: true)
//                }else{
//                    ZKProgressHUD.showError(json["msg"].stringValue);
//                }
//            }else{
//                XLBallLoading.hide(in: self.view)
//                ZKProgressHUD.showMessage("网络环境异常请稍后再试！")
//            }
//        }
//     
//    }
//    

    
    
}
