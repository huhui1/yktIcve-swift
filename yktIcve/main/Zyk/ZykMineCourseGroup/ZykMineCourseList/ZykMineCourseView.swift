//
//  ZykMineCourseView.swift
//  云课堂2
//
//  Created by cc on 2018/7/2.
//  Copyright © 2018年 zqyou. All rights reserved.
//

import UIKit
import SwiftyJSON

class ZykMineCourseView: UIViewController,UITableViewDelegate,UITableViewDataSource {

    override func viewDidLoad() {
        super.viewDidLoad()
        self.view.backgroundColor = UIColor.white
        self.navigationItem.titleView = self.segmented
       
        segmented.selectedSegmentIndex = 0
        segmented.addTarget(self, action: #selector(self.segmentChange(segmented:)), for: .valueChanged)
        self.setTableUI()
        self.getData(isRefresh: true)
        // Do any additional setup after loading the view.
    }

    override func didReceiveMemoryWarning() {
        super.didReceiveMemoryWarning()
        // Dispose of any resources that can be recreated.
    }
    func setTableUI(){
        var ht = 0
        if common.share.isX(){
            ht = 30
        }
        self.tableView = UITableView.init(frame:  CGRect(x:0, y:0, width:self.view.bounds.width, height:self.view.bounds.height - 70 - CGFloat(ht)))
        self.tableView.register(ZykMineCourseCell.self, forCellReuseIdentifier: "SwiftCell")
        self.tableView.delegate = self;
        self.tableView.dataSource = self;
        // 设置分割线的样式为None.
        self.tableView.separatorStyle = UITableViewCellSeparatorStyle.none
        self.tableView.tableFooterView = UIView(frame:CGRect.zero)//除去多余的cell
        self.tableView.separatorInset = UIEdgeInsets.zero;
        self.tableView.layoutMargins = UIEdgeInsets.zero;
        //下拉刷新相关设置,使用闭包Block
        self.tableView.mj_header = MJRefreshNormalHeader(refreshingBlock: {
            //重现生成数据
            self.getData(isRefresh: false)
        })
        
        if #available(iOS 9.0, *) {
            self.tableView.cellLayoutMarginsFollowReadableWidth = false
        } else {
            // Fallback on earlier versions
        }
        self.view.addSubview(self.tableView);
        
    }
    
    func numberOfSections(in tableView: UITableView) -> Int {
        // #warning Incomplete implementation, return the number of sections
        return 1
    }
    
    func tableView(_ tableView: UITableView, numberOfRowsInSection section: Int) -> Int {
        // #warning Incomplete implementation, return the number of rows
        if self.classState == 0{
            return unCompleteList.count
        }else{
            return CompleteList.count
        }    }
    
    func tableView(_ tableView: UITableView, heightForRowAt indexPath: IndexPath) -> CGFloat {
        return 105
    }
    func tableView(_ tableView: UITableView, cellForRowAt indexPath: IndexPath) -> UITableViewCell {
        let cell:ZykMineCourseCell = tableView.dequeueReusableCell(withIdentifier: "SwiftCell", for: indexPath) as! ZykMineCourseCell
        //去除点击cell变灰
        cell.selectionStyle = UITableViewCellSelectionStyle.none
        if classState == 0{
            let json = self.unCompleteList[indexPath.row]
            cell.setCell(data: json, state: classState)
            return cell
        }else{
            let json = self.CompleteList[indexPath.row]
            cell.progressBar.isHidden = true
            cell.lab_Progress.isHidden = true
            cell.setCell(data: json, state: classState)
            return cell
        }

    }
    func tableView(_ tableView: UITableView, didSelectRowAt indexPath: IndexPath) {
        if classState == 0{
            let json = self.unCompleteList[indexPath.row]
            let vc = ZykcourseDetailsView()
            vc.DetailsType = 2
            vc.type = self.type
            vc.courseId = json["id"].stringValue
            vc.courseTitle = json["title"].stringValue
            self.navigationController?.pushViewController(vc, animated: true)
        }else{
            let json = self.CompleteList[indexPath.row]
            let vc = ZykcourseDetailsView()
            vc.DetailsType = 2
            vc.type = self.type
            vc.courseTitle = json["title"].stringValue
            vc.courseId = json["id"].stringValue
            self.navigationController?.pushViewController(vc, animated: true)
        }
    }
    
    
    var tableView:UITableView!
    let segmented = UISegmentedControl(items: ["学习中","已完成"])
     lazy var classState:Int = 0//0：学习中,2：已完成
    lazy var unCompleteList : JSON =  {
        return []
    }()
    var type = 1
    lazy var CompleteList : JSON =  {
        return []
    }()
}
