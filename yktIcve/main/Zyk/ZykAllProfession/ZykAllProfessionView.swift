//
//  ZykAllProfessionView.swift
//  云课堂2
//  全部专业
//  Created by cc on 2018/7/3.
//  Copyright © 2018年 zqyou. All rights reserved.
//

import UIKit
import SwiftyJSON

class ZykAllProfessionView: UIViewController,UICollectionViewDelegate,UICollectionViewDataSource,CollectionReusableViewHeaderDelegate {

    override func viewDidLoad() {
        super.viewDidLoad()
        self.title = "全部项目"
        self.view.backgroundColor = UIColor.white
        self.setUICollectionView()
        self.getAllProfession()
        let item = UIBarButtonItem(title: "返回", style: .plain, target: self, action: nil)
        self.navigationItem.backBarButtonItem = item
        self.setUI()
        // Do any additional setup after loading the view.
    }

    override func didReceiveMemoryWarning() {
        super.didReceiveMemoryWarning()
        // Dispose of any resources that can be recreated.
    }
    
    func setUI(){
        
        if(UIDevice.current.model == "iPad"){
             ht = 200
        }else{
             ht = 155
        }
        self.imgView.frame = CGRect.init(x: 0, y: 0, width: width, height: CGFloat(ht))
        self.view.addSubview(self.imgView)
        self.imgView.image = UIImage.init(named: "AllProfession.jpg")
    }

    func setUICollectionView(){
        if(UIDevice.current.model == "iPad"){
            ht = 200
        }else{
            ht = 155
        }
        
        //collectionView尺寸样式设置
        let layout = UICollectionViewFlowLayout()
        //间隙设置
        layout.minimumLineSpacing = 0
        layout.minimumInteritemSpacing = 0
        layout.headerReferenceSize = CGSize.init(width: width, height: 30)
        layout.footerReferenceSize = CGSize.init(width: width, height: 20)
        //横向滚动
        layout.scrollDirection = .vertical
        layout.itemSize = CGSize.init(width:width / 3, height:110)
        let c = CGRect.init(x: 0, y: CGFloat(ht), width:width, height: height - CGFloat(ht))
        //collectionView初始化
        collectionView = UICollectionView(frame:c ,
                                          collectionViewLayout: layout)
        collectionView.backgroundColor = UIColor.white
        
        collectionView.delegate = self
        collectionView.dataSource = self
        collectionView.isPagingEnabled = true
        collectionView.backgroundColor = UIColor.clear
        self.collectionView.autoresizingMask = .flexibleHeight
        collectionView.register(ZykAllProfessionCollectionViewCell.self, forCellWithReuseIdentifier: "ZykAllProfessionCollectionViewCell")
        // 注册一个headView
        self.collectionView!.register(CollectionReusableViewHeader.self, forSupplementaryViewOfKind:UICollectionElementKindSectionHeader, withReuseIdentifier: headerIdentifier)

        // 注册一个footView
        self.collectionView!.register(CollectionReusableViewFooter.self, forSupplementaryViewOfKind:UICollectionElementKindSectionFooter, withReuseIdentifier: footerIdentifier)
        
        self.view.addSubview(collectionView)

    }
    

    //获取分区数
     func numberOfSections(in collectionView: UICollectionView) -> Int {
        return self.list.count
    }


    //分区的header与footer
    func collectionView(_ collectionView: UICollectionView,
                                 viewForSupplementaryElementOfKind kind: String,
                                 at indexPath: IndexPath) -> UICollectionReusableView {
       var reusableview:UICollectionReusableView!

        if kind == UICollectionElementKindSectionHeader
        {
            let projectName = ["国家项目","校级项目","学会项目","企业项目","省级项目",""]
            reusableview = collectionView.dequeueReusableSupplementaryView(ofKind: kind, withReuseIdentifier: headerIdentifier, for: indexPath) as! CollectionReusableViewHeader

            (reusableview as! CollectionReusableViewHeader).lab_gov.text = projectName[indexPath.section]
            (reusableview as! CollectionReusableViewHeader).delegate = self
            (reusableview as! CollectionReusableViewHeader)._index = indexPath.section
             (reusableview as! CollectionReusableViewHeader).btn_Unfold.isSelected = self.list[indexPath.section].isUnfold
        }else if kind == UICollectionElementKindSectionFooter
        {
            reusableview = collectionView.dequeueReusableSupplementaryView(ofKind: kind, withReuseIdentifier: footerIdentifier, for: indexPath) as! CollectionReusableViewFooter

        }


        return reusableview
    }
    func collectionView(_ collectionView: UICollectionView, cellForItemAt indexPath: IndexPath) -> UICollectionViewCell {
        let cell = collectionView.dequeueReusableCell(withReuseIdentifier: "ZykAllProfessionCollectionViewCell", for: indexPath) as! ZykAllProfessionCollectionViewCell
        let json = self.list[indexPath.section].list[indexPath.row]
        cell.lab_Name.text = json["ProjectName"].stringValue
        common.share.setSDImg(str: json["ProImg"].stringValue, imgview: cell.imgView)
        return cell
    }
    func collectionView(_ collectionView: UICollectionView, numberOfItemsInSection section: Int) -> Int {
        return  self.list[section].isUnfold ? self.list[section].list.count :0
    }
    func collectionView(_ collectionView: UICollectionView, didSelectItemAt indexPath: IndexPath) {
        let json = self.list[indexPath.section].list[indexPath.row]
        let vc = ZykProfessionDetailsView()
        vc.Id = json["Id"].stringValue
        vc.ProjectName = json["ProjectName"].stringValue
        self.navigationController?.pushViewController(vc, animated: true)
    }

    func  ReturnIsUnfold(_ isfold: Bool, _index: Int) {
        self.list[_index].isUnfold = isfold
        self.collectionView.reloadData()
    }
    let width = UIScreen.main.bounds.width
    let height = UIScreen.main.bounds.height
   
    //用来放置各个图片单元
    var collectionView:UICollectionView!
    lazy var imgView : UIImageView = {
        let view = UIImageView()
        return view
    }()
    var list = [ProfessionModel]()
    var ht = 0
}
