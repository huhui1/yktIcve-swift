//
//  AccountView.swift
//  云课堂2
//
//  Created by 志辉教育 on 2018/7/27.
//  Copyright © 2018年 zqyou. All rights reserved.
//

import UIKit

class AccountView: UIView,UITextFieldDelegate {

    @IBOutlet var textView: UIView!
    @IBOutlet var Login: UIButton!
    @IBOutlet var iconfontscanLogin: UIButton!
    @IBOutlet var iconfontRememberPassword: UIButton!
    @IBOutlet var Password: UITextField!
    @IBOutlet var UserName: UITextField!
    var loginViewModel: loginViewModel!
    var toolBar = UIToolbar();
     init(viewModel: loginViewModel,frame: CGRect) {
        super.init(frame: frame)
        loginViewModel = viewModel
        awakeFromNib()
    }
    
    required init?(coder aDecoder: NSCoder) {
        fatalError("init(coder:) has not been implemented")
    }
    
    override func awakeFromNib() {
        super.awakeFromNib()
        let subView : UIView = Bundle.main.loadNibNamed("AccountView", owner: self, options: nil)?.first as! UIView
        subView.frame = self.frame
        self.addSubview(subView)
        self.UserName.delegate = self
        self.Password.delegate = self
        self.UserName.clearButtonMode = .whileEditing
        self.Password.clearButtonMode = .whileEditing
        self.settoolBar()
        self.setRemember()
        
    }
    
    //设置记住密码
    func setRemember(){
       // self.iconfontRememberPassword.isUserInteractionEnabled = false
            if Account.defaultAccount.number != nil{
                self.UserName.text = Account.defaultAccount.number
            }
        if Account.defaultAccount.isRememberThepassword != nil {
            if Account.defaultAccount.isRememberThepassword!{
                if Account.defaultAccount.password != nil{
                    self.Password.text = Account.defaultAccount.password
                }
                self.iconfontRememberPassword.isSelected = true
                self.iconfontRememberPassword.setAttributedTitle(shezhiSelected(str: "\u{e6dc}", colorStr: 0xFFFFFF), for: .normal)
            }else{
                self.iconfontRememberPassword.isSelected = false
                self.iconfontRememberPassword.setAttributedTitle(shezhiUnSelected(str: "\u{e6dc}", colorStr: 0x28ac86), for: .normal)
            }
        }
    }
    @objc func DoneClick(){
           self.endEditing(true)
    }
    
    func settoolBar(){
        toolBar = common.share.AddToolKeyboardDoneBar()
        let doneButton = UIBarButtonItem(title: "确定", style: .plain, target: self, action: #selector(self.DoneClick));
        let spaceButton = UIBarButtonItem(barButtonSystemItem: .flexibleSpace, target: nil, action: nil)
        toolBar.setItems([spaceButton,doneButton], animated: false);
    }
    
    func  textFieldShouldBeginEditing(_ textField: UITextField) -> Bool {
        textField.inputAccessoryView = toolBar
        return true
    }
    //设置字体图标和边框
    override func layoutSubviews() {
    
        if self.iconfontRememberPassword.isSelected{
            self.iconfontRememberPassword.setAttributedTitle(shezhiSelected(str: "\u{e6dc}", colorStr: 0xFFFFFF), for: .normal)
        }else{
            self.iconfontRememberPassword.setAttributedTitle(shezhiUnSelected(str: "\u{e6dc}", colorStr: 0x28ac86), for: .normal)
        }
        self.Login.layer.borderColor = UIColor.colorWithHex(hexColor: 0x32bd73).cgColor
        self.Login.layer.borderWidth = 2

        self.iconfontscanLogin.titleLabel?.font = UIFont(name: "iconfont", size: 15);
        self.iconfontscanLogin.setTitle("\u{e6c0}", for: .normal)
    }
    //字体图标
    func shezhiSelected(str:String, colorStr:Int64) -> NSAttributedString{
        let attributeString = NSMutableAttributedString(string:str)
        attributeString.addAttribute(NSAttributedStringKey.foregroundColor, value: UIColor.bg,
                                     range: NSMakeRange(0,1))
        attributeString.addAttribute(NSAttributedStringKey.backgroundColor, value: UIColor.colorWithHex(hexColor: colorStr), range: NSMakeRange(0,1))
        attributeString.addAttribute(NSAttributedStringKey.font, value: UIFont.init(name: "iconfont", size: 20)!, range: NSMakeRange(0,1))
        return attributeString
    }

    func shezhiUnSelected(str:String, colorStr:Int64) -> NSAttributedString{
        let attributeString = NSMutableAttributedString(string:str)
        attributeString.addAttribute(NSAttributedStringKey.foregroundColor, value: UIColor.colorWithHex(hexColor: 0xf2f2f2),
                                     range: NSMakeRange(0,1))
        attributeString.addAttribute(NSAttributedStringKey.backgroundColor, value: UIColor.colorWithHex(hexColor: colorStr), range: NSMakeRange(0,1))
        attributeString.addAttribute(NSAttributedStringKey.font, value: UIFont.init(name: "iconfont", size: 20)!, range: NSMakeRange(0,1))
        return attributeString
    }
    //扫码登录
    @IBAction func ScanLogin(_ sender: UIButton) {
        let vc = qrcodeViewController()
        vc.isRegister = true
        vc.modalTransitionStyle = .crossDissolve
        NavigatorService.modelToPage(vc, animated: true, completion: {})
    }

    //忘记密码
    @IBAction func ForgotPassword(_ sender: UIButton) {
        print("------忘记密码-----")
        let vc = ResetPasswordView()
        vc.modalTransitionStyle = .crossDissolve
        NavigatorService.modelToPage(vc, animated: true, completion: {})
      
    }
    //记住密码
    @IBAction func RememberPassword(_ sender: UIButton) {
        if sender.tag == 5{
            sender.isSelected = self.iconfontRememberPassword.isSelected
            sender.isSelected = !sender.isSelected
            self.iconfontRememberPassword.isSelected = sender.isSelected
        }else{
            sender.isSelected = !sender.isSelected
            self.iconfontRememberPassword.isSelected = sender.isSelected
        }
        if self.iconfontRememberPassword.isSelected{
            self.iconfontRememberPassword.setAttributedTitle(shezhiSelected(str: "\u{e6dc}", colorStr: 0xFFFFFF), for: .normal)
        }else{
            self.iconfontRememberPassword.setAttributedTitle(shezhiUnSelected(str: "\u{e6dc}", colorStr: 0x28ac86), for: .normal)
        }
        
    }
    //登录
    @IBAction func Login(_ sender: UIButton) {
        loginViewModel.login(userName: self.UserName.text!, userPassword: self.Password.text!, isRememberpassword: self.iconfontRememberPassword.isSelected)
            if !self.iconfontRememberPassword.isSelected{
                self.Password.text?.removeAll()
            }

    }
}
