//
//  cachePreviewDocView.swift
//  云课堂职教云
//
//  Created by 尤增强 on 2018/5/12.
//  Copyright © 2018年 jcjy. All rights reserved.
//

import UIKit
import WebKit
class cachePreviewImgView:UIViewController,UIScrollViewDelegate {

    var lastScale:CGFloat = 1
    var SCALE_MAX:CGFloat = 3
    var SCALE_MIN:CGFloat = 1

    fileprivate  let height = UIScreen.main.bounds.height;
    override func viewDidLoad() {
        super.viewDidLoad()

        self.view.backgroundColor = UIColor.colorWithHex(hexColor: 0xf2f2f2)
        self.setUI()
        // Do any additional setup after loading the view.
    }

    fileprivate func setUI(){


        self.view.addSubview(self.imgview)


        self.imgview.image =  UIImage(contentsOfFile: self.file)
        self.imgview.frame = self.view.frame
        self.imgview.center = self.view.center
        self.imgview.contentMode = .scaleAspectFit
        self.imgview.isUserInteractionEnabled = true
        let pan = UIPanGestureRecognizer(target: self,action: #selector(self.mobile(_:)))
         let PinchGesture = UIPinchGestureRecognizer.init(target: self, action: #selector(self.shrink(_:)));
        self.imgview.addGestureRecognizer(pan)
         self.imgview.addGestureRecognizer(PinchGesture)
//        let imageTapGesture = UITapGestureRecognizer.init(target: self, action: #selector(self.touch_image(sender:)));
//        self.imgview.addGestureRecognizer(imageTapGesture);

    }


    @objc func mobile(_ sender: UIPanGestureRecognizer) {
        let translate = sender.translation(in: self.view)

        //平移后的位置
        var centerX = self.imgview.center.x + translate.x
        var centerY = self.imgview.center.y + translate.y
        boundCenter(centerX: &centerX, centerY: &centerY)
        self.imgview.center = CGPoint(x:centerX,y:centerY)

        sender.setTranslation(CGPoint.zero, in: self.view)

    }

//    @objc func touch_image(sender: UITapGestureRecognizer) {
//        self.presentingViewController?.dismiss(animated: false, completion: nil)
//
//    }
    @objc func shrink(_ sender: UIPinchGestureRecognizer) {

        lastScale *= sender.scale

        //禁止过大过小
        if lastScale > SCALE_MAX {
            lastScale = SCALE_MAX
        }else if lastScale < SCALE_MIN {
            lastScale = SCALE_MIN
        }

        self.imgview.transform = self.view.transform.scaledBy(x: lastScale,y: lastScale)
        sender.scale = 1

        //平移后的位置
        var centerX =  self.imgview.center.x
        var centerY =  self.imgview.center.y
        boundCenter(centerX: &centerX, centerY: &centerY)
        self.imgview.center = CGPoint(x:centerX,y:centerY)
    }

    // 限制iamgeView中心的位置
    //当图片大于屏幕时,平移图片时防止平移过头
    func boundCenter( centerX:inout CGFloat, centerY:inout CGFloat){
        let mainFrame = self.view.frame
        let imageFrame = self.imgview.frame

        if imageFrame.width < mainFrame.width {
            centerX = mainFrame.width / 2
        }else{
            let xMin = mainFrame.width - imageFrame.size.width / 2
            let xMax = imageFrame.size.width / 2
            if centerX > xMax {
                centerX = xMax
            }else if centerX < xMin {
                centerX = xMin
            }
        }

        if imageFrame.height < mainFrame.height {
            centerY = mainFrame.height  / 2
        }else{
            let yMin = mainFrame.height - imageFrame.size.height / 2
            let yMax = imageFrame.size.height  / 2
            if centerY > yMax {
                centerY = yMax
            }else if centerY < yMin {
                centerY = yMin
            }
        }
    }

    override func didReceiveMemoryWarning() {
        super.didReceiveMemoryWarning()
        // Dispose of any resources that can be recreated.
    }

    lazy var file :String = {
        return "";
    }()

    fileprivate lazy var Scroll :UIScrollView = {
        var so = UIScrollView()
        return so;
    }()

    fileprivate lazy var imgview :UIImageView = {
        var img = UIImageView()
        return img;
    }()


    /*
    // MARK: - Navigation

    // In a storyboard-based application, you will often want to do a little preparation before navigation
    override func prepare(for segue: UIStoryboardSegue, sender: Any?) {
        // Get the new view controller using segue.destinationViewController.
        // Pass the selected object to the new view controller.
    }
    */

}
