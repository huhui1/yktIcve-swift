//
//  MineInfoView.swift
//  云课堂2
//
//  Created by cc on 2018/6/20.
//  Copyright © 2018年 zqyou. All rights reserved.
//

import UIKit
import RxSwift
import RxCocoa
import SCLAlertView

class MineInfoView: UIViewController {
    let disposeBag = DisposeBag()
    var myNews : myNewsModel?
    override func viewDidLoad() {
        super.viewDidLoad()
       
        self.title = "我的消息"
        self.setTableView()
     
        let Item = UIBarButtonItem.init(title: "\u{e74a}", style: UIBarButtonItemStyle.plain, target: self, action: #selector(self.allIsRead));
        self.navigationItem.rightBarButtonItem = Item
        common.share.setdeleteButtonItem(item: Item)
        let item = UIBarButtonItem(title: "返回", style: .plain, target: self, action: nil)
        self.navigationItem.backBarButtonItem = item
       
        // Do any additional setup after loading the view.
    }

    override func didReceiveMemoryWarning() {
        super.didReceiveMemoryWarning()
        // Dispose of any resources that can be recreated.
    }
    func setTableView(){
        self.tableView = UITableView.init(frame:  CGRect(x:0, y:0, width:width, height:height - 60))
        
        self.tableView.register(MineInfoTableViewCell.self, forCellReuseIdentifier: "SwiftCell")
        //除去多余的cell
        tableView.tableFooterView = UIView(frame:CGRect.zero)
        tableView.separatorInset = UIEdgeInsets.zero;
        tableView.layoutMargins = UIEdgeInsets.zero;
        //去除cell线
        self.tableView.separatorStyle = UITableViewCellSeparatorStyle.none
        self.tableView.backgroundColor = UIColor.colorWithHex(hexColor: 0xf9f9f9)
        //设置头部刷新控件
        self.tableView.mj_header = MJRefreshNormalHeader()
        //设置尾部刷新控件
        self.tableView.mj_footer = MJRefreshBackNormalFooter()
        //ipad
        if #available(iOS 9.0, *) {
            tableView.cellLayoutMarginsFollowReadableWidth = false
        } else {
            
        }
        self.view.addSubview(tableView)
        
        let parmes = ["userId":Account.defaultAccount.id!,
                    "userType":self.userType,
                    "pageNum":self.page] as [String : Any]
        //初始化ViewModel
        let viewModel = newsListViewModel(
            input: (
                headerRefresh: self.tableView.mj_header.rx.refreshing.asObservable() ,
                footerRefresh: self.tableView.mj_footer.rx.refreshing.asObservable()),
            dependency: (
                disposeBag: self.disposeBag,
                networkService: NetworkService()), parmes: parmes )
        
        //单元格数据的绑定
        viewModel.tableData
            .bind(to: tableView.rx.items) { (tableView, row, element) in
                let indexPath = IndexPath(row: row, section: 0)
                let cell:MineInfoTableViewCell = tableView.dequeueReusableCell(withIdentifier: "SwiftCell", for: indexPath) as! MineInfoTableViewCell
                return cell
            }
            .disposed(by: disposeBag)
        
        //下拉刷新状态结束的绑定
        viewModel.endHeaderRefreshing
            .bind(to: self.tableView.mj_header.rx.endRefreshing)
            .disposed(by: disposeBag)
        
        //上拉刷新状态结束的绑定
        viewModel.endFooterRefreshing
            .bind(to: self.tableView.mj_footer.rx.endRefreshing)
            .disposed(by: disposeBag)
    }
    

//    func tableView(_ tableView: UITableView, cellForRowAt indexPath: IndexPath) -> UITableViewCell {
//        let cell:MineInfoTableViewCell = tableView.dequeueReusableCell(withIdentifier: "SwiftCell", for: indexPath) as! MineInfoTableViewCell
//        let data = self.list[indexPath.row]
//        cell.setData(Info: data)
//        return cell
//    }
//    func tableView(_ tableView: UITableView, didSelectRowAt indexPath: IndexPath) {
//        let data = self.list[indexPath.row]
//        self.lookNews(Id: data.Id, Newsmodel: data)
//        let alert = SCLAlertView()
//        alert.addButton("确定") {
//            //学生or老师
//            if data.UserType == "1"{
//                //作业or考试
//                if data.NewsType == 1{
//                    if(data.HwOrExamZtway == 6){
//                        ZKProgressHUD.showMessage("此作业直接由老师打分，无需作答")
//                        return
//                    }else{
//                        //学生作业列表
//                        let vc = stuRecordView()
//                        vc.openClassId = data.openClassId
//                        vc.courseOpenId = data.courseOpenId
//                        vc.homeWorkId = data.HwOrExamId
//                        vc.homeworkTermTimeId = data.HwOrExamTermTimeId
//                        vc.ztWay = data.HwOrExamZtway
//                        self.navigationController?.pushViewController(vc, animated: true)
//                    }
//                }else{
//                    if(data.HwOrExamZtway == 6){
//                        ZKProgressHUD.showMessage("登分考试暂不支持手机端查看!")
//                        return
//                    }else{
//                        //学生考试
//                        let vc = stuExaminationHandleView()
//                        vc.openClassId = data.openClassId
//                        vc.courseOpenId = data.courseOpenId
//                        vc.examId = data.HwOrExamId
//                        vc.examTermTimeId = data.HwOrExamTermTimeId
//                        self.navigationController?.pushViewController(vc, animated: true)
//                    }
//                }
//            }else{
//                if data.NewsType == 1{
//                    //老师作业列表
//                    if data.HwOrExamZtway != 6{
//                        let vc = HomeworkReviewListView()
//                        vc.openClassId = data.openClassId
//                        vc.courseOpenId = data.courseOpenId
//                        vc.homeworkTermTimeId = data.HwOrExamTermTimeId
//                        vc.homeWorkId = data.HwOrExamId
//                        vc.ztWay = data.HwOrExamZtway
//                        self.navigationController?.pushViewController(vc, animated: true)
//                    }else{
//                        //登分作业
//                        let vc = HomeworkMakeScoreListView()
//                        vc.openClassId = data.openClassId
//                        vc.courseOpenId = data.courseOpenId
//                        vc.homeworkTermTimeId = data.HwOrExamTermTimeId
//                        vc.homeWorkId = data.HwOrExamId
//                        vc.homeworkTitle = data.HwOrExamTitle
//                        self.navigationController?.pushViewController(vc, animated: true)
//                    }
//                }else{
//                    //老师考试列表
//                    if data.HwOrExamZtway != 6{
//                        let vc = examReviewView()
//                        vc.openClassId = data.openClassId
//                        vc.courseOpenId = data.courseOpenId
//                        vc.examId = data.HwOrExamId
//                        vc.examTermTimeId = data.HwOrExamTermTimeId
//                        vc.examTitle = data.HwOrExamTitle
//                        self.navigationController?.pushViewController(vc, animated: true)
//                    }else{
//                        //登分考试
//                        let vc = examMakeScoreView()
//                        vc.openClassId = data.openClassId
//                        vc.courseOpenId = data.courseOpenId
//                        vc.examId = data.HwOrExamId
//                        vc.examTermTimeId = data.HwOrExamTermTimeId
//                        vc.examTitle = data.HwOrExamTitle
//                        self.navigationController?.pushViewController(vc, animated: true)
//                    }
//                }
//            }
//        }
//        alert.showTitle(data.HwOrExamTitle, subTitle: data.Content,timeout: nil, completeText: "取消", style: .info,colorStyle: 0xffae3e, colorTextButton:0xFFFFFF,circleIconImage: UIImage(named: "news.png"),animationStyle: .topToBottom)
//    }
    
    let width = UIScreen.main.bounds.width
    let height = UIScreen.main.bounds.height
    
    var list  = [NewsModel]()
    var tableView:UITableView!
    var userType:String = ""
    var page = 1
    var NewsListCount = 0
}



