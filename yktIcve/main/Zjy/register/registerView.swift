//
//  registerView.swift
//  66iclasscloud
//
//  Created by 尤增强 on 2018/2/7.
//  Copyright © 2018年 zqy. All rights reserved.
//

import UIKit
import SwiftyJSON
import Alamofire

class registerView: UIViewController,UITextFieldDelegate {
    private var countdownTimer: Timer?
    let codeBtn = UIButton(frame:CGRect(x: 0,y:0,width:120,height:40))
    private var remainingSeconds: Int = 0 {
        willSet {
            codeBtn.setTitle("重新获取\(newValue)秒", for: .normal)
            
            if newValue <= 0 {
                codeBtn.setTitle("获取验证码", for: .normal)
                isCounting = false
            }
        }
    }
    var isCounting = false {
        willSet {
            if newValue {
                countdownTimer = Timer.scheduledTimer(timeInterval: 1, target: self, selector: #selector(self.updateTime), userInfo: nil, repeats: true)
                
                remainingSeconds = 100
            } else {
                countdownTimer?.invalidate()
                countdownTimer = nil
            }
            
            codeBtn.isEnabled = !newValue
        }
    }
    @objc private func updateTime() {
        remainingSeconds -= 1
    }

    override func viewDidLoad() {
        super.viewDidLoad()
        self.title = "注册"
        self.view.backgroundColor = UIColor.bg
      
        // Do any additional setup after loading the view.
        self.setUI()
        self.userNameText.delegate = self
        self.studentIdText.delegate = self
        self.phoneText.delegate = self
        self.qqText.delegate = self
        self.emailText.delegate = self
        self.codeText.delegate = self
        
        //监听键盘弹出通知
        NotificationCenter.default
            .addObserver(self,selector: #selector(keyboardWillShow(_:)),
                         name: NSNotification.Name.UIKeyboardWillShow, object: nil)
        //监听键盘隐藏通知
        NotificationCenter.default
            .addObserver(self,selector: #selector(keyboardWillHide(_:)),
                         name: NSNotification.Name.UIKeyboardWillHide, object: nil)
    }

    override func didReceiveMemoryWarning() {
        super.didReceiveMemoryWarning()
        // Dispose of any resources that can be recreated.
    }
    //去除一进来键盘的显示
    override func viewDidAppear(_ animated: Bool) {
        self.isfrist = false
        doneClick()
    }
    // 键盘显示
   @objc  func keyboardWillShow(_ notification: Notification) {
        if(!self.isfrist){
        let userInfo = (notification as NSNotification).userInfo!
        //键盘尺寸
        let keyboardSize = (userInfo[UIKeyboardFrameBeginUserInfoKey]
            as! NSValue).cgRectValue
        var contentInsets:UIEdgeInsets
        
        contentInsets = UIEdgeInsetsMake(100.0, 0.0, (keyboardSize.height), 0.0);

        self.view.frame = CGRect.init(x:0, y: -100, width:self.view.bounds.width, height: self.view.bounds.height);
        }
    }
    
    // 键盘隐藏
   @objc  func keyboardWillHide(_ notification: Notification) {
//        let contentInsets:UIEdgeInsets = UIEdgeInsetsMake(64.0, 0.0, 0, 0.0);

         self.view.frame = CGRect.init(x:0, y: 0, width:self.view.bounds.width, height: self.view.bounds.height);
    }
    
    //键盘隐藏
    override func touchesEnded(_ touches: Set<UITouch>, with event: UIEvent?) {
        self.view.endEditing(true)
        
    }
    
    
    func setUI(){
        //键盘
        toolBar = common.share.AddToolKeyboardDoneBar()
        let doneButton = UIBarButtonItem(title: "确定", style: .plain, target: self, action: #selector(self.doneClick));
        let spaceButton = UIBarButtonItem(barButtonSystemItem: .flexibleSpace, target: nil, action: nil)
        toolBar.setItems([spaceButton,doneButton], animated: false);
        
        self.view.addSubview(self.backView)
        self.backView.addSubview(back)
        self.backView.addSubview(reset)
        self.view.addSubview(inviterLabel)
        self.view.addSubview(inviter)
        self.view.addSubview(userNameLabel)
        self.view.addSubview(userNameText)
        self.view.addSubview(studentIdLabel)
        self.view.addSubview(studentIdText)
        self.view.addSubview(phoneLabel)
        self.view.addSubview(phoneText)
        self.view.addSubview(qqLabel)
        self.view.addSubview(qqText)
        self.view.addSubview(emailLabel)
        self.view.addSubview(emailText)
        self.view.addSubview(registBtn)
        self.view.addSubview(codeLable)
        self.view.addSubview(codeText)
        
        self.backView.snp.makeConstraints { (make) in
            make.width.equalTo(width)
            make.height.equalTo(40)
            make.top.equalTo(30)
        }
        self.back.snp.makeConstraints { (make) in
            make.width.equalTo(60)
            make.height.equalTo(20)
            make.left.equalTo(20)
            make.top.equalTo(15)
            make.centerY.equalTo(self.backView.snp.centerY)
        }
        self.back.addTarget(self, action: #selector(self.backLogin), for: .touchUpInside)
        self.reset.snp.makeConstraints { (make) in
            make.width.equalTo(80)
            make.left.equalTo(width/2-50)
            make.centerY.equalTo(self.backView.snp.centerY)
        }
        self.inviterLabel.snp.makeConstraints { (make) in
            make.width.equalTo(65)
            make.height.equalTo(40)
            make.right.equalTo(self.inviter.snp.left)
            make.centerY.equalTo(self.inviter)
        }
        self.inviterLabel.text  = "邀请人"
        self.inviterLabel.textAlignment = .center
        
        self.inviter.snp.makeConstraints { (make) in
            make.width.equalTo(width*0.68)
            make.height.equalTo(40)
            make.top.equalTo(80)
            make.centerX.equalTo(self.view.snp.centerX).offset(32.5)
        }
        self.inviter.text = self.data["teacherName"].string
        self.userNameText.snp.makeConstraints{ (make) in
            make.width.height.equalTo(self.inviter)
            make.centerX.equalTo(self.inviter.snp.centerX)
            make.top.equalTo(self.inviter.snp.bottom).offset(10)
           
        }
        self.userNameLabel.snp.makeConstraints { (make) in
            make.width.height.equalTo(self.inviterLabel)
            make.right.equalTo(self.userNameText.snp.left)
            make.centerY.equalTo(self.userNameText)
        }
        self.userNameLabel.text = "姓名"
        self.userNameLabel.textAlignment = NSTextAlignment.center
        
        self.studentIdLabel.snp.makeConstraints { (make) in
            make.width.height.equalTo(self.inviterLabel)
            make.right.equalTo(self.studentIdText.snp.left)
            make.centerY.equalTo(self.studentIdText)

        }
        if(self.inviteType == 1){
            self.studentIdLabel.text = "工号"
        }else{
            self.studentIdLabel.text = "学号"
        }
        self.studentIdLabel.textAlignment = NSTextAlignment.center
        self.studentIdText.snp.makeConstraints{ (make) in
            make.width.height.equalTo(self.inviter)
            make.centerX.equalTo(self.inviter.snp.centerX)
            make.top.equalTo(self.userNameText.snp.bottom).offset(10)
        }
        if(self.inviteType == 1){
            self.studentIdText.placeholder = "请输入你的工号"
        }else{
            self.studentIdText.placeholder = "请输入你的学号"
        }
       
        self.qqLabel.snp.makeConstraints { (make) in
            make.width.height.equalTo(self.userNameLabel)
            make.centerX.equalTo(self.inviterLabel.snp.centerX)
            make.top.equalTo(self.studentIdLabel.snp.bottom).offset(10)

        }
        self.qqLabel.text = "QQ"
        self.qqLabel.textAlignment = NSTextAlignment.center
        self.qqText.snp.makeConstraints{ (make) in
            make.width.height.equalTo(self.inviter)
            make.centerX.equalTo(self.inviter.snp.centerX)
            make.top.equalTo(self.studentIdText.snp.bottom).offset(10)
        }
        self.emailLabel.snp.makeConstraints { (make) in
            make.width.height.equalTo(self.inviterLabel)
            make.centerX.equalTo(self.inviterLabel.snp.centerX)
            make.top.equalTo(self.qqLabel.snp.bottom).offset(10)

        }
        self.emailLabel.text = "Email"
        self.emailLabel.textAlignment = NSTextAlignment.center
        self.emailText.snp.makeConstraints{ (make) in
            make.width.height.equalTo(self.inviter)
            make.centerX.equalTo(self.qqText.snp.centerX)
            make.top.equalTo(self.qqText.snp.bottom).offset(10)
        }
        self.phoneLabel.snp.makeConstraints { (make) in
            make.width.height.equalTo(self.userNameLabel)
            make.centerX.equalTo(self.inviterLabel.snp.centerX)
            make.top.equalTo(self.emailLabel.snp.bottom).offset(10)
            
        }
        self.phoneLabel.text = "手机"
        self.phoneLabel.textAlignment = NSTextAlignment.center
        self.phoneText.snp.makeConstraints{ (make) in
            make.width.height.equalTo(self.inviter)
            make.centerX.equalTo(self.inviter.snp.centerX)
            make.top.equalTo(self.emailText.snp.bottom).offset(10)
        }
        self.codeLable.snp.makeConstraints { (make) in
            make.width.height.equalTo(self.userNameLabel)
            make.centerX.equalTo(self.inviterLabel.snp.centerX)
            make.top.equalTo(self.phoneLabel.snp.bottom).offset(10)
            
        }
        self.codeLable.text = "验证码"
        self.codeLable.textAlignment = NSTextAlignment.center
        self.codeText.snp.makeConstraints{ (make) in
            make.width.height.equalTo(self.inviter)
            make.centerX.equalTo(self.inviter.snp.centerX)
            make.top.equalTo(self.phoneText.snp.bottom).offset(10)
        }
        
        codeBtn.backgroundColor = UIColor.colorWithHex(hexColor: 0xa4fae2)
        codeBtn.titleLabel?.textAlignment = .center
        codeBtn.titleLabel?.font = UIFont.init(name: "iconfont", size: 15)
        codeBtn.setTitleColor(UIColor.gray, for: .normal)
        codeBtn.setTitle("获取验证码", for: .normal)
        self.codeText.rightView = codeBtn
        self.codeText.rightViewMode = UITextFieldViewMode.always
        codeBtn.addTarget(self, action: #selector(self.getCode), for: .touchUpInside)
        
        
        self.registBtn.snp.makeConstraints{ (make) in
            make.width.equalTo(width*0.68+65)
            make.height.equalTo(40)
            make.centerX.equalTo(self.view.snp.centerX)
            make.top.equalTo(self.codeText.snp.bottom).offset(40)
        }
        self.registBtn.addTarget(self, action: #selector(self.isOK), for: .touchUpInside)
    }
    
    @objc func backLogin (){
        self.dismiss(animated: true, completion: nil)
    }
    
    
    
    
    //移除监听
    override func viewDidDisappear(_ animated: Bool) {
        NotificationCenter.default.removeObserver(self)
    }
    //键盘处理
    func textFieldShouldBeginEditing(_ textField: UITextField) -> Bool {
        textField.inputAccessoryView = toolBar;
        return true
    }
    override func touchesBegan(_ touches: Set<UITouch>, with event: UIEvent?) {
        self.view.endEditing(true)
    }
    func textField(_ textField: UITextField, shouldChangeCharactersIn range: NSRange, replacementString string: String) -> Bool {

           return  !(string == " ")
    }
    @objc func doneClick(){
        self.view.endEditing(true)
    }
    
    let width = UIScreen.main.bounds.width
    let height = UIScreen.main.bounds.height
    lazy var isfrist :Bool = {
        return true
    }()
    var toolBar = UIToolbar();
    lazy var backView:UIView = {
        let view = UIView()
        return view
    }()
    
    lazy var back:UIButton = {
        let btn = UIButton()
        btn.titleLabel?.font = UIFont.init(name: "iconfont", size: 18);
        btn.backgroundColor = UIColor.bg
        btn.setTitle("\u{e6f7}返回", for: .normal)
        return btn
    }()
    lazy var data :JSON = {
        return  []
    }()
    lazy var inviteType :Int = {
        return  0
    }()
    lazy var reset:UILabel = {
        let lab = UILabel()
        lab.textAlignment = .center
        lab.text = "注册"
        lab.textColor = UIColor.white
        return lab
    }()
    lazy var inviterLabel :UILabel = {
        let label = UILabel()
        label.backgroundColor = UIColor.colorWithHex(hexColor: 0xdff6f0)
        label.textColor = UIColor.bg
        return label
    }()
    lazy var inviter:UILabel = {
        let label = UILabel()
        label.backgroundColor = UIColor.white
        return label
    }()
    lazy var userNameLabel :UILabel = {
        let label = UILabel()
        label.backgroundColor = UIColor.colorWithHex(hexColor: 0xdff6f0)
        label.textColor = UIColor.bg
        return label
    }()
    lazy var userNameText:UITextField = {
        let text = UITextField()
//        text.setValue(NSNumber(value:10), forKey:"paddingLeft")
        //text.font = UIFont.init(name: "iconfont", size: 18)
        text.backgroundColor = UIColor.white
        text.placeholder = "请输入你的姓名"
        text.clearButtonMode = .unlessEditing
        return text
    }()
    lazy var studentIdLabel:UILabel = {
        let label = UILabel()
        label.backgroundColor = UIColor.colorWithHex(hexColor: 0xdff6f0)
        label.textColor = UIColor.bg
        return label
        
    }()
    lazy var studentIdText:UITextField = {
        let text = UITextField()
//        text.setValue(NSNumber(value:10), forKey:"paddingLeft")
//        text.font = UIFont.init(name: "iconfont", size: 18)
        text.backgroundColor = UIColor.white
        
        text.clearButtonMode = .unlessEditing
        return text
    }()
    lazy var phoneLabel:UILabel = {
        let label = UILabel()
        label.backgroundColor = UIColor.colorWithHex(hexColor: 0xdff6f0)
        label.textColor = UIColor.bg
        return label
        
    }()
    lazy var phoneText:UITextField = {
        let text = UITextField()
//        text.setValue(NSNumber(value:10), forKey:"paddingLeft")
        text.font = UIFont.init(name: "iconfont", size: 18)
        text.backgroundColor = UIColor.white
        text.placeholder = "请输入你的手机号码"
        text.clearButtonMode = .unlessEditing
        return text
    }()
    lazy var qqLabel:UILabel = {
        let label = UILabel()
        label.backgroundColor = UIColor.colorWithHex(hexColor: 0xdff6f0)
        label.textColor = UIColor.bg
        return label
        
    }()
    lazy var qqText:UITextField = {
        let text = UITextField()
//        text.setValue(NSNumber(value:10), forKey:"paddingLeft")
//        text.font = UIFont.init(name: "iconfont", size: 18)
        text.backgroundColor = UIColor.white
        text.placeholder = "请输入你的QQ号(选填)"
        text.clearButtonMode = .unlessEditing
        return text
    }()
    lazy var emailLabel:UILabel = {
        let label = UILabel()
        label.backgroundColor = UIColor.colorWithHex(hexColor: 0xdff6f0)
        label.textColor = UIColor.bg
        return label
        
    }()
    lazy var emailText:UITextField = {
        let text = UITextField()
//        text.setValue(NSNumber(value:10), forKey:"paddingLeft")
//        text.font = UIFont.init(name: "iconfont", size: 18)
        text.backgroundColor = UIColor.white
        text.placeholder = "请输入你的邮箱号码(选填)"
        text.clearButtonMode = .unlessEditing
        return text
    }()
    lazy var codeLable:UILabel = {
        let label = UILabel()
        label.backgroundColor = UIColor.colorWithHex(hexColor: 0xdff6f0)
        label.textColor = UIColor.bg
        return label
    }()
    lazy var codeText:UITextField = {
        let text = UITextField()
        text.backgroundColor = UIColor.white
        text.placeholder = "请输入验证码"
        text.clearButtonMode = .unlessEditing
        return text
    }()
    
    fileprivate  lazy var registBtn:UIButton = {
         let btn = UIButton()
         btn.backgroundColor = UIColor.white
         btn.setTitle("注册账号", for: .normal)
         btn.setTitleColor(UIColor.gray, for: .normal)
         btn.layer.cornerRadius = 20
         return btn
    }()
    
    /*
    // MARK: - Navigation

    // In a storyboard-based application, you will often want to do a little preparation before navigation
    override func prepare(for segue: UIStoryboardSegue, sender: Any?) {
        // Get the new view controller using segue.destinationViewController.
        // Pass the selected object to the new view controller.
    }
    */

}
