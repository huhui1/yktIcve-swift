//
//  courseware_BBS_detailsHeadView.swift
//  云课堂2
//
//  Created by 尤增强 on 2018/7/4.
//  Copyright © 2018年 zqyou. All rights reserved.
//

import UIKit
import SwiftyJSON


@objc protocol courseware_BBS_detailsHeadViewDategate{

    @objc optional func returnImgUrl(url:String) -> ()

}

class courseware_BBS_detailsHeadView: UIView,ZQStarReteViewDelegate {
    @IBOutlet weak var collectionH: NSLayoutConstraint!
    @IBOutlet weak var collectionView: UICollectionView!
    @IBOutlet weak var lab_content: UILabel!
    @IBOutlet weak var lab_ceator: UILabel!
    
    @IBOutlet weak var starView: UIView!
    @IBOutlet weak var lab_time: UILabel!
    @IBOutlet weak var avatorView: UIImageView!
    var list = [JSON]()
    var delegate :courseware_BBS_detailsHeadViewDategate!


    override init(frame: CGRect) {
        super.init(frame: frame)
        awakeFromNib()
    }


    required init?(coder aDecoder: NSCoder) {
        fatalError("init(coder:) has not been implemented")
    }

    func setData(m :evaluationModel){

        self.lab_ceator.text = m.displayName
        self.lab_time.text = m.dateCreated

        self.lab_content.attributedText = common.share.loadHtml(str: m.content)
        common.share.setSDImg(str: m.avatorUrl, imgview: self.avatorView)
        let sView = ZQStarRateView.init(frame: CGRect.init(x: 0, y: 0, width: 80, height: 20), starCount: 5, score:m.star)
        self.starView.addSubview(sView)
        if(m.docJson.count < 1){
            self.collectionH.constant = 0
        }
        sView.delegate = self
    }

    override func awakeFromNib() {
        super.awakeFromNib()
        self.backgroundColor = UIColor.clear
        let subView : UIView = Bundle.main.loadNibNamed("courseware_BBS_detailsHeadView", owner: self, options: nil)?.first as! UIView
        subView.frame = self.frame
        self.addSubview(subView)


    }



    override func layoutSubviews() {
        self.avatorView.layer.masksToBounds = true
        self.avatorView.layer.cornerRadius = 20
    }

}

extension courseware_BBS_detailsHeadView:UICollectionViewDelegate,UICollectionViewDataSource{

    func setCollectionView(){
        let cellXIB = UINib.init(nibName: "itemImgCell", bundle: Bundle.main)
        self.collectionView.register(cellXIB, forCellWithReuseIdentifier: "itemImgCell")

        self.collectionView.delegate = self
        self.collectionView.dataSource = self

    }
    func collectionView(_ collectionView: UICollectionView,
                        cellForItemAt indexPath: IndexPath)
        -> UICollectionViewCell {
            let cell = collectionView.dequeueReusableCell(withReuseIdentifier: "itemImgCell",
                                                          for: indexPath) as! itemImgCell

            let m = self.list[indexPath.row]
            common.share.setSDImg(str:m["docOssPreview"].stringValue, imgview: cell.thumbnail)
            return cell
    }

    func collectionView(_ collectionView: UICollectionView, didSelectItemAt indexPath: IndexPath) {
        let m = self.list[indexPath.row]
        self.delegate?.returnImgUrl!(url: m["docOssPreview"].stringValue)
    }

    //collectionView单元格数量
    func collectionView(_ collectionView: UICollectionView,
                        numberOfItemsInSection section: Int) -> Int {
        return self.list.count
    }
}
