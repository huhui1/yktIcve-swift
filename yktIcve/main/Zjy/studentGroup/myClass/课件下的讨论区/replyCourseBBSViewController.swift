//
//  replyCourseBBSViewController.swift
//  云课堂职教云
//
//  Created by 尤增强 on 2018/3/31.
//  Copyright © 2018年 jcjy. All rights reserved.
//

import UIKit
import Alamofire
import SwiftyJSON
extension replyCourseBBSView {

    //回复
   @objc func reply(){
        let Content = self.contenText.text
        if( (Content?.count)! < 1){
            ZKProgressHUD.showMessage("请输入内容")
            return
        }
        if((Content?.count)! > 300){
            ZKProgressHUD.showMessage("内容超过限制，请简化描述！")
            return
        }
        let dict = ["ResId":self.replyId,
                    "ReplyType":self.activeType,
                    "UserId":Account.defaultAccount.id!,
                    "ReplyToUserId":self.respondToPeopleId,
                    "ReplyToDisplayName":self.respondToPeopleName,
                    "OpenClassId":self.openClassId,
                    "CourseOpenId":self.courseOpenId,"SourceType":3,
                    "Content":Content ?? ""] as [String : Any]
        let data = ["replyData":JSON.init(dict),"cellReplyType":self.activeType] as [String : Any]

        XLBallLoading.show(in: self.view)
        Alamofire.request(appAPI.BBS_addCellReply, method: .post, parameters: data, encoding: URLEncoding.default).responseJSON { response in

            if let value = response.result.value {
                let json = JSON(value)
                if json["code"] == 1{

//                    ZKProgressHUD.hide()
                    self.reloadParentVC()
                }else{
                    ZKProgressHUD.showError(json["msg"].stringValue);
                }
                XLBallLoading.hide(in: self.view)
            }else{
                XLBallLoading.hide(in: self.view)
                ZKProgressHUD.showError("网络环境异常请稍后再试！");
            }
        }


    }


    //返回提示
    override func viewWillDisappear(_ animated: Bool) {
        
    }


    //操作成功过刷新父页面
    func reloadParentVC(){
        let vcCount = self.navigationController?.viewControllers.count
        if let vc :CourseBBSDetailsView = self.navigationController?.viewControllers[vcCount! - 2] as? CourseBBSDetailsView{
               vc.getCellBBSReplyList()
        }
        self.navigationController?.popViewController(animated: true)

    }
}
