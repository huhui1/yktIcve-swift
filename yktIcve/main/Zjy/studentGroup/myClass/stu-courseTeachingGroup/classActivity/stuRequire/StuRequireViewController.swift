//
//  StuRequireViewController.swift
//  云课堂职教云
//
//  Created by 尤增强 on 2018/4/11.
//  Copyright © 2018年 jcjy. All rights reserved.
//

import UIKit
import Alamofire
import SwiftyJSON
extension StuRequireView {

    //图片预览
    func previewImg(url:String){

        let vc = PicturePreviewView()
        vc.imgurl = url
        self.isPushed = true
        self.navigationController?.pushViewController(vc, animated: true)
    }

    //课前课后的单个详细信息
    func requireInfoDetails(json:JSON){
        let vc = requireInfoDetailsView()
        self.isPushed = true
        vc.json = json
        vc.isStu = true
        self.navigationController?.pushViewController(vc, animated: true);
    }

    func getRequireReplyList(){
        
        XLBallLoading.show(in: self.view)
        let dict = ["activityId":self.activityId,
                    "requireType":self.requireType,
                    "openClassId":self.openClassId,
                    "stuId":Account.defaultAccount.id!,
                    "sourceType":3]as [String : Any]
        Alamofire.request(appAPI.FaceTeach_getRequireReplyList, method: .post, parameters: dict, encoding: URLEncoding.default).responseJSON { response in

            if let value = response.result.value {
                let json = JSON(value)

                if(json["code"]>0){
                    self.requireId=json["requireInfo"]["RequireId"].stringValue;
                    self.theWebView.evaluateJavaScript("requireList.get(\(json),\(self.requireType));",
                        completionHandler: nil)
                }else{
                    ZKProgressHUD.showError(json["msg"].stringValue);
                }
                XLBallLoading.hide(in: self.view)
            }else{
                ZKProgressHUD.showError("网络环境异常请稍后再试！");
                XLBallLoading.hide(in: self.view)
            }
        }

    }
    //回复
   @objc func replyRequire(){
        let vc = StuReplyRequireView();
        vc.openClassId = self.openClassId;
        vc.requireId = self.requireId;
        vc.activityId=self.activityId;
     
        self.isPushed = true
        vc.reloadRequireInfo = {() in
            self.getRequireReplyList()
        }
        self.navigationController?.pushViewController(vc, animated: true)
    }
}
