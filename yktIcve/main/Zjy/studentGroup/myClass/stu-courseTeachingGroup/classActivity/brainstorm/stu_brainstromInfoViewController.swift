//
//  stu_brainstromInfoViewController.swift
//  云课堂2
//
//  Created by 尤增强 on 2018/6/26.
//  Copyright © 2018年 jcjy. All rights reserved.
//

import UIKit
import SwiftyJSON
import Alamofire

extension stu_brainstromInfoView{

    func getBrainStrom(isRefresh:Bool){
        XLBallLoading.show(in: self.view)
        let dict = ["stormId":self.brainStormId,
                    "userId":Account.defaultAccount.id!];
        Alamofire.request(appAPI.FaceTeach_getBrainStormStuInfo, method: .post, parameters: dict, encoding: URLEncoding.default).responseJSON { response in
            if let value = response.result.value {
                let json = JSON(value)
                if json["code"] == 1 {
                    self.data = json
                    self.setUIByData( height: 0)

                } else{
                    ZKProgressHUD.showError(json["msg"].stringValue);
                }
                XLBallLoading.hide(in: self.view)
            }else{
                ZKProgressHUD.showError("网络环境异常请稍后再试！");
                XLBallLoading.hide(in: self.view)
            }

        }
    }

    //填充数据渲染页面
    func setUIByData(height:CGFloat){

        self.imgList.removeAll()
        for v in  self.data["stormInfo"]["DocJson"]{
            let m = UploadDocModel.init(i: v.1)
            self.imgList.append(m)

        }
       var  h = CGFloat.init(80) + height

        if( self.data["stormInfo"]["DocJson"].count > 0){
            h += 120
        }

        if(self.data["stormInfo"]["Content"].stringValue.count > 0){
            h += 80
        }

        self.brainStormInfos.removeAll()
        for i in  self.data["brainStormStuList"]{
            let m =  stuBrainStormInfo.init(data: i.1, _isChecked: false)

            self.brainStormInfos.append(m)
            
        }
        self.flowLayout.headerReferenceSize = CGSize.init(width: width, height: h)
        let i = NSIndexSet.init(index: 0)
        self.collectionView.reloadSections(i as IndexSet)
        self.collectionView.reloadData()

    }


}
