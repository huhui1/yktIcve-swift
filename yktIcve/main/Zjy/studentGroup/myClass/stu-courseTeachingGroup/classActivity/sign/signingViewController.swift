//
//  signingViewController.swift
//  66iclasscloud
//
//  Created by 尤增强 on 2018/2/1.
//  Copyright © 2018年 zqy. All rights reserved.
//

import UIKit
import Alamofire
import SwiftyJSON
extension signingView {

    //学生签到
 @objc  func  stuSigned() {

        //        ZKProgressHUD.setAnimationStyle(.chrysanthemum);
//
//        ZKProgressHUD.show();
         XLBallLoading.show(in: self.view)
        let dict = ["stuId":Account.defaultAccount.id!,
                    "SignId":self.signId,
                    "openClassId":self.openClassId,
                    "SourceType":"3"];
        Alamofire.request(appAPI.FaceTeach_saveStuSign, method: .post, parameters: dict, encoding: URLEncoding.default).responseJSON { response in

            if let value = response.result.value {
                let json = JSON(value);
                if json["code"] == 1{
//                    ZKProgressHUD.hide()
                   
                    self.btnSign.setTitle("签到成功", for: .normal)
                    self.btnSign.isEnabled = false
                     self.PushSigned()
                    self.refreshList?.isSign = true
                }else{
                    ZKProgressHUD.showError("网络异常请稍后再试！");
                }
                XLBallLoading.hide(in: self.view)
            }else{
                ZKProgressHUD.showError("网络异常请稍后再试！");
                XLBallLoading.hide(in: self.view)
            }
        }
    }

    //学生反向交互老师
    func  PushSigned() {

        let dict = ["userId":Account.defaultAccount.id!,
                    "actId":self.signId,
                    "actionType":"signed",
                    "signType":self.signType,
                    "SourceType":"3",
                    "displayName":Account.defaultAccount.displayName!] as [String : Any];

        let data = ["data":JSON.init(dict),"userId":self.creatorId] as [String : Any]
        
        Alamofire.request(appAPI.GT_sendGTMsgToUser, method: .post, parameters: data, encoding: URLEncoding.default).responseJSON { response in

            if let value = response.result.value {
                let json = JSON(value);
                if json["code"] == 1{
                    print("个推发送成功")
                }else{
                    ZKProgressHUD.showError("网络异常请稍后再试！");
                }
            }else{
                ZKProgressHUD.showError("网络异常请稍后再试！");
            }
        }
    }
    


}
