//
//  conclusionController.swift
//  云课堂-职教云
//
//  Created by 志辉教育 on 2018/4/2.
//  Copyright © 2018年 zqy. All rights reserved.
//
import Foundation
import Alamofire
import SwiftyJSON

extension conclusionView{
    //获取数据
    func get(){
        XLBallLoading.show(in: self.view)
        let dict = ["activityId":self.activityId,
                    "userId":Account.defaultAccount.id!]
        Alamofire.request(appAPI.FaceTeach_getFaceTeachSelfEvaluation, method: .post, parameters: dict, encoding: URLEncoding.default).responseJSON { response in
            if let value = response.result.value {
                let json = JSON(value)
                if(json["code"]>0){
                    self.summarizeText.text = json["selfEvaluationInfo"]["Content"].stringValue
                    self.textViewDidEndEditing(self.summarizeText)
                    self.setScoreUI(score: Float(json["selfEvaluationInfo"]["Star"].float!))
                    self.countStar = Int(Float(json["selfEvaluationInfo"]["Star"].float!))
                    
                    self.starNumber.text = "\(Float(json["selfEvaluationInfo"]["Star"].float!))"
                    self.Id = json["selfEvaluationInfo"]["Id"].stringValue
                }else{
                    ZKProgressHUD.showError(json["msg"].stringValue);
                }
                XLBallLoading.hide(in: self.view)
            }else{
                ZKProgressHUD.showError("网络环境异常请稍后再试！");
                XLBallLoading.hide(in: self.view)
            }
        }
    }
    
   @objc func setSoceToOnline(){
        if(self.score == 0){
            self.score = CGFloat(countStar)
        }
        if(self.summarizeText.text.isEmpty){
            ZKProgressHUD.showMessage("请输入自我总结内容!")
            return
        }
        let dict = ["id":self.Id,
                    "activityId":self.activityId,
                    "Content":self.summarizeText.text,
                    "Star":self.score,
                    "UserId":Account.defaultAccount.id!,
                    "sourceType":3] as [String : Any]
        let json = ["data":JSON.init(dict)]
        Alamofire.request(appAPI.FaceTeach_conclusion, method: .post, parameters: json, encoding: URLEncoding.default).responseJSON { response in
            if let value = response.result.value {
                let json = JSON(value)
                if(json["code"] == 1){
                    self.reloadsummary!(json["code"].intValue)
                    NotificationCenter.default.removeObserver(self)
                    self.navigationController?.popViewController(animated: true)
                }else{
                    ZKProgressHUD.showError(json["msg"].stringValue);
                }
            }else{
                ZKProgressHUD.showError("网络环境异常请稍后再试！");
            }
        }
    
    }

    
    
}
