//
//  stuJoinGroupPkTableView.swift
//  yunketang
//
//  Created by 尤增强 on 2018/2/24.
//  Copyright © 2018年 zqy. All rights reserved.
//

import UIKit
import SwiftyJSON

class stuJoinGroupPkTableView: UIViewController,UITableViewDelegate,UITableViewDataSource {

    var reloadClosure :(() ->Void)?
    override func viewDidLoad() {
        super.viewDidLoad()
        self.view.backgroundColor = UIColor.white
        self.getGroupInfo()
        self.setfootBtn()
//        self.setTableviewUI()

    }


    func setTableviewUI(){
        //创建表视图

        var fheight = 0 ;
        if((self.navigationController) == nil){
            fheight = 60
        }
        //将浏览器视图全屏(在内容区域全屏,不占用顶端时间条)
        self.tableView = UITableView.init(frame: CGRect(x:CGFloat(0), y:CGFloat(fheight), width:width, height:height - 110 + CGFloat(2 * HX)));

        self.tableView.delegate = self;
        self.tableView.dataSource = self;

        self.tableView.register(memberTableViewCell.self, forCellReuseIdentifier: "SwiftCell")

        tableView.tableFooterView = UIView(frame:CGRect.zero)//除去多余的cell
        tableView.separatorInset = UIEdgeInsets.zero;

        tableView.layoutMargins = UIEdgeInsets.zero;

        if #available(iOS 9.0, *) {
            tableView.cellLayoutMarginsFollowReadableWidth = false
        } else {
            // Fallback on earlier versions
        }

        self.view.addSubview(self.tableView!);
    }


   
    //设置底部按钮
    func setfootBtn(){

        self.view.addSubview(self.btn_joinOrExist)
        self.btn_joinOrExist.snp.makeConstraints { (make) in
            make.width.equalTo(width)
            make.height.equalTo(50)
            make.bottom.equalTo(self.view.snp.bottom).offset(HX)
        }
        self.btn_joinOrExist.addTarget(self, action: #selector(self.joinOrExist(_ :)), for: .touchUpInside)
    }

    
    func isJoinGroups(){
        
        if(self.isJoinGroup == 1){
            self.btn_joinOrExist.isSelected = true
        }else{
            self.btn_joinOrExist.isSelected = false
        }
    }
    //设置暂无数据
    func setNodata(){
        self.view.addSubview(self.lab_noData)
        self.lab_noData.snp.makeConstraints { (make) in
            make.width.equalTo(width)
            make.height.equalTo(50)
            make.top.equalTo(0)
        }

    }
    

    override func didReceiveMemoryWarning() {
        super.didReceiveMemoryWarning()
        // Dispose of any resources that can be recreated.
    }

    // MARK: - Table view data source

     func numberOfSections(in tableView: UITableView) -> Int {
        // #warning Incomplete implementation, return the number of sections
        return 1
    }

     func tableView(_ tableView: UITableView, numberOfRowsInSection section: Int) -> Int {
        // #warning Incomplete implementation, return the number of rows
        return self.list.count
    }

    func tableView(_ tableView: UITableView, heightForRowAt indexPath: IndexPath) -> CGFloat {
        return 70
    }

     func tableView(_ tableView: UITableView, cellForRowAt indexPath: IndexPath) -> UITableViewCell {

        let stu = JSON(self.list[indexPath.row])

        //为了提供表格显示性能，已创建完成的单元需重复使用
        let identify:String = "SwiftCell"
        //同一形式的单元格重复使用，在声明时已注册
        let cell = tableView.dequeueReusableCell(withIdentifier: identify,
                                                 for: indexPath) as! memberTableViewCell
        //为了提示用户，将cell的accessory view设置为UIActivityIndicatorView。
//        if cell.accessoryView == nil {
//            let indicator = UIActivityIndicatorView(activityIndicatorStyle: .gray)
//            cell.accessoryView = indicator
//        }
//        //获取当前行所对应的图片记录。
//        let coverRecord = covers[indexPath.row]

        cell.lab_Name.text = stu["StuName"].stringValue
        cell.lab_num.text = stu["StuNo"].stringValue
//        cell.imgView_avatar.image = coverRecord.image

//        let indicator = cell.accessoryView as! UIActivityIndicatorView
        common.share.setSDImg(str: stu["AvatarUrl"].stringValue, imgview: cell.imgView_avatar)

        //检查图片状态。设置适当的activity indicator 和文本，然后开始执行任务
//        switch (coverRecord.state){
//        case .filtered:
//            indicator.stopAnimating()
//        case .failed:
//            indicator.stopAnimating()
//        case .downloaded:
//            indicator.stopAnimating()
//        //             cell.labinfo.text = "Failed to load"
//        case .new:
//            indicator.startAnimating()
//            //只有停止拖动的时候才加载
//            if (!tableView.isDragging && !tableView.isDecelerating) {
//                self.startOperationsForMovieRecord(coverRecord, indexPath: indexPath)
//            }
//        }

        return cell
    }


    lazy var PKId  = ""
    lazy var groupId = ""
    lazy var groupStuId = ""
    
    lazy var openClassId :String = {
        return ""
    }()
    lazy var list :NSArray = {
        return []
    }()
    lazy var isJoinGroup  = 0

    lazy var width = UIScreen.main.bounds.width
    lazy var height = UIScreen.main.bounds.height

    private lazy var btn_joinOrExist :UIButton = {

        let btn = UIButton()
        btn.backgroundColor = UIColor.bg
        btn.contentMode = .center
        btn.setTitle("加入小组", for: .normal)
        btn.setTitle("退出小组", for: .selected)
        return btn
    }()

    lazy var lab_noData : UILabel = {
        let lab = UILabel()
        lab.text = "暂无成员，快来加入吧！"
        lab.font = UIFont.init(name: "iconfont", size: 16)
        lab.textAlignment = .center
        lab.textColor = UIColor.gray
        lab.layer.borderColor = UIColor.gray.cgColor
        lab.layer.borderWidth = 0.4
        return lab
    }()
//    lazy var tableView : UITextView = {
//        let view = UITextView()
//        return view
//    }()
    var tableView :UITableView!
    let HX = common.share.returnSafeAreaLineHeight()
}
