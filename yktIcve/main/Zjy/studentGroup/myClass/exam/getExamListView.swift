//
//  getExamListView.swift
//  66iclasscloud
//
//  Created by zqy on 2018/2/6.
//  Copyright © 2018年 zqy. All rights reserved.
//

import UIKit
import SwiftyJSON

class getExamListView: UITableViewController {
    var list :NSArray = [];
    override func viewDidLoad() {
        super.viewDidLoad()

        let item = UIBarButtonItem(title: "\u{e6f7}返回", style: .plain, target: self, action: #selector(self.backBtnClick))
        self.navigationItem.leftBarButtonItem = item
        common.share.setBackButtonItem(item:item)
        self.navigationController?.navigationBar.tintColor = UIColor.white
        let Item = UIBarButtonItem(title: "返回", style: .plain, target: self, action: nil)
        self.navigationItem.backBarButtonItem = Item
        
        // Do any additional setup after loading the view.
        
        self.view.backgroundColor = UIColor.colorWithHex(hexColor: 0xF9F9F9);
        // 设置分割线的样式为None.
        self.tableView.separatorStyle = UITableViewCellSeparatorStyle.none
        tableView.register(getExamListTableViewCell.self, forCellReuseIdentifier: "getExamListTableViewCell");
        tableView.tableFooterView = UIView(frame:CGRect.zero)//除去多余的cell
        tableView.separatorInset = UIEdgeInsets.zero;
        
        tableView.layoutMargins = UIEdgeInsets.zero;
        
        if #available(iOS 9.0, *) {
            tableView.cellLayoutMarginsFollowReadableWidth = false
        } else {
            // Fallback on earlier versions
        }
        
        self.refreshItemData(isRefresh: true)
        
        
        //下拉刷新相关设置,使用闭包Block
        self.tableView.mj_header = MJRefreshNormalHeader(refreshingBlock: {
            //重现生成数据
            self.refreshItemData(isRefresh:false);
            
        })
    }
    
    override func didReceiveMemoryWarning() {
        super.didReceiveMemoryWarning()
        // Dispose of any resources that can be recreated.
    }
    
    override func numberOfSections(in tableView: UITableView) -> Int {
        return 1
    }
    
    override func tableView(_ tableView: UITableView, heightForRowAt indexPath: IndexPath) -> CGFloat
    {
        return 135;
    }
    
    //返回表格行数（也就是返回控件数）
    override func tableView(_ tableView: UITableView, numberOfRowsInSection section: Int) -> Int {
        
        return self.list.count;
    }
    
    //创建各单元显示内容(创建参数indexPath指定的单元）
    override func tableView(_ tableView: UITableView, cellForRowAt indexPath: IndexPath)
        -> UITableViewCell {
            let cell:getExamListTableViewCell = tableView.dequeueReusableCell(withIdentifier: "getExamListTableViewCell") as! getExamListTableViewCell
            let json = JSON(self.list[indexPath.row]);
            //去除点击cell变灰
            cell.selectionStyle = UITableViewCellSelectionStyle.none
            cell.setData(json: json)

            cell.btn_isMore.tag = indexPath.row
            cell.btn_isMore.addTarget(self, action: #selector(self.viewMore(_:)), for: .touchUpInside)

            return cell
    }
    //点击
    override func tableView(_ tableView: UITableView, didSelectRowAt indexPath: IndexPath) {
        
        tableView .deselectRow(at: indexPath, animated: true)
        let json = JSON(self.list[indexPath.row])
        if(json["examType"] == 2){
            ZKProgressHUD.showMessage("登分考试暂不支持手机端查看!")
            return
        }else{
            if(json["isAnswerOrPreview"] == 2){
                let vc = stuExaminationHandleView()
                vc.courseOpenId = self.courseOpenId
                vc.openClassId = self.openClassId
            
                vc.examStuId = json["examStuId"].stringValue
                vc.examId = json["examId"].stringValue
                vc.examTermTimeId = json["examTermTimeId"].stringValue
                vc.examTitle = json["title"].stringValue
                 vc.hidesBottomBarWhenPushed = true
                self.navigationController?.pushViewController(vc, animated: true)
            }else{
                if(json["isPreview"] == 0){
                    if(json["stuExamState"] == "未答"){
                    
                    ZKProgressHUD.showMessage("该考试在\(json["startDate"])~\(json["endDate"])区间内才能做答")
                    }else{
                    ZKProgressHUD.showMessage("该考试在\(json["fixedPublishTime"])后才能查看结果")
                    }
                }else{
                    let vc = stuExaminationhandleRecordView()

                    vc.hidesBottomBarWhenPushed = true
                    vc.courseOpenId = self.courseOpenId
                    vc.openClassId = self.openClassId
                    vc.examStuId = json["examStuId"].stringValue
                    vc.examId = json["examId"].stringValue
                    vc.examTermTimeId = json["examTermTimeId"].stringValue
                    vc.title = json["title"].stringValue
                     vc.hidesBottomBarWhenPushed = true
                    self.navigationController?.pushViewController(vc, animated: true)
                }
            }
        }
        
    }
    
    //返回按钮
   @objc func backBtnClick() {
        if(state){
            self.presentingViewController?.presentingViewController?.dismiss(animated: true, completion: nil)
        }else{
            self.presentingViewController?.dismiss(animated: true, completion: nil)
        }
    }
    let width = UIScreen.main.bounds.width
    var state:Bool = {return false}()
    lazy var openClassId :String = {return ""}()
    lazy var courseOpenId :String = {return ""}()
  
}
