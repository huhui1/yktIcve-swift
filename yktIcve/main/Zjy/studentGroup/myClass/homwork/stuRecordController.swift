//
//  stuRecordController.swift
//  云课堂-职教云
//
//  Created by zqy on 2018/3/27.
//  Copyright © 2018年 zqy. All rights reserved.
//

import Foundation
import SwiftyJSON
import Alamofire
import SCLAlertView
extension stuRecordView{
    func refreshItemData(isRefresh:Bool){

        XLBallLoading.show(in: self.view)
        let dict = ["openClassId":self.openClassId,
                    "homeworkId":self.homeWorkId,
                    "homeworkTermTimeId":self.homeworkTermTimeId,
                    "stuId":self.stuId,
                    "userType":self.userType]as [String : Any]
        Alamofire.request(appAPI.Homework_getHomeworkStuRecord, method: .post, parameters: dict, encoding: URLEncoding.default).responseJSON { response in
            if let value = response.result.value {
                let json = JSON(value)
                if(json["code"]>0){
                    var msg = " 暂不允许作答\n造成此现象的原因可能为未开始，已经超过截止时间或已经作答等原因";
                    if(json["isTakeHomework"].bool!){
                        self.answerBtn.isHidden = false;
                        msg = "暂无任何作答记录信息"
                    }else{
                        self.answerBtn.isHidden = true;
                    }
                    self.isTakeHomework = json["isTakeHomework"].boolValue
                    if json["stuHomeworkList"].count > 0{
                        self.list = json["stuHomeworkList"].arrayValue as NSArray;
                    }else{
                         self.lab_msg.frame = CGRect.init(x: 0, y: 0, width: self.width, height: 65)
                         self.lab_msg.text = msg
                    }
                    
                    self.tableView.tableFooterView = self.lab_msg
                    if self.list.count > 0{
                        self.tableView.tableFooterView?.isHidden = true
                    }
                    //重现加载表格数据
                    self.tableView!.reloadData();
                   
                }else if(json["code"] == -3){
                    //隐藏详情
                    self.navigationItem.rightBarButtonItem =
                        UIBarButtonItem(title: "",style: .plain,target: nil,action: nil)
                    //提示框
                    SCLAlertView().showInfo("温馨提示！",
                        subTitle: "当前作业未设置时间",closeButtonTitle: "确定")
                }else{
                    ZKProgressHUD.showMessage(json["msg"].stringValue);
                }
                XLBallLoading.hide(in: self.view)
            }else{
               ZKProgressHUD.showError("网络环境异常请稍后再试！");
                XLBallLoading.hide(in: self.view)
            }
            
        }
        if(!isRefresh){
            //结束刷新
            self.tableView!.mj_header.endRefreshing();
        }
        
    }
    
}
