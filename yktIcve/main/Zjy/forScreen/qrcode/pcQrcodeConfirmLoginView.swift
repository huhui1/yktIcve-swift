//
//  pcQrcodeConfirmLoginView.swift
//  云课堂2
//
//  Created by 尤增强 on 2018/6/13.
//  Copyright © 2018年 zqyou. All rights reserved.
//

import UIKit
import SwiftyJSON
class pcQrcodeConfirmLoginView: UIViewController {

    @IBOutlet weak var remark: UILabel!
    @IBOutlet weak var lab_msg: UILabel!
    @IBOutlet weak var btn_cancel: UIButton!
    @IBOutlet weak var btn_login: UIButton!
    @IBOutlet weak var lab_icon: UILabel!
    var user:User!
    override func viewDidLoad() {
        super.viewDidLoad()

        // Do any additional setup after loading the view.
    }
    init() {
        super.init(nibName: "pcQrcodeConfirmLoginView", bundle: nil)
    }

    required init?(coder aDecoder: NSCoder) {
        fatalError("init(coder:) has not been implemented")
    }
    override func viewWillLayoutSubviews() {
        self.lab_icon.text = "\u{e626}"
        self.lab_icon.font = UIFont.init(name: "iconfont", size: 160)
        self.lab_icon.textColor = UIColor.gray
        self.btn_login.layer.masksToBounds = true
        self.btn_login.layer.cornerRadius = 4

        self.btn_login.layer.borderWidth = 1

        self.setLoginConfirmUI()
    }


    //登陆还是退出
    func  setLoginConfirmUI(){
        if(ZQSocketManager.isConnected){
            self.btn_login.setTitleColor(UIColor.gray, for: .normal)
            self.btn_login.layer.borderColor = UIColor.gray.cgColor
            self.lab_msg.text = "Windows 已登陆"
            self.btn_login.setTitle("退出登陆", for: .normal)
            self.btn_login.tag = 1
            self.btn_cancel.isHidden = true
            self.remark.text = ""
        }else{
            self.btn_login.setTitleColor(UIColor.bg, for: .normal)
            self.btn_login.layer.borderColor = UIColor.bg.cgColor
        }
    }

    @IBAction func IsConfirmLogin(_ sender: UIButton) {
        if(sender.tag == 1){
            print("我要退出")

            let dict = ["type":"exit"]
            ZQSocketManager.share.notificationSocketManager(data: dict)
            self.closeVC()
            ZQSocketManager.isConnected = false
            self.navigationController?.popViewController(animated: true)
        }else{
            self.socketConnet()
        }
    }


    //确定连接
    func  socketConnet(){

        let dict = ["type":"confirmLogin"]
        ZQSocketManager.share.notificationSocketManager(data: dict)
        ZQSocketManager.isConnected = true
        self.closeVC()
        self.setLoginConfirmUI()
    }
    
    @IBAction func cancel(_ sender: UIButton) {
        self.closeVC()
        self.navigationController?.popViewController(animated: true)
    }

    //关闭页面
    func closeVC(){
        let count = self.navigationController?.viewControllers.count
        if let _ :pcQrcodeViewController = self.navigationController?.viewControllers[count! - 2] as? pcQrcodeViewController{
            self.navigationController?.viewControllers.remove(at: count! - 2)
        }
    }

    override func didReceiveMemoryWarning() {
        super.didReceiveMemoryWarning()
        // Dispose of any resources that can be recreated.
    }

}


