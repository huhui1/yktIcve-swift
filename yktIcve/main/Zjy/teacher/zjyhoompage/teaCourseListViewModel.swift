//
//  teaCourseListViewModel.swift
//  yktIcve
//
//  Created by 尤增强 on 2018/8/24.
//  Copyright © 2018年 zqyou. All rights reserved.
//

import RxSwift
import RxCocoa

class TeaCourseListViewModel {
    /**** 数据请求服务 ***/
    let networkService = NetworkService()

    //数据总数
    let dataCount: Observable<Int>

    //表格数据序列
    let tableData:Driver<[CourseInfoModel]>

    //停止刷新状态序列
    let endHeaderRefreshing: Driver<Bool>

    //数据的数量
    var tableDataCount = BehaviorRelay<Int>(value: 0)
    //ViewModel初始化（根据输入实现对应的输出）
    init(headerRefresh: Driver<Void>,parmes:[String:String]) {

        //网络请求服务
        let networkService = NetworkService()

        //生成查询结果序列
        self.tableData = headerRefresh
            .startWith(()) //初始化完毕时会自动加载一次数据
            .flatMapFirst{ _ in networkService.loadCourseList(parmes) } //也可考虑改用flatMapLatest

        //生成停止刷新状态序列
        self.endHeaderRefreshing = self.tableData.map{ _ in true }

        //结果则返回数量
        self.dataCount = Observable.of(
            tableData.map{ $0.count })
            .merge()
    }
}
