//
//  errorTitleDetail.swift
//  云课堂2
//
//  Created by 志辉教育 on 2018/7/7.
//  Copyright © 2018年 zqyou. All rights reserved.
//


import UIKit
import WebKit
import SwiftyJSON

class errorTitleDetail: UIViewController ,WKScriptMessageHandler{
    
    override func viewDidLoad() {
        super.viewDidLoad()
        self.view.backgroundColor = UIColor.white;
        self.setwebUI()
        self.title = "错题"
        let item = UIBarButtonItem(title: "返回", style: .plain, target: self, action: nil)
        self.navigationItem.backBarButtonItem = item
        let recordItem = UIBarButtonItem.init(title: "作答记录", style: UIBarButtonItemStyle.plain, target: self, action: #selector(self.pushforRecord));
        self.navigationItem.rightBarButtonItem = recordItem;
        // Do any additional setup after loading the view.
    }
    
    override func didReceiveMemoryWarning() {
        super.didReceiveMemoryWarning()
        // Dispose of any resources that can be recreated.
    }
    
    
    func setwebUI() {
        
        let path = Bundle.main.path(forResource: "errorTitle", ofType: ".html",
                                    inDirectory: "HTML5/src/teacher/errorTitle");
        let url = URL(fileURLWithPath:path!);
        //let request = URLRequest(url:url);
        
        //创建供js调用的接口
        let theConfiguration = WKWebViewConfiguration()
        theConfiguration.userContentController.add(self, name: "interOp")
        
        //将浏览器视图全屏(在内容区域全屏,不占用顶端时间条)
        let frame = CGRect(x:0, y:0, width:width,
                           height:UIScreen.main.bounds.height)
        theWebView = WKWebView(frame:frame, configuration: theConfiguration)
        //禁用页面在最顶端时下拉拖动效果
        //                theWebView.scrollView.bounces = false;
        //                theWebView.isUserInteractionEnabled = false;
        //加载页面
        if #available(iOS 9.0, *) {
            
            theWebView.loadFileURL(url, allowingReadAccessTo: url)
        } else {
            
            do{
                
                let url1 = try common.share.fileURLForBuggyWKWebView8(fileURL:url as NSURL)
                let request = URLRequest(url:url1 as URL);
                theWebView.load(request)
                
            }catch{}
        }
       // theWebView.load(request)
        self.view.addSubview(theWebView);
    }
    //响应处理js那边的调用
    func userContentController(_ userContentController:WKUserContentController,
                               didReceive message: WKScriptMessage) {
        let sentData = message.body as! Dictionary<String,String>
        
        if(sentData["method"] == "load" ){
            self.isAnimated = true
            self.getQuestionInfo(isfirst: true)
        }else if(sentData["method"]=="preview"){
            self.previewImg(url:sentData["url"]!);
            
        }else if(sentData["method"] == "getUrlById"){
            self.getFileById(Id:sentData["Id"]!)
        }else if(sentData["method"] == "getFileInfoByUrl"){
            self.getFileInfoByUrl(url: sentData["url"]!)
        }
    }
    
    override func viewWillDisappear(_ animated: Bool) {
        if(!self.isPushed){
            theWebView.configuration.userContentController.removeScriptMessageHandler(forName: "interOp")
            
        }
        self.isPushed = false
    }
    
    fileprivate lazy var bgview : UIView = {
        
        let view = UIView()
        view.isHidden = true
        return view
    }()
    lazy var theWebView:WKWebView = {
        let WK = WKWebView()
        
        return WK
    }()
    
    fileprivate lazy var isAnimated = false;
    

    lazy var dataJson :JSON={return []}();
    lazy var questionId :String = {
        
        return ""
    }()
    lazy var hkOrExamId :String = {return ""}()//作业或者考试Id
    lazy var questinType :Int = {return 1}()
    lazy var hkOrExamType: Int = {return 2}()//1.作业 ，2.考试
    lazy var courseOpenId:String = {
        return ""
    }()
    lazy var openClassId :String = {
        return ""
    }()
    lazy var isPushed:Bool = {
        return false
    }()
    fileprivate lazy var width = UIScreen.main.bounds.width;
    lazy var isStu :Bool = {return false}()
    
}




