//
//  WronghomeworkView.swift
//  云课堂2
//
//  Created by 志辉教育 on 2018/6/26.
//  Copyright © 2018年 zqyou. All rights reserved.
//

import UIKit
import SwiftyJSON
class WronghomeworkView: UIViewController,UITableViewDelegate,UITableViewDataSource,WronghomeworkCellDelegate {
    override func viewDidLoad() {
        super.viewDidLoad()
        self.view.backgroundColor = UIColor.white
//        self.navigationController?.navigationBar.isTranslucent = false;
        
        let item = UIBarButtonItem(title: "筛选\u{e71d}", style: .plain, target: self, action: #selector(self.screening))
        self.navigationItem.rightBarButtonItem = item
        common.share.setBackButtonItem(item:item)
        let Item = UIBarButtonItem(title: "返回", style: .plain, target: self, action: nil)
        self.navigationItem.backBarButtonItem = Item
        self.settableview()
        self.getErrorData()
        // Do any additional setup after loading the view.
    }

    override func didReceiveMemoryWarning() {
        super.didReceiveMemoryWarning()
        // Dispose of any resources that can be recreated.
    }
    func numberOfSections(in tableView: UITableView) -> Int {
        return 1
    }
  
    func tableView(_ tableView: UITableView, numberOfRowsInSection section: Int) -> Int {
        if tableView == self.tableView{
            return self.list.count
        }else{
            return self.list2.count
        }
    }
    func tableView(_ tableView: UITableView, heightForRowAt indexPath: IndexPath) -> CGFloat {
        if tableView == self.tableView{
            let model = self.list[indexPath.row]
            if model.isopencell {
                return 130
            }else{
                return 95
            }
        }else{
            return 48
        }
    }

    func tableView(_ tableView: UITableView, cellForRowAt indexPath: IndexPath) -> UITableViewCell {
        if tableView == self.tableView{
            let model = self.list[indexPath.row]
            let cell:WronghomeworkCell = tableView.dequeueReusableCell(withIdentifier: "WronghomeworkCell")
                as! WronghomeworkCell
            cell.selectionStyle = UITableViewCellSelectionStyle.none
            cell.setmodel(model: model)
            cell.btn.tag = indexPath.row
            cell.delegate = self
            return cell
        }else{
            let model2 = self.list2[indexPath.row]
            let cell:WrongTypeCell = tableView2.dequeueReusableCell(withIdentifier: "WrongTypeCell")
                as! WrongTypeCell
            cell.setmodel(model: model2)
            return cell
        }
    }

    func tableView(_ tableView: UITableView, didSelectRowAt indexPath: IndexPath) {
        
        //刷新数据
        if tableView == self.tableView2{
           self.list2.map({$0.iscolor = false})
           let model = self.list2[indexPath.row]
           model.iscolor = true
           self.list.removeAll()
           self.page = 1
           self.knowledgeIds.removeAll()
           self.tableView.mj_footer.isHidden = false
           self.questionType = "\(model.questionType)"
           self.tableView2.reloadSections([indexPath.section], with: .automatic)
           self.getErrorData()
        }else{
            let error =  self.list[indexPath.row]
            let vc=errorTitleDetail();
            vc.questionId = error.questionId
            vc.courseOpenId = self.courseOpenId
            vc.openClassId = self.openClassId;
            vc.isStu = self.isStu
            vc.hkOrExamId = self.hkIdOrExamId
            vc.hkOrExamType = self.hkOrExamType
            self.navigationController?.pushViewController(vc, animated: true);
            
            
            
        }
    }
    //cell代理
    func  action_unfold(index: Int) {
        let indexPath =  NSIndexPath.init(item: index, section: 0) as IndexPath
        let model = self.list[index]
        model.isopencell = !model.isopencell
        //刷新分区
        self.tableView.reloadSections([indexPath.section], with: .automatic)
    }
    
    func settableview(){
        self.tableView = UITableView.init(frame:  CGRect(x:100, y:0, width:self.view.bounds.width - 100, height:self.view.bounds.height - 65))
      
        self.tableView.delegate = self;
        self.tableView.dataSource = self;
        self.tableView.backgroundColor = UIColor.colorWithHex(hexColor: 0xfafafa)
        // 设置分割线的样式为None.
        self.tableView.separatorStyle = UITableViewCellSeparatorStyle.none
        self.tableView.tableFooterView = UIView(frame:CGRect.zero)//除去多余的cell
        self.tableView.register(UINib(nibName:"WronghomeworkCell", bundle:nil),
                                forCellReuseIdentifier:"WronghomeworkCell")
        //上拉加载相关设置,使用闭包Block
        self.tableView.mj_footer = MJRefreshBackNormalFooter(refreshingBlock: { () -> Void in
            self.page += 1;
            self.getErrorData()
        })
        self.view.addSubview(self.tableView)
        
        self.tableView2 = UITableView.init(frame:  CGRect(x:0, y:0, width: 100, height:self.view.bounds.height))
        
        self.tableView2.register(UINib(nibName:"WrongTypeCell", bundle:nil),
                                 forCellReuseIdentifier:"WrongTypeCell")
        
        self.tableView2.delegate = self;
        self.tableView2.dataSource = self;
        self.tableView2.backgroundColor = UIColor.colorWithHex(hexColor: 0xfafafa)
        self.tableView2.tableFooterView = UIView(frame:CGRect.zero)//除去多余的cell
        self.tableView.separatorInset = UIEdgeInsets.zero;
        self.tableView.layoutMargins = UIEdgeInsets.zero;
        self.view.addSubview(self.tableView2)
    }
    

    
    
    lazy var questionindex:Array = [Int]()
    lazy var list2 = [WrongTypemodel]()
    lazy var isfirst:Bool = true
    var tableView :UITableView!
    var tableView2:UITableView!
    lazy var courseOpenId :String = {return ""}()
    lazy var openClassId:String = {return ""}()
    lazy var questionType:String = {return ""}()
    lazy var knowledgeIds:Array =  [String]()
    lazy var orderColumn: String = {return ""}()
    lazy var hkIdOrExamId: String = {return ""}()//作业或者考试Id
    lazy var isAsc: Int = {return 1}()
    lazy var hkOrExamType: Int = {return 2}()
    lazy var page: Int = {return 1}()
    var isStu :Bool = {return false}()
    var isopencell:Bool = false
    var list = [Wronghomeworkmodel]()

}
