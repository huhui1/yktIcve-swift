//
//  extensionPreviewOfficeViewController.swift
//  云课堂职教云
// 课件下图片 文档使用
//  Created by 尤增强 on 2018/4/14.
//  Copyright © 2018年 jcjy. All rights reserved.
//

import UIKit

 extension previewOfficeViewController {

    //获取面授数据
    func getFaceTeach(){
        self.theWebView?.isHidden = true
        self.view.backgroundColor = UIColor.white;
        let value = UIInterfaceOrientation.portrait.rawValue
        appDelegate.isEffective = true
        appDelegate.allowRotation = true
        UIDevice.current.setValue(value, forKey: "orientation")
        let vc = CourseWare_TeachingTabController()
        vc.vc.openClassId = self.openClassId
        vc.vc.courseOpenId = self.courseOpenId
        self.isPushed = true
        self.isPreviewToMS = true
        vc.vc.modalTransitionStyle = .crossDissolve

        self.present(vc, animated: true, completion: nil)
        
    }

    func showBBSView(){
        self.theWebView?.isHidden = true
        self.view.backgroundColor = UIColor.white;
        let value = UIInterfaceOrientation.portrait.rawValue
         appDelegate.isEffective = true
          appDelegate.allowRotation = true
        UIDevice.current.setValue(value, forKey: "orientation")
        let vc = CourseWare_BBSTabController()
        vc.vc.docId = self.cellId
        vc.vc.openClassId = self.openClassId
        vc.vc.courseOpenId = self.courseOpenId
        self.isPushed = true
        vc.vc.modalTransitionStyle = .crossDissolve

        self.present(vc, animated: true, completion: nil)
    }

    func IsstartDownload() {
        if(!self.isAllowDownLoad){
            ZKProgressHUD.showMessage("该资源不允许下载！")
            return
        }
        let cx = SQLiteManagerCache()
        let path = cx.readOneData(_userId: Account.defaultAccount.id!, docId: self.cellId)
        if(path.docPath.isEmpty){
            self.startDownload()
        }else{
            ZKProgressHUD.showMessage("该资源已被下载")
        }
        print("| BMPlayerDelegate | bmPlayerStartDownload")
    }


    //开始下载
    func startDownload(){
        self.theWebView?.isHidden = true
        self.view.backgroundColor = UIColor.white;
        let value = UIInterfaceOrientation.portrait.rawValue
        appDelegate.isEffective = true
        appDelegate.allowRotation = true
        UIDevice.current.setValue(value, forKey: "orientation")
        let vc = CourseWare_CacheController()
        vc.vc.docId = self.cellId
//        vc.vc.docUrl = self.resourceUrl
//        vc.vc.docType = 5
        vc.vc.docUrl = self.resourcesUrl["urls"]["download"].stringValue
        vc.vc.docType = self.type.index(of:self.doctype)!
        vc.vc.docTitle = self.celltittle
        vc.vc.isStart = true;
        vc.vc.hasNavigation = true
        self.isPushed = true
        vc.vc.modalTransitionStyle = .crossDissolve
        
        self.present(vc, animated: true, completion: nil)
    }

}
