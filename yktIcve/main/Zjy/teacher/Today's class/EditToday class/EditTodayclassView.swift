//
//  EditTodayclassView.swift
//  云课堂2
//
//  Created by 志辉教育 on 2018/6/29.
//  Copyright © 2018年 zqyou. All rights reserved.
//

import UIKit
import SnapKit
import Alamofire
import SwiftyJSON
import SCLAlertView
class EditTodayclassView: UIViewController,UITextFieldDelegate,UIPickerViewDelegate, UIPickerViewDataSource {
    override func didReceiveMemoryWarning() {
        super.didReceiveMemoryWarning()
        // Dispose of any resources that can be recreated
    }
    let width = UIScreen.main.bounds.width;
    let height = UIScreen.main.bounds.height;
    //创建一个闭包属性
    var reloadfacelistClosure :((_ Date:String)->Void)?
    
    var openClassIds = "";
    
    var courseOpenId: String = "";
    var courseOpenName: String = "";
    var activityId :String = "";
    var actStartTime: String = "";
    
    var actEndTime: String = "";
    var actAddress :String = "";
    var actTitle: String = "";
    var CourseList :NSArray = [];

    var toolBar = UIToolbar();
    
    var state:Int = {
        return 0
    }()
    lazy var isfrist :Bool = {
        return true
    }()
    let HX = common.share.returnSafeAreaLineHeight()
    
    var coursePicker = UIPickerView();
    let text_Title = UITextField();
    let text_address = UITextField();
    let text_Session = UITextField();
    var datePicker = UIDatePicker();
    let text_Date = UITextField();
    var text_CourseName = UITextField();
    var label_ClassName = UILabel();
    
    //自定义提示框样式
    let appearance = SCLAlertView.SCLAppearance(
        showCloseButton: false //不显示关闭按钮
    )
    
    override func viewDidLoad() {
        super.viewDidLoad()
        self.setUI();
        if(self.activityId.isEmpty){
            self.firstEditUI()
            self.getCourse();
        }else{
            text_CourseName.isUserInteractionEnabled = false;
            label_ClassName.isUserInteractionEnabled = false;
            self.editUI();
        }
        let Item = UIBarButtonItem(title: "\u{e6f7} 返回", style: .plain, target: self, action: #selector(self.backBtnClick))
        self.navigationItem.leftBarButtonItem = Item
        common.share.setBackButtonItem(item: Item)
        
        //监听键盘弹出通知
        NotificationCenter.default
            .addObserver(self,selector: #selector(keyboardWillShow(_:)),
                         name: NSNotification.Name.UIKeyboardWillShow, object: nil)
        //监听键盘隐藏通知
        NotificationCenter.default
            .addObserver(self,selector: #selector(keyboardWillHide(_:)),
                         name: NSNotification.Name.UIKeyboardWillHide, object: nil)
        
        // Do any additional setup after loading the view.
        
    }
    //移除监听 自定义
    @objc func backBtnClick(){
        NotificationCenter.default.removeObserver(self)
        self.navigationController?.popViewController(animated: true)
    }
    
    //去除一进来键盘的显示
    override func viewDidAppear(_ animated: Bool) {
        self.isfrist = false
        DoneClick()
    }
   @objc func DoneClick(){
        self.view.endEditing(true)
    }
    // 键盘显示
   @objc func keyboardWillShow(_ notification: Notification) {
        if(!self.isfrist){
            let userInfo = (notification as NSNotification).userInfo!
            //键盘尺寸
            let keyboardSize = (userInfo[UIKeyboardFrameBeginUserInfoKey]
                as! NSValue).cgRectValue
            var contentInsets:UIEdgeInsets
            contentInsets = UIEdgeInsetsMake(64.0, 0.0, (keyboardSize.height), 0.0);
            self.view.frame = CGRect.init(x:0, y: -64, width:self.view.bounds.width, height: self.view.bounds.height);
        }
    }
    
    // 键盘隐藏
    @objc func keyboardWillHide(_ notification: Notification) {
        if(!self.isfrist){
            //还原tableview的contentview大小
            let contentInsets:UIEdgeInsets = UIEdgeInsetsMake(64.0, 0.0, 0, 0.0);
            self.view.frame = CGRect.init(x:0, y: 64, width:self.view.bounds.width, height: self.view.bounds.height);
        }
    }
    
    //键盘隐藏
    override func touchesEnded(_ touches: Set<UITouch>, with event: UIEvent?) {
        self.view.endEditing(true)
    }
    func setUI(){
        toolBar = common.share.AddToolKeyboardDoneBar()
        let doneButton = UIBarButtonItem(title: "确定", style: .plain, target: self, action: #selector(self.DoneClick));
        let spaceButton = UIBarButtonItem(barButtonSystemItem: .flexibleSpace, target: nil, action: nil)
        toolBar.setItems([spaceButton,doneButton], animated: false);
        
        //        let scrollView = UIScrollView();
        //        self.view.addSubview(scrollView);
        self.view.backgroundColor = UIColor.init(red: 237/255, green: 237/255, blue: 237/255, alpha: 1);
        //        scrollView.frame = self.view.bounds
        //        scrollView.contentSize = CGSize.init(width: width, height:800);
        //        scrollView.isPagingEnabled = true
        //        scrollView.showsHorizontalScrollIndicator = true
        //        scrollView.showsVerticalScrollIndicator = true
        //        scrollView.scrollsToTop = true;
        
        let lab_Date = UILabel();
        self.view.addSubview(lab_Date);
        if common.share.isX(){
            lab_Date.snp.makeConstraints { (make) in
                make.width.equalTo(80)
                make.height.equalTo(50)
                make.top.equalTo(30)
            }
        }else{
            lab_Date.snp.makeConstraints { (make) in
                make.width.equalTo(80)
                make.height.equalTo(50)
                make.top.equalTo(4)
            }
        }
        lab_Date.backgroundColor = UIColor.white;
        lab_Date.text = "教学日期"
        lab_Date.font = UIFont.init(name: "iconfont", size: 14);
        lab_Date.textColor = UIColor.gray;
        lab_Date.textAlignment = .center;
        
        self.view.addSubview(text_Date);
        text_Date.backgroundColor = UIColor.white;
        text_Date.snp.makeConstraints { (make) in
            make.width.equalTo(width - 80);
            make.height.equalTo(50);
            make.centerY.equalTo(lab_Date.snp.centerY)
            make.left.equalTo(lab_Date.snp.right);
        }
        text_Date.font = UIFont.init(name: "iconfont", size: 14);
        
        let lab_CourseName = UILabel();
        self.view.addSubview(lab_CourseName);
        lab_CourseName.snp.makeConstraints { (make) in
            make.width.equalTo(80)
            make.height.equalTo(50)
            make.top.equalTo(text_Date.snp.bottom).offset(10)
        }
        lab_CourseName.backgroundColor = UIColor.white;
        lab_CourseName.text = "选择课程"
        lab_CourseName.font = UIFont.init(name: "iconfont", size: 14);
        lab_CourseName.textColor = UIColor.gray;
        lab_CourseName.textAlignment = .center;
        
        
        self.view.addSubview(text_CourseName);
        text_CourseName.backgroundColor = UIColor.white;
        text_CourseName.snp.makeConstraints { (make) in
            make.width.equalTo(width - 80)
            make.height.equalTo(50)
            make.left.equalTo(lab_CourseName.snp.right)
            make.centerY.equalTo(lab_CourseName.snp.centerY)
        }
        text_CourseName.font = UIFont.init(name: "iconfont", size: 14);
        text_CourseName.placeholder = "请选择课程"
        
        let lab_ClassName = UILabel();
        self.view.addSubview(lab_ClassName);
        lab_ClassName.snp.makeConstraints { (make) in
            make.width.equalTo(80)
            make.height.equalTo(50)
            make.top.equalTo(text_CourseName.snp.bottom).offset(10)
            
        }
        lab_ClassName.backgroundColor = UIColor.white;
        lab_ClassName.text = "选择班级"
        lab_ClassName.font = UIFont.init(name: "iconfont", size: 14);
        lab_ClassName.textColor = UIColor.gray;
        lab_ClassName.textAlignment = .center;
        
        
        self.view.addSubview(label_ClassName);
        label_ClassName.backgroundColor = UIColor.white;
        label_ClassName.snp.makeConstraints { (make) in
            make.width.equalTo(text_CourseName.snp.width)
            make.height.equalTo(50)
            make.left.equalTo(lab_ClassName.snp.right)
            make.centerY.equalTo(lab_ClassName.snp.centerY)
        }
        label_ClassName.font = UIFont.init(name: "iconfont", size: 14);
        label_ClassName.isUserInteractionEnabled = true;
        
        let labTapGesture = UITapGestureRecognizer.init(target: self, action: #selector(self.touch_classLab(sender:)));
        
        label_ClassName.addGestureRecognizer(labTapGesture);
        
        self.view.addSubview(text_Title);
        text_Title.backgroundColor = UIColor.white;
        text_Title.snp.makeConstraints { (make) in
            make.width.equalTo(width)
            make.height.equalTo(50)
            make.top.equalTo(label_ClassName.snp.bottom).offset(10);
        }
        text_Title.font = UIFont.init(name: "iconfont", size: 14);
        text_Title.setValue(NSNumber(value:10), forKey:"paddingLeft");
        text_Title.borderStyle = UITextBorderStyle.none;
        text_Title.placeholder = "  请输入标题";
        text_Title.tag = 1
        text_Title.becomeFirstResponder();
        text_Title.returnKeyType = UIReturnKeyType.next //表示继续下一步
        text_Title.delegate = self;
        text_Title.adjustsFontSizeToFitWidth=true ; //当文字超出文本框宽度时，自动调整文字大小
        text_Title.minimumFontSize = 12 ; //最小可缩小的字号
        
        self.view.addSubview(text_address);
        text_address.backgroundColor = UIColor.white;
        text_address.snp.makeConstraints { (make) in
            make.width.equalTo(width)
            make.height.equalTo(50)
            make.top.equalTo(text_Title.snp.bottom).offset(10);
        }
        text_address.setValue(NSNumber(value:10), forKey:"paddingLeft");
        text_address.font = UIFont.init(name: "iconfont", size: 14);
        text_address.placeholder = "  请输入教学地点"
        text_address.tag = 2
        text_address.delegate = self;
        self.view.addSubview(text_Session);
        text_Session.backgroundColor = UIColor.white;
        text_Session.snp.makeConstraints { (make) in
            make.width.equalTo(width)
            make.height.equalTo(50)
            make.top.equalTo(text_address.snp.bottom).offset(10);
        }
        text_Session.setValue(NSNumber(value:10), forKey:"paddingLeft");
        text_Session.font = UIFont.init(name: "iconfont", size: 14);
        text_Session.placeholder = "  请输入节次"
        text_Session.delegate = self;
        text_Session.tag = 3
        
    }
    
//    override func viewDidDisappear(_ animated: Bool) {
//        NotificationCenter.default.removeObserver(self)
//    }
    func textFieldShouldBeginEditing(_ textField: UITextField) -> Bool {
        textField.inputAccessoryView = toolBar;
        return true
    }
    override func touchesBegan(_ touches: Set<UITouch>, with event: UIEvent?) {
        self.view.endEditing(true)
    }
    
    
    func firstEditUI(){
        //        let savebtu = UIButton();
        //        self.view.addSubview(savebtu);
        //        savebtu.snp.makeConstraints { (make) in
        //            make.width.equalTo(width / 2)
        //            make.height.equalTo(50)
        //            make.bottom.equalTo(self.view.snp.bottom)
        //        }
        //        savebtu.setTitleColor(UIColor.white, for: .normal);
        //        savebtu.titleLabel?.font = UIFont.init(name: "iconfont", size: 16);
        //        savebtu.backgroundColor = UIColor.colorWithHex(hexColor: 0x03c192)
        //        savebtu.setTitle("保存", for:.normal);
        //        savebtu.tag = 1;
        //        savebtu.titleLabel?.baselineAdjustment = .alignCenters;
        //        savebtu.addTarget(self, action:#selector(tapped(_:)), for:.touchUpInside);
        
        //        let pushbtu = UIButton();
        //        self.view.addSubview(pushbtu);
        ////        let HX = common.share.returnSafeAreaLineHeight()
        //        pushbtu.snp.makeConstraints { (make) in
        //            make.width.equalTo(width)
        //            make.left.equalTo(0)
        //            make.height.equalTo(50)
        ////            make.centerY.equalTo(savebtu.snp.centerY)
        //            make.bottom.equalTo(self.view.snp.bottom)
        //        }
        
        let pushbtu = UIButton.init(frame:CGRect(x:0,y:height-112 + CGFloat(HX),width:width,height:50));
        //        if common.share.isX(){
        //            pushbtu.frame = CGRect.init(x: 0, y: height-137, width:width , height:50 )
        //        }
        pushbtu.titleLabel?.font = UIFont.init(name: "iconfont", size: 16);
        pushbtu.backgroundColor = UIColor.colorWithHex(hexColor: 0x04ae84)
        pushbtu.setTitle("确定", for:.normal);
        pushbtu.tag = 2;
        pushbtu.titleLabel?.baselineAdjustment = .alignCenters;
        pushbtu.addTarget(self, action:#selector(tapped(_:)), for:.touchUpInside);
        self.view.addSubview(pushbtu)
    }
    
    func editUI(){
        let editbtu = UIButton();
        self.view.addSubview(editbtu);
        editbtu.snp.makeConstraints { (make) in
            make.width.equalTo(width )
            make.height.equalTo(50)
            make.bottom.equalTo(self.view.snp.bottom).offset(HX)
        }
        editbtu.titleLabel?.font = UIFont.init(name: "iconfont", size: 16);
        editbtu.backgroundColor = UIColor.colorWithHex(hexColor: 0x04ae84)
        editbtu.setTitle("更改", for:.normal);
        editbtu.tag = 2;
        editbtu.titleLabel?.baselineAdjustment = .alignCenters;
        editbtu.addTarget(self, action:#selector(tapped(_:)), for:.touchUpInside);
    }
   
    
    
    
}
