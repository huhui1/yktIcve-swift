//
//  CourseTeachingController.swift
//  云课堂2
//
//  Created by 志辉教育 on 2018/6/21.
//  Copyright © 2018年 zqyou. All rights reserved.
//

import UIKit
import SwiftyJSON
import Alamofire

extension CourseTeachingView {


    func  getFaceTeachDate(){
        let dict = ["faceTeachType": 2,
                    "userId":Account.defaultAccount.id!,
                    "courseOpenId":self.courseOpenId,
                    "openClassId":self.openClassId] as [String : Any]

        XLBallLoading.show(in: self.view)
        Alamofire.request(appAPI.FaceTeach_getFaceTeachDate, method: .post, parameters: dict, encoding: URLEncoding.default).responseJSON { response in

            if let value = response.result.value {
                let json = JSON(value)
                if json["code"] == 1{
                    self.dates = json["dateList"].arrayValue as NSArray

                }else{
                    ZKProgressHUD.showError(json["msg"].stringValue);
                }
                XLBallLoading.hide(in: self.view)
            }else{
                ZKProgressHUD.showError("网络环境异常请稍后再试！");
                XLBallLoading.hide(in: self.view)
            }
        }
    }


    func getCourseClassList(isRefresh:Bool,date:String){
        let dict = ["openClassId":self.openClassId,
                    "faceDate":date]
        XLBallLoading.show(in: self.tableView)
        Alamofire.request(appAPI.FaceTeach_getFaceListByOpenClassId, method: .post, parameters: dict, encoding: URLEncoding.default).responseJSON { response in
            
            if let value = response.result.value {
                let json = JSON(value);
                if json["code"] == 1{
                    self.courseList = json["dataList"]

                    if(!isRefresh){
                        //结束刷新
                        self.tableView.mj_header.endRefreshing()
                    }
                    common.share.setTableFootView_noData(self.tableView, list: json["dataList"].arrayValue as NSArray)
                    self.tableView.reloadData()
                }else{
                    ZKProgressHUD.showError(json["msg"].stringValue);
                }
                XLBallLoading.hide(in: self.tableView)
            }else{
                ZKProgressHUD.showError("网络异常请稍后再试！");
                XLBallLoading.hide(in: self.tableView)
            }
        }
    }
    //删除面授
    func delFaceActivity(activityId:String,_ tableView: UITableView,forRowAt indexPath: IndexPath){
        XLBallLoading.show(in: self.view)
        let dict = ["activityId":activityId]
        Alamofire.request(appAPI.FaceTeach_delFaceTeach, method: .post, parameters: dict, encoding: URLEncoding.default).responseJSON { response in
            XLBallLoading.hide(in: self.view)
            if let value = response.result.value {
                let json = JSON(value)
                if(json["code"] == 1){
                    var arr = self.courseList.arrayValue
                    arr.remove(at: indexPath.row)
                    self.courseList = JSON(arr)
                    tableView.deleteRows(at: [indexPath], with: UITableViewRowAnimation.fade)
                    ZKProgressHUD.showMessage(json["msg"].stringValue);
                }else{
                    ZKProgressHUD.showError(json["msg"].stringValue);
                }
                
            }else{
                XLBallLoading.hide(in: self.view)
                ZKProgressHUD.showError("网络环境异常请稍后再试！");
            }
        }
    }
    
}
