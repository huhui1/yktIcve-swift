//
//  coursewareInterpretationView.swift
//  云课堂2
//课件讲解
//  Created by 志辉教育 on 2018/7/11.
//  Copyright © 2018年 zqyou. All rights reserved.
//

import UIKit
import SwiftyJSON
import Alamofire
class coursewareInterpretationView: UIViewController,UITableViewDelegate,UITableViewDataSource {
    
    
    override func viewDidLoad() {
        super.viewDidLoad()

        let item = UIBarButtonItem(title: "返回", style: .plain, target: self, action: nil)
        self.navigationItem.backBarButtonItem = item
            self.getzjyhoompageData(isRefresh: true)
            self.myTableView.register(UINib(nibName:"zjyhoompagecell", bundle:nil),
                                      forCellReuseIdentifier:"zjyhoompagecell")
            // 设置分割线的样式为None.
            self.myTableView.separatorStyle = UITableViewCellSeparatorStyle.none
            
            self.myTableView.tableFooterView = UIView(frame:CGRect.zero)//除去多余的cell
            
            //下拉刷新相关设置,使用闭包Block
            self.myTableView.mj_header = MJRefreshNormalHeader(refreshingBlock: {
                //重现生成数据
                self.getzjyhoompageData(isRefresh: false)
            })
            self.myTableView.dataSource = self
            self.myTableView.delegate = self
    
    }
    
    override func viewWillAppear(_ animated: Bool) {
        super.viewWillAppear(false)
        
    }
    
    init() {
        super.init(nibName: "coursewareInterpretationView", bundle: nil)
    }
    
    required init?(coder aDecoder: NSCoder) {
        fatalError("init(coder:) has not been implemented")
    }
    
 
    
    override func viewWillDisappear(_ animated: Bool) {
        super.viewWillDisappear(false)
        
    }
    
    override func didReceiveMemoryWarning() {
        super.didReceiveMemoryWarning()
        // Dispose of any resources that can be recreated.
    }
    
    func tableView(_ tableView: UITableView, numberOfRowsInSection section: Int) -> Int {
        return jsonlist.count
    }
    func tableView(_ tableView: UITableView, heightForRowAt indexPath: IndexPath) -> CGFloat {
        return 140
    }
    func tableView(_ tableView: UITableView, cellForRowAt indexPath: IndexPath) -> UITableViewCell {
        
        let cell:zjyhoompagecell = tableView.dequeueReusableCell(withIdentifier: "zjyhoompagecell")
            as! zjyhoompagecell
        cell.selectionStyle = UITableViewCellSelectionStyle.none
        
        let jsondata = self.jsonlist[indexPath.row]
//        cell.setdata(json: jsondata)
        return cell
    }
    
    
    //点击tabview跳转
    func tableView(_ tableView: UITableView, didSelectRowAt indexPath: IndexPath) {
        let vc  = linkclassView()
        let json = self.jsonlist[indexPath.row]
        vc.courseOpenId = json["courseOpenId"].stringValue
        vc.hidesBottomBarWhenPushed = true
        self.navigationController?.pushViewController(vc, animated: true)
    }
    let width = UIScreen.main.bounds.width
    lazy var classState:Int = {//0、全部，1：未归档,2：已归档
        return 0
    }()
    lazy var jsonlist : JSON =  {
        return []
    }()
    
    @IBOutlet weak var myTableView: UITableView!
    
 
    

}
extension coursewareInterpretationView {
    func getzjyhoompageData(isRefresh:Bool){
        let dict = ["userId":Account.defaultAccount.id!] as [String : Any];
        Alamofire.request(appAPI.DesignTeacher_getCourseData, method: .post, parameters: dict, encoding: URLEncoding.default).responseJSON { response in
            
            if let value = response.result.value {
                let json = JSON(value);
                if json["code"] == 1{
                    self.jsonlist = json["courseList"]
                    self.myTableView.reloadData()
                    if(!isRefresh){
                        //结束刷新
                        self.myTableView.mj_header.endRefreshing()
                    }
                    common.share.setTableFootView_noData(self.myTableView, list: self.jsonlist.arrayValue as NSArray)
                }else{
                    ZKProgressHUD.showError(json["msg"].stringValue);
                }
                XLBallLoading.hide(in: self.view)
            }else{
                ZKProgressHUD.showError("网络异常请稍后再试！");
                XLBallLoading.hide(in: self.view)
            }
        }
    }
    
}
