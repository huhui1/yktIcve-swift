//
//  testSingleViewController.swift
//  云课堂职教云
//
//  Created by 尤增强 on 2018/4/10.
//  Copyright © 2018年 jcjy. All rights reserved.
//

import UIKit
import Alamofire
import SwiftyJSON

extension testSingleView {

    func previewImg(url:String){
        let vc = whiteboardView();

        vc.modalTransitionStyle = .crossDissolve
        vc.file = url

        self.present(vc, animated: true, completion: nil)

    }

    //通过URL获取
    func getFileInfoByUrl(url:String){

        let dict = ["url": url];
        //        ZKProgressHUD.setAnimationStyle(.chrysanthemum);
//
//        ZKProgressHUD.show();
        XLBallLoading.show(in: self.view)
        Alamofire.request(appAPI.MobileLogin_getFileInfoByUrl, method: .post, parameters: dict, encoding: URLEncoding.default).responseJSON { response in

            if let value = response.result.value {
                let json = JSON(value)
                if json["code"] == 1{

//                    ZKProgressHUD.hide()
                    self.pushView(data: json["url"].stringValue)
                }else{
                    ZKProgressHUD.showError(json["msg"].stringValue);
                }
                XLBallLoading.hide(in: self.view)
            }else{
                ZKProgressHUD.showError("网络环境异常请稍后再试！");
                XLBallLoading.hide(in: self.view)
            }
        }

    }

    //打开观看
    func pushView(data:String){
        let json = JSON.init(parseJSON: data)
        switch json["category"] {
        case "video":
            print("====")
            let vc = videoPlayView()
            vc.isFromZjyErrorQuestion = true
            vc.videourls.removeAll()
            vc.videourls.append(json["urls"]["preview"].stringValue)

            self.navigationController?.pushViewController(vc, animated: true)
        case "mp3":
            let  vc = audioViewController();
            if(!json["urls"]["preview_oss_gen"].stringValue.isEmpty){
                vc.audiourl = json["urls"]["preview_oss_gen"].stringValue
            }else{
                vc.audiourl = json["urls"]["preview"].stringValue
            }

            vc.title = "测验附件音频"
            vc.isNet = true

            vc.hidesBottomBarWhenPushed = true
            self.navigationController?.pushViewController(vc, animated: true)

        case "img":
            let vc = whiteboardView()
            vc.file = json["urls"]["preview_oss_ori"].stringValue
            if(json["urls"]["preview_oss_ori"].stringValue.isEmpty){
                vc.file = json["urls"]["preview"].stringValue
            }

            present(vc, animated: true, completion: nil)
        case "office","ppt","pptx","doc","docx":
            if(json["isH5"].intValue == 1){
                let vc = teacherPPTOffficeViewViewController()
                vc.isTeaching = false

                vc.resourceUrl = data
                present(vc, animated: false, completion: nil)
            }else{
                let  vc = previewOfficeFromresViewController()
              
                vc.resourceUrl = data
                present(vc, animated: false, completion: nil)
            }
        default:

            print("11")
        }
    }

}
