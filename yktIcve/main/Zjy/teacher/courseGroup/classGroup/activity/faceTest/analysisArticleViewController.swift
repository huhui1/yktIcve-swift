//
//  analysisArticleViewController.swift
//  yunketang
//
//  Created by zqy on 2018/3/5.
//  Copyright © 2018年 zqy. All rights reserved.
//

import Foundation
import SwiftyJSON
import Alamofire
extension analysisArticleView{

    //跳转答题详情
   @objc func analysisdetails(){
        let vc = analysisDetailsView()
        vc.classTestId = self.classTestId
        vc.activityId = self.activityId
        vc.courseOpenId = self.courseOpenId
        vc.questionId = self.questionId

        self.navigationController?.pushViewController(vc, animated: true)
    }

    func addEventListener(data:JSON){

        let params = ["type":"questionAnalysis",
                      "data":data,
                      "order":self.index] as [String : Any];

        let dict = ["type":"face",
                    "params":JSON.init(params).description ];
        ZQSocketManager.share.notificationSocketManager(data: dict)
    }
    func previewImg(url:String){
        let vc = whiteboardView();

        vc.modalTransitionStyle = .crossDissolve
        vc.file = url

        self.present(vc, animated: true, completion: nil)

    }

    //通过URL获取
    func getFileInfoByUrl(url:String){

        let dict = ["url": url];
        XLBallLoading.show(in: self.view)
        Alamofire.request(appAPI.MobileLogin_getFileInfoByUrl, method: .post, parameters: dict, encoding: URLEncoding.default).responseJSON { response in

            if let value = response.result.value {
                let json = JSON(value)
                if json["code"] == 1{

                    self.pushView(data: json["url"].stringValue)
                }else{
                    ZKProgressHUD.showError(json["msg"].stringValue);
                }
                XLBallLoading.hide(in: self.view)
            }else{
                ZKProgressHUD.showError("网络环境异常请稍后再试！");
                XLBallLoading.hide(in: self.view)
            }
        }

    }

    //打开观看
    func pushView(data:String){
        let json = JSON.init(parseJSON: data)
        switch json["category"] {
        case "video":
            print("===")
//            let  vc = videoAVViewController();
//            vc.videourl =  json["urls"]["preview"].stringValue
//            vc.resourcesUrl = json
//            self.isPushed = true
//            self.navigationController?.pushViewController(vc, animated: true);

        case "mp3":
            let  vc = audioViewController();
            if(!json["urls"]["preview_oss_gen"].stringValue.isEmpty){
                vc.audiourl = json["urls"]["preview_oss_gen"].stringValue
            }else{
                vc.audiourl = json["urls"]["preview"].stringValue
            }

            vc.title = "作业附件音频"
            vc.isNet = true

            vc.hidesBottomBarWhenPushed = true
            self.navigationController?.pushViewController(vc, animated: true)

        case "img":
            let vc = whiteboardView()
            vc.file = json["urls"]["preview_oss_ori"].stringValue
            if(json["urls"]["preview_oss_ori"].stringValue.isEmpty){
                vc.file = json["urls"]["preview"].stringValue
            }

            present(vc, animated: true, completion: nil)
        case "office","ppt","pptx","doc","docx":
            print("===")
////            let  vc = previewOfficeFromresViewController()
////            self.isPushed = true
////            vc.resourceUrl = data
////            present(vc, animated: false, completion: nil)
//            if(json["isH5"].intValue == 1){
//                let vc = teacherPPTOffficeViewViewController()
//                vc.isTeaching = false
//                self.isPushed = true
//                vc.resourceUrl = data
//                present(vc, animated: false, completion: nil)
//            }else{
//                let  vc = previewOfficeFromresViewController()
//                self.isPushed = true
//                vc.resourceUrl = data
//
//                present(vc, animated: false, completion: nil)
//            }
        default:

            print("11")
        }
    }

}
