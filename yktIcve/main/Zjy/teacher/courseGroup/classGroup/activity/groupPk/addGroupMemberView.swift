//
//  addGroupMemberView.swift
//  yunketang
//
//  Created by zqy on 2018/2/28.
//  Copyright © 2018年 zqy. All rights reserved.
//

import UIKit

class addGroupMemberView: UIViewController,UITableViewDelegate,UITableViewDataSource {
    var tableView:UITableView!
    var reloadClosure :(() ->Void)?
    var list :NSArray = [];
    override func viewDidLoad() {
        super.viewDidLoad()
        self.setTableViewUI()
         self.setFootUI()
        self.title = "选择成员"
        self.view.backgroundColor = UIColor.white
        if #available(iOS 9.0, *) {
            tableView.cellLayoutMarginsFollowReadableWidth = false
        } else {
            // Fallback on earlier versions
        }
        
        self.refreshItemData(isRefresh: true)
        
        //下拉刷新相关设置,使用闭包Block
        self.tableView.mj_header = MJRefreshNormalHeader(refreshingBlock: {
            //重现生成数据
            self.refreshItemData(isRefresh:false);
            
        })

    }
    private func setTableViewUI(){
        
        //创建表视图
        self.tableView = UITableView.init(frame: CGRect(x:0, y:0, width:UIScreen.main.bounds.width, height:UIScreen.main.bounds.height - 113));
        if common.share.isX(){
            self.tableView = UITableView.init(frame: CGRect(x:0, y:0, width:UIScreen.main.bounds.width, height:UIScreen.main.bounds.height - 165));
        }
        self.tableView.delegate = self;
        self.tableView.dataSource = self;
        //创建一个重用的单元格
        self.tableView.register(addGroupMemberTableCell.self, forCellReuseIdentifier: "addGroupMemberTableCell")
        self.tableView.tableFooterView = UIView(frame:CGRect.zero)//除去多余的cell
        self.tableView.separatorInset = UIEdgeInsets.zero;
        self.tableView.layoutMargins = UIEdgeInsets.zero;
        
        self.tableView.tableFooterView = UIView.init(frame: CGRect.zero)
        
        if #available(iOS 9.0, *) {
            self.tableView.cellLayoutMarginsFollowReadableWidth = false
        } else {
            
        }
        self.tableView.allowsMultipleSelectionDuringEditing = true
        self.tableView.setEditing(true, animated:true)
        //rowHeight属性设置为UITableViewAutomaticDimension
        self.tableView.rowHeight = UITableViewAutomaticDimension;
//        self.tableView.separatorStyle = .
//        self.tableView!.backgroundColor = UIColor.colorWithHex(hexColor: 0xf2f2f2)
        self.view.addSubview(self.tableView!);
        
    }
    func setFootUI(){
        self.view.addSubview(divideGroupBtn)
        let HX = common.share.returnSafeAreaLineHeight()
        self.divideGroupBtn.snp.makeConstraints { (make) in
            make.width.equalTo(UIScreen.main.bounds.width)
            make.height.equalTo(50)
            make.bottom.equalTo(self.view.snp.bottom).offset(HX)
        }
        self.divideGroupBtn.addTarget(self, action: #selector(self.submit(_:)), for: .touchUpInside)
    }
    override func didReceiveMemoryWarning() {
        super.didReceiveMemoryWarning()
        // Dispose of any resources that can be recreated.
    }
    
    // MARK: - Table view data source
    
    func numberOfSections(in tableView: UITableView) -> Int {
        // #warning Incomplete implementation, return the number of sections
        return 1
    }
    
    func tableView(_ tableView: UITableView, heightForRowAt indexPath: IndexPath) -> CGFloat
    {
        return 50;
    }
    
    
    
    //返回表格行数（也就是返回控件数）
    func tableView(_ tableView: UITableView, numberOfRowsInSection section: Int) -> Int {
        
        return self.list.count;
    }
    
    //创建各单元显示内容(创建参数indexPath指定的单元）
    func tableView(_ tableView: UITableView, cellForRowAt indexPath: IndexPath)
        -> UITableViewCell {
            
            let cell:addGroupMemberTableCell = tableView.dequeueReusableCell(withIdentifier: "addGroupMemberTableCell") as! addGroupMemberTableCell

            let stuInfo = stuInfos[indexPath.row]
            cell.lab_Name.text = stuInfo.name
            cell.lab_num.text = stuInfo.no
//            cell.imgView_avatar.sd_setImage(with: URL(string: stuInfo.url), placeholderImage: UIImage(named: "default_slider_img.png"))
            common.share.setSDImg(str: stuInfo.url, imgview: cell.imgView_avatar)

            return cell
    }

    lazy  var divideGroupBtn : UIButton = {
        let btn = UIButton()
        btn.contentMode = .center
        btn.setTitleColor(UIColor.white, for: .normal)
        btn.setTitle("完成", for: .normal)
        btn.backgroundColor = UIColor.colorWithHex(hexColor: 0x23c397)
        btn.titleLabel?.font = UIFont.init(name: "iconfont", size: 16)
        return btn ;
        
    }()
    lazy var PKId :String = {return ""}()
    lazy var groupId:String = {return ""}()

    var stuInfos = [addGroupMember]()

}
class addGroupMember{
    let id:String
    let name:String
    let openClassId:String
    let url:String
    let no :String
    //默认初始图片
    var image = UIImage(named: "placeholder")
    
    init(id:String,name:String,openClassId:String, url:String,no:String) {
        self.name = name
        self.openClassId = openClassId
        self.url = url
        self.no = no
        self.id = id
    }
}

