//
//  discussCommentController.swift
//  66iclasscloud
//
//  Created by 尤增强 on 2018/1/17.
//  Copyright © 2018年 zqy. All rights reserved.
//

import UIKit
import SwiftyJSON
import Alamofire
extension  discussCommentView {
    func delDiscussReply(discussReplyId:String){
        let alertController = UIAlertController(title: "提示！",
                                                message:"是否删除讨论?", preferredStyle: .alert)
        let cancelAction = UIAlertAction(title: "取消", style: .cancel, handler: nil)
        let okAction = UIAlertAction(title: "确定", style: .destructive, handler: {
            action in
            XLBallLoading.show(in: self.view)
            let dict = ["discussReplyId":discussReplyId] as [String : Any]
            Alamofire.request(appAPI.FaceTeach_delDiscussReply, method: .post, parameters: dict, encoding: URLEncoding.default).responseJSON { response in
                if let value = response.result.value {
                    let json = JSON(value)
                    if json["code"] == 1{
                        ZKProgressHUD.showMessage(json["msg"].stringValue)
                        //删除成功后返回上一个界面
                        self.navigationController?.popViewController(animated: true)
                        self.reloadDiscussReply!()
                    }else{
                        ZKProgressHUD.showError(json["msg"].stringValue);
                    }
                    XLBallLoading.hide(in: self.view)
                }else{
                    ZKProgressHUD.showError("网络环境异常请稍后再试！");
                    XLBallLoading.hide(in: self.view)
                }
            }
        })
        alertController.addAction(cancelAction)
        alertController.addAction(okAction)
        
        self.present(alertController, animated: true, completion: nil)
    }
    
    @objc func touch_image(sender: UITapGestureRecognizer){

       let vc = whiteboardView()
        vc.file = self.onlineImgurl
        self.present(vc, animated: true, completion: nil)
    }
    @objc func Touch_Image(){
        
        let vc = PicturePreviewView()
//        vc.imageURL = NSURL.init(string: self.onlineImgurl)! as URL
        vc.imgurl = self.onlineImgurl
        self.navigationController?.pushViewController(vc, animated: true)
    }

    func addEventListener(){

        var content = json["content"].stringValue

        if( json["docJson"].stringValue.count > 10){
            content += "[图片]";
        }

        let params = ["type":"discussDetail",
                      "name": json["creatorName"].stringValue,
                      "content": content ,
                      "color": "",
                      "avatar": json["avator"].stringValue,
                      "discussId":"",
                      "appreciate": 0,
                      "fromRes":false] as [String : Any];

        let dict = ["type":"face",
                    "params":JSON.init(params).description ];
        ZQSocketManager.share.notificationSocketManager(data: dict)

    }

}
