//
//  summarizeController.swift
//  66iclasscloud
//
//  Created by zqy on 2018/1/31.
//  Copyright © 2018年 zqy. All rights reserved.
//
import UIKit
import Alamofire
import SwiftyJSON

extension  summarizeView {
    
    func refreshItemData(isRefresh:Bool){
        
        let dict = ["activityId":self.activityId,
                    "courseOpenId":self.courseOpenId] ;
        Alamofire.request(appAPI.FaceTeach_getStuPerformance, method: .post, parameters: dict, encoding: URLEncoding.default).responseJSON { response in
            
            if let value = response.result.value {
                let json = JSON(value)
                if json["code"] == 1{
                    self.list = []
                    if json["list"].count > 0{
                        self.list = json["list"].arrayValue as NSArray;
                    }
                    
                    self.fetchCoverDetails(isRefresh: isRefresh)
                }else{
                    ZKProgressHUD.showError("网络异常请稍后再试！");
                }
            }else{
                ZKProgressHUD.showError("网络环境异常请稍后再试！");
            }
        }
        
    }
    
    @objc func orderBytype(_ btn:UIButton){
        
        if self.topview.btn_attend != btn {
            self.topview.btn_attend.isSelected = false
        }

        if self.topview.btn_score != btn {
            self.topview.btn_score.isSelected = false
        }
        
        let tag = btn.tag
        btn.isSelected = !btn.isSelected
        
        self.orderByType(type: tag,isAsc:btn.isSelected)
    }
    
    func orderByType(type:Int,isAsc:Bool){
        if (type == 1){
            self.selStuInfos.sort(by: {(stu1, stu2) in
                if(isAsc){
                    return stu1.JoinCount > stu2.JoinCount
                }else{
                    return stu1.JoinCount < stu2.JoinCount
                }
                
            })
        }else {
        
            self.selStuInfos.sort(by: {(stu1, stu2) in
                if(isAsc){
                    return stu1.Score > stu2.Score
                }else{
                    return stu1.Score < stu2.Score
                }
            })
            
        }
        self.tableView.reloadData()
        
    }
    //当堂打分
    func checkScore(json:JSON,score:Int){
        let dict = ["openClassId":json["openClassId"],"activityId":self.activityId,"stuId":json["stuId"],"score":score,"sourceType":3] as [String : Any]
        
        Alamofire.request(appAPI.FaceTeach_saveFaceTeachStuScore, method: .post, parameters: dict, encoding: URLEncoding.default).responseJSON { response in
            
            if let value = response.result.value {
                let json = JSON(value)
                if json["code"] == 1{
                self.tableView.reloadData()
                }else{
                    ZKProgressHUD.showError("网络异常请稍后再试！");
                }
            }else{
                ZKProgressHUD.showError("网络环境异常请稍后再试！");
            }
        }
        
    }

}
