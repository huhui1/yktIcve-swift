//
//  createQuestionnaireQuestionChoiceViewController.swift
//  云课堂-职教云
//
//  Created by cc on 2018/4/3.
//  Copyright © 2018年 zqy. All rights reserved.
//

import UIKit
import SwiftyJSON
import Alamofire

extension questionnaireCreateChoiceView{
    //添加题目
   @objc func addQuestionChoice(){
        let Title = text_title.text!
        
        if(Title.count < 1){
            ZKProgressHUD.showMessage("请输入内容");
            return;
        }

        var c = 0;
        for i in 0..<self.choiceOptional.count{

            if let str:String = self.choiceOptional[i]["Content"] as! String{

                if(str.count < 1){
                   c += 1
                }
            }
        }

        if(c == self.choiceOptional.count){

            ZKProgressHUD.showMessage("选项不能全为空！")
            return ;
        }


        let dict = ["Id":self.Id,
                    "QuestionnaireId":self.QuestionnaireId,
                    "ActivityId":self.ActivityId,
                    "QuestionType":self.tag,
                    "Title":self.text_title.text!,
                    "SourceType":3,
                    "DataJson":JSON.init(self.choiceOptional).description] as [String :Any]
        

        XLBallLoading.show(in: self.view)
        let data = ["data":JSON.init(dict),"teaId":Account.defaultAccount.id!,"classState":self.classState] as [String : Any]
        Alamofire.request(appAPI.FaceTeach_addQuestionnaireQuestion, method: .post, parameters: data, encoding: URLEncoding.default).responseJSON { response in
            if let value = response.result.value {
                let json = JSON(value)
                if json["code"] == 1{
                    self.Id = json["Id"].stringValue
                    self.QuestionnaireId = json["QuestionnaireId"].stringValue
                    let questionnaire = Questionnaire.init(id: self.Id, title: self.text_title.text!, type: self.tag, datajson: self.choiceOptional)
                    self.reloadquestionnaireChoiceListClosure!(questionnaire,self.QuestionnaireId,self.Id);
                    
                    self.navigationController?.popViewController(animated: true)
                    
                }else{
                    ZKProgressHUD.showError(json["msg"].stringValue);
                }
                XLBallLoading.hide(in: self.view)
            }else{
                XLBallLoading.hide(in: self.view)
                ZKProgressHUD.showError("网络环境异常请稍后再试！");
            }
        }
    }
}

