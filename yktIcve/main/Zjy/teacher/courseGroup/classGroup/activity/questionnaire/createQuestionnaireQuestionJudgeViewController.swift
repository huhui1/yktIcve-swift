//
//  createQuestionnaireQuestionJudgeViewController.swift
//  云课堂-职教云
//
//  Created by cc on 2018/3/31.
//  Copyright © 2018年 zqy. All rights reserved.
//

import UIKit
import SwiftyJSON
import Alamofire

extension questionnaireCreateJudgeView{
    //添加题目
    @objc func addQuestionJudge(){
        let Title = text_title.text!
        
        if(Title.characters.count < 1){
            ZKProgressHUD.showMessage("请输入内容");
            return;
        }
        let dict = ["Id":self.Id,
                    "QuestionnaireId":self.QuestionnaireId,
                    "ActivityId":self.ActivityId,
                    "QuestionType":3,
                    "Title":self.text_title.text!,
                    "SourceType":3,
                    "DataJson":JSON.init(self.choiceOptional).description] as [String :Any]

        XLBallLoading.show(in: self.view)
        let data = ["data":JSON.init(dict),"teaId":Account.defaultAccount.id!,"classState":self.classState] as [String : Any]
        Alamofire.request(appAPI.FaceTeach_addQuestionnaireQuestion, method: .post, parameters: data, encoding: URLEncoding.default).responseJSON { response in
            if let value = response.result.value {
                let json = JSON(value)
                if json["code"] == 1{
                    self.Id = json["Id"].stringValue
                    self.QuestionnaireId = json["QuestionnaireId"].stringValue
                    let questionnaire = Questionnaire.init(id: self.Id, title: self.text_title.text!, type: 3, datajson: self.choiceOptional)
                    self.reloadquestionnaireListClosure!(questionnaire,self.QuestionnaireId,self.Id);
                    self.navigationController?.popViewController(animated: true)
                    
                }else{
                    ZKProgressHUD.showError(json["msg"].stringValue);
                }
                XLBallLoading.hide(in: self.view)
            }else{
                XLBallLoading.hide(in: self.view)
                ZKProgressHUD.showError("网络环境异常请稍后再试！");
            }
        }
    }
}

