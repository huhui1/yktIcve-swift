//
//  selectTeacherController.swift
//  云课堂2
//
//  Created by 志辉教育 on 2018/6/28.
//  Copyright © 2018年 zqyou. All rights reserved.
//

import UIKit
import Alamofire
import SwiftyJSON

extension selectTeacherView {
    
    func getdata(isRefresh:Bool,teacher:String){
        
        let dict = ["schoolId":self.schoolId,
                    "page":self.page,
                    "teacher":teacher] as [String : Any]
        if(isRefresh){
            XLBallLoading.show(in: self.view)
        }
        Alamofire.request(appAPI.DesignTeacher_getSchoolTeacherList, method: .post, parameters: dict, encoding: URLEncoding.default).responseJSON { response in
            if let value = response.result.value {
                let json = JSON(value)
                if json["code"] == 1{
                    
                    if(json["teacherList"].count < 1){
                        self.tableView.mj_footer.isHidden = true;
                    }
                    
                    self.fetchCoverDetails(isRefresh: isRefresh,json:json["teacherList"])
                    if(isRefresh){
                        //                        ZKProgressHUD.hide();
                        XLBallLoading.hide(in: self.view)
                    }
                    common.share.setTableFootView_noData(self.tableView, list: self.selTeaInfos as NSArray)
                }else{
                    ZKProgressHUD.showError(json["msg"].stringValue);
                }
                
            }else{
                ZKProgressHUD.showError("网络环境异常请稍后再试！");
            }
        }
        
    }
    func  fetchCoverDetails(isRefresh:Bool,json:JSON){
        
        
        let indexstart =  self.reservedInfo.count > 0 ? self.reservedInfo.count : 0 ;
        for i in json{
            let teacherInfo = selectTeacherModel.init(json: i.1,selectId:self.selectId,index:Int(i.0)! + indexstart)
            self.reservedInfo.append(teacherInfo)
            self.selTeaInfos.append(teacherInfo)
        }
        self.tableView.mj_footer.endRefreshing()
        self.tableView.reloadData();
        
    }
    //选择老师
   @objc func selectTeacher(){
        self.teaIdList = [];
        self.teaNameList = [];
        for i in self.selTeaInfos{
            if i.isSelect{
                self.teaIdList.append(i.teaId!)
                self.teaNameList.append(i.teaName!)
            }
        }
    
    
        if(teaIdList.count == 0){
            ZKProgressHUD.showMessage("请选择授课老师!")
            return
        }
        if(teaIdList.count>1){
            ZKProgressHUD.showMessage("每次请选择一个授课老师!")
            return
        }else{
            self.reloadTeacherClosure!(teaIdList,teaNameList)
            self.navigationController?.popViewController(animated: true)
        }
        
    }
    
    
    
}

