//
//  courseware_tuWenViewController.swift
//  云课堂2
//
//  Created by 尤增强 on 2018/7/2.
//  Copyright © 2018年 zqyou. All rights reserved.
//

import UIKit
import Alamofire
import SwiftyJSON

extension courseware_tuWenView{

    //获取图文信息
    func getTuwenData(){

        let dict = ["courseOpenId": self.courseOpenId,"cellId":self.cellId]

        XLBallLoading.show(in: self.view)
        Alamofire.request(appAPI.AssistTeacher_getImgTextUrl, method: .post, parameters: dict, encoding: URLEncoding.default).responseJSON { response in

            if let value = response.result.value {
                let r = JSON(value)
                if r["code"] == 1{
                    self.setHeadUI(json:r)
                   
                }else{
                    ZKProgressHUD.showMessage(r["msg"].stringValue);
                }
                XLBallLoading.hide(in: self.view)
            }else{
                ZKProgressHUD.showMessage("网络环境异常请稍后再试！");
                XLBallLoading.hide(in: self.view)
            }
        }
    }


    //保存学习日志
   func savePlayLog(){
     if(!self.isStu){return }
     self.studyCellTime =  self.studyCellTime > 10 ? self.studyCellTime:10
    let dict = ["openClassId":self.openClassId,
                "courseOpenId":self.courseOpenId,
                "cellId":self.cellId,
                "cellLogId":self.cellLogId,
                "sourceType":3,
                "studyCellTime":self.studyCellTime,
                "picNum": 0,
                "studyNewlyTime":0,
                "studyNewlyPicNum":0,
                "token":self.token] as [String : Any];
        XLBallLoading.show(in: self.view)
        Alamofire.request(appAPI.Student_stuProcessCellLog, method: .post, parameters: dict, encoding: URLEncoding.default).responseJSON { response in
            
            if let value = response.result.value {
                let json = JSON(value)
                if json["code"] == 1{
                    //已学习
                    self.StuCourseKJModel?.zjycellRefresh = "zjycellRefresh"
                }
                XLBallLoading.hide(in: self.view)
            }else{
                ZKProgressHUD.showError("网络环境异常请稍后再试！");
                XLBallLoading.hide(in: self.view)
            }
        }
    }
    @objc func Discuss(){
        let vc = courseBBSListView()
        vc.courseOpenId = self.courseOpenId
        vc.openClassId = self.openClassId
        vc.activeType = 1
        vc.docId = self.cellId
        vc.isStu = self.isStu
        self.navigationController?.pushViewController(vc, animated: true)
    }

        //指示浮窗
        func maskView(){
            self.makeView.frame = CGRect.init(x: 0, y: 0, width: UIScreen.main.bounds.width, height: UIScreen.main.bounds.height)
            self.makeView.backgroundColor = UIColor(red: 0, green: 0, blue: 0, alpha: 0.3);
            let tapBtn = UIButton.init()
            tapBtn.setBackgroundImage(UIImage.init(named: "handTap.png"), for: .normal)
            
            self.makeView.addSubview(tapBtn)
            tapBtn.snp.makeConstraints { (make) in
                make.width.height.equalTo(60)
                make.top.equalTo(0)
                make.right.equalTo(2)
            }
            let Btn_title = UIButton.init()
            Btn_title.setTitle("评论，问答，笔记，纠错，请点击这里 | 下一步", for: .normal)
            Btn_title.setTitleColor(UIColor.white, for: .normal)
            self.view.addSubview( self.makeView)
            self.makeView.addSubview( Btn_title)
            let lw = UIScreen.main.bounds.width - 70  > 300 ? 300 :UIScreen.main.bounds.width - 70
            Btn_title.snp.makeConstraints { (make) in
                make.width.equalTo(lw)
                make.height.equalTo(30)
                make.right.equalTo(tapBtn.snp.left)
                make.centerY.equalTo(tapBtn)
            }
            Btn_title.titleLabel?.adjustsFontSizeToFitWidth = true
            tapBtn.addTarget(self, action: #selector(self.hideview), for: .touchUpInside)
            Btn_title.addTarget(self, action: #selector(self.hideview), for: .touchUpInside)
        }
        
        @objc func hideview(){
            self.makeView.isHidden = true
            let cx = SQLiteManagerMask()
            cx.updateData(isType: "isbrowselessonTuwen")
        }
        
  
}
