//
//  faceInfoController.swift
//  云课堂2
//
//  Created by 志辉教育 on 2018/7/10.
//  Copyright © 2018年 zqyou. All rights reserved.
//
import UIKit
import Alamofire
import SwiftyJSON

extension faceInfoView {
    
    func pushVCByType(type:String,classState:Int){
        var vc = UIViewController();
        vc.title = type
        if(type == "课前要求" || type == "课后安排"){
            self.getIsRequire(classState:classState)
        }else {
            switch type {
            case "测验":
                let newvc = faceTestListTableView();
                newvc.activityId = self.activityId
                newvc.courseOpenId = self.courseOpenId
                newvc.openClassIds = self.openClassIds
                newvc.classState = classState
                vc = newvc;
            case "投票":
                let newvc = faceVoteListView();
                newvc.classState = classState
                newvc.activityId = self.activityId
                newvc.courseOpenId = self.courseOpenId
                newvc.openClassId = self.openClassIds
                vc = newvc;
            case "讨论":
                let newvc = discussListView();
                newvc.classState = classState
                newvc.activityId = self.activityId 
                newvc.courseOpenId = self.courseOpenId
                newvc.openClassIds = self.openClassIds
                vc = newvc;
            case "签到":
                let newvc = signListView(); 
                newvc.activityId = self.activityId;
                newvc.courseOpenId = self.courseOpenId;
                newvc.openClassIds = self.openClassIds
                vc = newvc;
            case "问卷调查":
                let newvc = questionnaireView();
                newvc.activityId = self.activityId;
                newvc.courseOpenId = self.courseOpenId;
                newvc.classState = classState
                newvc.openClassId = self.openClassIds
                vc = newvc;
            case "小组PK":
                let newvc = groupPKListView();
                newvc.activityId=self.activityId;
                newvc.courseOpenId=self.courseOpenId;
                newvc.openClassIds = self.openClassIds
                vc=newvc;
            case "头脑风暴":
                let  newvc = brainStormListTableView();
                newvc.activityId = self.activityId;
                newvc.courseOpenId = self.courseOpenId;
                newvc.openClassIds = self.openClassIds
                vc = newvc;
            case "提问":
                let  newvc = askQuestionListTableView()
                newvc.activityId = self.activityId;
                newvc.courseOpenId = self.courseOpenId;
                newvc.openClassIds = self.openClassIds
                vc = newvc;
            case "评价":
                let  newvc = evaluateListView()
                newvc.activityId = self.activityId
                newvc.openClassIds = self.openClassIds
                newvc.courseOpenId = self.courseOpenId
                vc = newvc;
            case "教学过程":
                let  newvc = teachProcessView()
                newvc.activityId = self.activityId
                newvc.openClassIds = self.openClassIds
                newvc.courseOpenId = self.courseOpenId
                vc = newvc;
            case "学生表现":
                let newvc = summarizeView()
                newvc.activityId = self.activityId
                newvc.courseOpenId = self.courseOpenId
                vc = newvc;
            case "学生总结":
                let newvc = stuSummarizeListView()
                newvc.activityId = self.activityId
                newvc.courseOpenId = self.courseOpenId
                vc = newvc
            case "课件":
                let newvc = faceCoursewareListTableView()
                newvc.activityId = self.activityId
                newvc.courseOpenId = self.courseOpenId
                newvc.openClassId = self.openClassIds
                newvc.classState = classState
                vc = newvc
            case "更多":
                let newvc = faceClassMoreView()
                newvc.parentVc = self
                newvc.activityId = self.activityId
                newvc.courseOpenId = self.courseOpenId
                newvc.modalTransitionStyle = .crossDissolve
                newvc.view.backgroundColor = UIColor.white
                newvc.view.backgroundColor = UIColor.init(red: 0, green: 0, blue: 0, alpha: 0.2)
                self.present(newvc, animated: true, completion: nil)
            case "作业":
                let newvc = faceHomeworkListTableView()
                newvc.classState = classState
                newvc.activityId = self.activityId
                newvc.courseOpenId = self.courseOpenId
                newvc.openClassId = self.openClassIds
                vc = newvc
            case "考试":
                let newvc = faceExamListTableView()
                newvc.classState = classState
                newvc.activityId = self.activityId
                newvc.courseOpenId = self.courseOpenId
                newvc.openClassId = self.openClassIds
                vc = newvc
            default:
                print("===")
                //vc = requireInfoView();
            }
            
            vc.title = type
            self.navigationController?.pushViewController(vc, animated: true);
        }
        
    }
    //当堂打分
    func addChoice(tag:Int){
        if(tag == 4){
            let vc = summarizeView()
            vc.title = "当堂打分"
            vc.activityId = self.activityId
            vc.courseOpenId = self.courseOpenId
            self.navigationController?.pushViewController(vc, animated: true)
            self.presentedViewController?.dismiss(animated:false, completion: nil)
        }
    }
    
    //判断是否有课前课后要求
    func getIsRequire(classState:Int){
        let state = classState == 3 ? 2 :1
        let dict = ["activityId": self.activityId,"state":state] as [String : Any]
        XLBallLoading.show(in: self.view)
        Alamofire.request(appAPI.FaceTeach_getFaceTeachRequire, method: .post, parameters: dict, encoding: URLEncoding.default).responseJSON { response in
            
            if let value = response.result.value {
                let json = JSON(value)
                if json["code"] == 1{
                    if(json["requireInfo"] != nil){
                        let newvc  = requireInfoView();
                        newvc.activityId = self.activityId
                        newvc.courseOpenId = self.courseOpenId
                        newvc.openClassId = self.openClassIds
                        newvc.requireType = state
                        if(state == 1){
                            newvc.title = "课前要求"
                        }else{
                            newvc.title = "课后安排"
                        }
                        newvc.dataJson = json["requireInfo"]
                        self.navigationController?.pushViewController(newvc, animated: true)
                    }else{
                        let vc = createRequireView()
                        vc.requireType = state
                        vc.activityId = self.activityId
                        vc.requireType = state
                        if(state == 1){
                            vc.title = "课前要求"
                        }else{
                            vc.title = "课后安排"
                        }
                        self.navigationController?.pushViewController(vc, animated: true);
                    }
                    
                }else{
                    ZKProgressHUD.showError(json["msg"].stringValue);
                }
                XLBallLoading.hide(in: self.view)
            }else{
                ZKProgressHUD.showError("网络开小差了！");
                XLBallLoading.hide(in: self.view)
            }
        }
        
        
        
    }
    /*
     // MARK: - Navigation
     
     // In a storyboard-based application, you will often want to do a little preparation before navigation
     override func prepare(for segue: UIStoryboardSegue, sender: Any?) {
     // Get the new view controller using segue.destinationViewController.
     // Pass the selected object to the new view controller.
     }
     */
    
}

