//
//  HomeworkReviewCell.swift
//  云课堂2
//
//  Created by cc on 2018/7/9.
//  Copyright © 2018年 zqyou. All rights reserved.
//

import UIKit
import SwiftyJSON

@objc protocol HomeworkReviewCellDelegate:NSObjectProtocol  {
    
    func returnHomework(_ btn:UIButton) -> ()
}

class HomeworkReviewCell: UITableViewCell {
    var leftMarginForLabel: CGFloat = 10
    
    //单元格是否可编辑
    var labelEditable:Bool? {
        didSet {
            
            //如果是可以编辑的话，要加大左边距（因为左边有个删除按钮）
            leftMarginForLabel = labelEditable! ? 10.0 : 50.0
            self.setNeedsLayout()
        }
    }
    override func awakeFromNib() {
        super.awakeFromNib()
        // Initialization code
    }
    var delegate :HomeworkReviewCellDelegate!
    override func setSelected(_ selected: Bool, animated: Bool) {
        super.setSelected(selected, animated: animated)

        // Configure the view for the selected state
    }
  
    
    override init(style:UITableViewCellStyle, reuseIdentifier:String?) {
        
        super.init(style: style, reuseIdentifier: reuseIdentifier);
        self.setUI();
    }
    
    required init?(coder aDecoder: NSCoder) {
        fatalError("init(coder:) has not been implemented")
    }
    
    //布局
    override func layoutSubviews() {
        super.layoutSubviews()
        print(1)
        self.Avatar.frame = CGRect(x: leftMarginForLabel, y: self.Avatar.frame.origin.y,
                             width: self.Avatar.bounds.width,
                             height: self.Avatar.bounds.height)
        
        self.lab_Name.frame =  CGRect(x:self.Avatar.frame.origin.x + 50 , y: self.lab_Name.frame.origin.y,
                                      width: self.lab_Name.bounds.width,
                                      height: self.lab_Name.bounds.height)
        
        self.lab_Num.frame =  CGRect(x:self.Avatar.frame.origin.x + 50 , y: self.lab_Num.frame.origin.y,
                                      width: self.lab_Num.bounds.width,
                                      height: self.lab_Num.bounds.height)
    }
    
    func setUI(){
        print(2)
        self.addSubview(self.Avatar)
        self.addSubview(self.lab_Name)
        self.addSubview(self.lab_Num)
        self.addSubview(self.lab_grade)
        self.Avatar.snp.makeConstraints { (make) in
            make.width.height.equalTo(40)
            make.centerY.equalTo(self.snp.centerY)
            make.left.equalTo(self.snp.left).offset(leftMarginForLabel)
        }
        self.Avatar.layer.masksToBounds = true
        self.Avatar.layer.cornerRadius = 20
        self.Avatar.layer.borderWidth = 0.5
        self.Avatar.layer.borderColor = UIColor.colorWithHex(hexColor: 0xF1F1F1).cgColor
        
        self.lab_Name.snp.makeConstraints { (make) in
            make.width.equalTo(width - 240)
            make.height.equalTo(18)
            make.left.equalTo(self.Avatar.snp.right).offset(10)
            make.top.equalTo(self.Avatar.snp.top)
        }
        self.lab_Num.snp.makeConstraints { (make) in
            make.width.equalTo(width - 240)
            make.height.equalTo(18)
            make.left.equalTo(self.Avatar.snp.right).offset(10)
            make.top.equalTo(self.lab_Name.snp.bottom).offset(3)
        }
        self.lab_grade.snp.makeConstraints { (make) in
            make.width.equalTo(55)
            make.height.equalTo(25)
            make.right.equalTo(self.snp.right).offset(-10)
            make.centerY.equalTo(self.snp.centerY)
        }
        self.lab_grade.layer.masksToBounds = true
        self.lab_grade.layer.cornerRadius = 4
        
        self.addSubview(self.btn_return)
        self.btn_return.snp.makeConstraints { (make) in
            make.width.equalTo(55)
            make.height.equalTo(25)
            make.right.equalTo(self.lab_grade.snp.left).offset(-10)
            make.centerY.equalTo(self.snp.centerY)
        }
        self.btn_return.layer.masksToBounds = true
        self.btn_return.layer.cornerRadius = 4
        
    }
    //未交作业
    func setUnsubmit(json:homeworkReviewModel){
        self.Avatar.snp.makeConstraints { (make) in
            make.width.height.equalTo(40)
            make.centerY.equalTo(self.snp.centerY)
            make.left.equalTo(self.snp.left).offset(10)
        }
        common.share.setSDImg(str: json.avatorUrl, imgview: self.Avatar)
        self.lab_Name.text = json.stuName
        self.lab_Num.text = json.stuNo
        self.lab_grade.textColor = UIColor.white
        self.lab_grade.backgroundColor = UIColor.colorWithHex(hexColor: 0x8F8F8F)
        self.lab_grade.text = "未交"
        self.btn_return.isHidden = true
    }
    //未批改作业
    func setUnreview(json:homeworkReviewModel){

        common.share.setSDImg(str: json.avatorUrl, imgview: self.Avatar)
        self.lab_Name.text = json.stuName
        self.lab_Num.text = json.stuNo
        self.lab_grade.textColor = UIColor.white
        self.lab_grade.backgroundColor = UIColor.colorWithHex(hexColor: 0x8F8F8F)
        self.btn_return.setTitleColor(UIColor.white, for: .normal)
        self.btn_return.backgroundColor = UIColor.colorWithHex(hexColor: 0x8F8F8F)
        self.lab_grade.text = "未批"
        self.btn_return.addTarget(self, action: #selector(self.ReturnHomework(_:)), for: .touchUpInside)
    }
    //已批改作业
    func setIsreview(json:homeworkReviewModel){

        common.share.setSDImg(str: json.avatorUrl, imgview: self.Avatar)
        self.lab_Name.text = json.stuName
        self.lab_Num.text = json.stuNo
        if json.getScore >= 60 {
            self.lab_grade.textColor = UIColor.white
            self.lab_grade.backgroundColor = UIColor.colorWithHex(hexColor: 0x27BE71)
            self.btn_return.setTitleColor(UIColor.white, for: .normal)
            self.btn_return.backgroundColor = UIColor.colorWithHex(hexColor: 0x27BE71)
            self.lab_grade.text = json.getScore.description
            self.btn_return.isHidden = false
        }else if json.getScore < 0{
            self.lab_grade.textColor = UIColor.white
            self.lab_grade.backgroundColor = UIColor.colorWithHex(hexColor: 0xE07863)
            self.lab_grade.text = "已退回"
            self.btn_return.isHidden = true
        }else{
            self.lab_grade.textColor = UIColor.white
            self.lab_grade.backgroundColor = UIColor.colorWithHex(hexColor: 0xE07863)
            self.btn_return.setTitleColor(UIColor.white, for: .normal)
            self.btn_return.backgroundColor = UIColor.colorWithHex(hexColor: 0xE07863)
            self.lab_grade.text = json.getScore.description
            self.btn_return.isHidden = false
        }
        self.btn_return.addTarget(self, action: #selector(self.ReturnHomework(_:)), for: .touchUpInside)
    }
    //退回
    @objc func ReturnHomework(_ btn:UIButton){
        self.delegate?.returnHomework(btn)
    }
    
    //未交考试
    func setUnsubmitExam(json:examModel){
        self.Avatar.snp.makeConstraints { (make) in
            make.width.height.equalTo(40)
            make.centerY.equalTo(self.snp.centerY)
            make.left.equalTo(self.snp.left).offset(10)
        }
        common.share.setSDImg(str: json.avatorUrl, imgview: self.Avatar)
        self.lab_Name.text = json.stuName
        self.lab_Num.text = json.stuNo
        self.lab_grade.textColor = UIColor.white
        self.lab_grade.backgroundColor = UIColor.colorWithHex(hexColor: 0x8F8F8F)
        self.lab_grade.text = "未交"
        self.btn_return.isHidden = true
    }
    //未批改考试
    func setUnreviewExam(json:examModel){
        
        common.share.setSDImg(str: json.avatorUrl, imgview: self.Avatar)
        self.lab_Name.text = json.stuName
        self.lab_Num.text = json.stuNo
        self.lab_grade.textColor = UIColor.white
        self.lab_grade.backgroundColor = UIColor.colorWithHex(hexColor: 0x8F8F8F)
        self.btn_return.setTitleColor(UIColor.white, for: .normal)
        self.btn_return.backgroundColor = UIColor.colorWithHex(hexColor: 0x8F8F8F)
        self.lab_grade.text = "未批"
        self.btn_return.addTarget(self, action: #selector(self.ReturnHomework(_:)), for: .touchUpInside)
    }
    //已批改考试
    func setIsreviewExam(json:examModel){
        
        common.share.setSDImg(str: json.avatorUrl, imgview: self.Avatar)
        self.lab_Name.text = json.stuName
        self.lab_Num.text = json.stuNo
        if json.getScore >= 60 {
            self.lab_grade.textColor = UIColor.white
            self.lab_grade.backgroundColor = UIColor.colorWithHex(hexColor: 0x27BE71)
            self.btn_return.setTitleColor(UIColor.white, for: .normal)
            self.btn_return.backgroundColor = UIColor.colorWithHex(hexColor: 0x27BE71)
            self.lab_grade.text = json.getScore.description
            self.btn_return.isHidden = false
        }else if json.getScore < 0{
            self.lab_grade.textColor = UIColor.white
            self.lab_grade.backgroundColor = UIColor.colorWithHex(hexColor: 0xE07863)
            self.lab_grade.text = "已退回"
            self.btn_return.isHidden = true
        }else{
            self.lab_grade.textColor = UIColor.white
            self.lab_grade.backgroundColor = UIColor.colorWithHex(hexColor: 0xE07863)
            self.btn_return.setTitleColor(UIColor.white, for: .normal)
            self.btn_return.backgroundColor = UIColor.colorWithHex(hexColor: 0xE07863)
            self.lab_grade.text = json.getScore.description
            self.btn_return.isHidden = false
        }
        self.btn_return.addTarget(self, action: #selector(self.ReturnHomework(_:)), for: .touchUpInside)
    }
    //未登分作业
    func setUnmakeScore(json:homeworkReviewModel){
//        self.Avatar.snp.makeConstraints { (make) in
//            make.width.height.equalTo(40)
//            make.centerY.equalTo(self.snp.centerY)
//            make.left.equalTo(self.snp.left).offset(10)
//        }
        common.share.setSDImg(str: json.avatorUrl, imgview: self.Avatar)
        self.lab_Name.text = json.stuName
        self.lab_Num.text = json.stuNo
        self.lab_grade.textColor = UIColor.white
        self.lab_grade.backgroundColor = UIColor.colorWithHex(hexColor: 0x8F8F8F)
        self.lab_grade.text = "未登分"
        self.btn_return.isHidden = true
    }
    //已登分作业
    func setHasmakeScore(json:homeworkReviewModel){
//        self.Avatar.snp.makeConstraints { (make) in
//            make.width.height.equalTo(40)
//            make.centerY.equalTo(self.snp.centerY)
//            make.left.equalTo(self.snp.left).offset(10)
//        }
        common.share.setSDImg(str: json.avatorUrl, imgview: self.Avatar)
        self.lab_Name.text = json.stuName
        self.lab_Num.text = json.stuNo
        self.btn_return.isHidden = true
        if json.getScore >= 60{
            self.lab_grade.textColor = UIColor.white
            self.lab_grade.backgroundColor = UIColor.colorWithHex(hexColor: 0x27BE71)
            self.lab_grade.text = json.getScore.description
        }else{
            self.lab_grade.textColor = UIColor.white
            self.lab_grade.backgroundColor = UIColor.colorWithHex(hexColor: 0xE07863)
            self.lab_grade.text = json.getScore.description
        }
    }
    //未登分考试
    func setUnmakeScoreExam(json:examModel){
        common.share.setSDImg(str: json.avatorUrl, imgview: self.Avatar)
        self.lab_Name.text = json.stuName
        self.lab_Num.text = json.stuNo
        self.lab_grade.textColor = UIColor.white
        self.lab_grade.backgroundColor = UIColor.colorWithHex(hexColor: 0x8F8F8F)
        self.lab_grade.text = "未登分"
        self.btn_return.isHidden = true
    }
    //已登分考试
    func setHasmakeScoreExam(json:examModel){
        common.share.setSDImg(str: json.avatorUrl, imgview: self.Avatar)
        self.lab_Name.text = json.stuName
        self.lab_Num.text = json.stuNo
        self.btn_return.isHidden = true
        if json.getScore >= 60{
            self.lab_grade.textColor = UIColor.white
            self.lab_grade.backgroundColor = UIColor.colorWithHex(hexColor: 0x27BE71)
            self.lab_grade.text = json.getScore.description
        }else{
            self.lab_grade.textColor = UIColor.white
            self.lab_grade.backgroundColor = UIColor.colorWithHex(hexColor: 0xE07863)
            self.lab_grade.text = json.getScore.description
        }
    }
    
    let width = UIScreen.main.bounds.width
    
    lazy var Avatar : UIImageView = {
        let img = UIImageView()
        img.backgroundColor = UIColor.white
        return img
    }()
    lazy var lab_Name : UILabel = {
        let lab = UILabel()
        lab.backgroundColor = UIColor.white
        lab.font = UIFont.init(name: "HelveticaNeue-Light", size: 15)
        lab.textColor = UIColor.black
        return lab
    }()
    lazy var lab_Num : UILabel = {
        let lab = UILabel()
        lab.backgroundColor = UIColor.white
        lab.font = UIFont.init(name: "HelveticaNeue-Light", size: 12)
        lab.textColor = UIColor.gray
        return lab
    }()
    lazy var lab_grade : UILabel = {
        let lab = UILabel()
        lab.textAlignment = .center
        lab.font = UIFont.init(name: "HelveticaNeue-Light", size: 14)
        return lab
    }()
    lazy var btn_return : UIButton = {
        let btn = UIButton()
        btn.setTitle("退回", for: .normal)
        btn.titleLabel?.font = UIFont.init(name: "HelveticaNeue-Light", size: 14)
        btn.backgroundColor = UIColor.gray
        return btn
    }()
}
