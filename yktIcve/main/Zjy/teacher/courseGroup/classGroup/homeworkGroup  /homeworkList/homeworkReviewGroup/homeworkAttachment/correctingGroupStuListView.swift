//
//  correctingGroupStuListView.swift
//  云课堂2
//
//  Created by 尤增强 on 2018/7/7.
//  Copyright © 2018年 zqyou. All rights reserved.
//

import UIKit
import Alamofire
import SwiftyJSON
class correctingGroupStuListView: UIViewController {
    
    lazy var courseOpenId:String = ""
    lazy var openClassId:String = ""
    lazy var openClassGroupId:String = ""
    lazy var groupTaskGroupId:String = ""
    lazy var hkTimeId:String = ""
    lazy var homeWorkId:String = ""
    lazy var homeworkStuId:String = ""
    lazy var stuId:String = ""
    lazy var list = [correctingGroupScoreModel]()
    @IBOutlet weak var tableView: UITableView!
    override func viewDidLoad() {
        super.viewDidLoad()
        self.getMember()
        self.setTableView()
        // Do any additional setup after loading the view.
        
        //监听键盘弹出通知
        NotificationCenter.default
            .addObserver(self,selector: #selector(keyboardWillShow(_:)),
                         name: NSNotification.Name.UIKeyboardWillShow, object: nil)
        //监听键盘隐藏通知
        NotificationCenter.default
            .addObserver(self,selector: #selector(keyboardWillHide(_:)),
                         name: NSNotification.Name.UIKeyboardWillHide, object: nil)
        
      
        
    }

    override func didReceiveMemoryWarning() {
        super.didReceiveMemoryWarning()
        // Dispose of any resources that can be recreated.
    }
  
    // 键盘显示
    @objc func keyboardWillShow(_ notification: Notification) {
        
        let userInfo = (notification as NSNotification).userInfo!
        //键盘尺寸
        let keyboardSize = (userInfo[UIKeyboardFrameBeginUserInfoKey]
            as! NSValue).cgRectValue
        var contentInsets:UIEdgeInsets
        contentInsets = UIEdgeInsetsMake(0.0, 0.0, (keyboardSize.height + 60), 0.0);
        //tableview的contentview的底部大小
        self.tableView.contentInset = contentInsets;
        self.tableView.scrollIndicatorInsets = contentInsets;
    
        
    }
    
    // 键盘隐藏
    @objc func keyboardWillHide(_ notification: Notification) {
        //还原tableview的contentview大小
        //键盘尺寸
        let userInfo = (notification as NSNotification).userInfo!
        let keyboardSize = (userInfo[UIKeyboardFrameBeginUserInfoKey]
            as! NSValue).cgRectValue
        let contentInsets:UIEdgeInsets = UIEdgeInsetsMake(0.0, 0.0, -(keyboardSize.height + 60), 0.0);
       
        self.tableView.contentInset = contentInsets
        self.tableView.scrollIndicatorInsets = contentInsets
        
    }
    //键盘隐藏
    override func touchesEnded(_ touches: Set<UITouch>, with event: UIEvent?) {
        self.view.endEditing(true)
    }
    
    
    //移除监听
    override func viewDidDisappear(_ animated: Bool) {
        NotificationCenter.default.removeObserver(self)
    }
    /*
    // MARK: - Navigation

    // In a storyboard-based application, you will often want to do a little preparation before navigation
    override func prepare(for segue: UIStoryboardSegue, sender: Any?) {
        // Get the new view controller using segue.destinationViewController.
        // Pass the selected object to the new view controller.
    }
    */

}

extension correctingGroupStuListView:UITableViewDelegate,UITableViewDataSource{


    func setTableView(){
        
      
        self.tableView.dataSource = self
        self.tableView.delegate = self
        self.tableView.register(UINib.init(nibName: "correctingGroupStuCell", bundle: nil), forCellReuseIdentifier: "correctingGroupStuCell")
        self.tableView.tableFooterView = UIView(frame:CGRect.zero)//除去多余的cell
        //
        
        if #available(iOS 9.0, *) {
            self.tableView.cellLayoutMarginsFollowReadableWidth = false
        } else {

        }
    }

    func tableView(_ tableView: UITableView, numberOfRowsInSection section: Int) -> Int {
        return self.list.count
    }

    func tableView(_ tableView: UITableView, cellForRowAt indexPath: IndexPath) -> UITableViewCell {
        let cell = tableView.dequeueReusableCell(withIdentifier: "correctingGroupStuCell", for: indexPath) as! correctingGroupStuCell
        let json = self.list[indexPath.row]
        cell.list = self.list
        cell.hkTimeId = self.hkTimeId
        cell.openClassId = self.openClassId
        cell.openClassGroupId = self.openClassGroupId
        cell.homeWorkId = self.homeWorkId
        cell.groupTaskGroupId = self.groupTaskGroupId
        cell.textSocre.tag = indexPath.row
        cell.setdata(json:json)
        return cell
    }
   
}
extension correctingGroupStuListView{
    //获取小组作业成员
    func getMember() {
        let dict = ["courseOpenId":self.courseOpenId,
                    "openClassId":self.openClassId,
                    "openClassGroupId":self.openClassGroupId,
                    "homeworkId":self.homeWorkId,
                    "hkTimeId":self.hkTimeId]
        XLBallLoading.show(in: self.view)
        Alamofire.request(appAPI.Homework_getClassGroupMember, method: .post, parameters: dict, encoding: URLEncoding.default).responseJSON { response in
            if let value = response.result.value {
                let json = JSON(value)
                if(json["code"] == 1){
                    for i in json["stuList"]{
                        let data = correctingGroupScoreModel.init(json: i.1)
                        self.list.append(data)
                    }
                    self.tableView.reloadData()
                }else{
                    ZKProgressHUD.showMessage(json["msg"].stringValue);
                }
                XLBallLoading.hide(in: self.view)
            }else{
                ZKProgressHUD.showMessage("网络环境异常请稍后再试！");
                XLBallLoading.hide(in: self.view)
            }
        }
    }
}
