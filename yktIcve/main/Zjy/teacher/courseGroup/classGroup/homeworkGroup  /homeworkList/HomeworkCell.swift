//
//  HomeworkCell.swift
//  云课堂2
//  作业
//  Created by 志辉教育 on 2018/6/25.
//  Copyright © 2018年 zqyou. All rights reserved.
//

import UIKit
import SwiftyJSON
class HomeworkCell: UITableViewCell {
    
    lazy var TyoeIconColor = [0xCCFFE6,0xCCCCCC,0xFFEAE5,0x27BE71,0x545454,0xE07863]
    @IBOutlet weak var describe_ht: NSLayoutConstraint!
    @IBOutlet weak var type_top: NSLayoutConstraint!
    let width = UIScreen.main.bounds.width
    @IBOutlet weak var Notpay: UILabel!//未交
    @IBOutlet weak var Nobatch: UILabel!//未批
    @IBOutlet weak var approved: UILabel!//已批
    @IBOutlet weak var bottomview: UILabel!
    @IBOutlet weak var editor: UIButton!
    @IBOutlet weak var attachment: UILabel!  //类型
    @IBOutlet weak var attachment_text: UILabel!
    @IBOutlet var IsMoreBtn: UIButton!
  
    @IBOutlet var describe_text: UILabel!
    @IBOutlet weak var describe: UILabel!
    @IBOutlet weak var start_endtime: UILabel!
    @IBOutlet weak var type: UILabel!
    @IBOutlet weak var isenable: UILabel!
    @IBOutlet weak var tittle: UILabel!
    @IBOutlet weak var bgview: UIView!
    override func awakeFromNib() {
        super.awakeFromNib()
        // Initialization code
        //设置cell卡片样式
        let shadowPath = UIBezierPath(roundedRect: bounds, cornerRadius: 0.6)
        self.bgview.layer.masksToBounds = false
        self.bgview.layer.cornerRadius = 6
        self.bgview.layer.shadowColor = UIColor.white.cgColor
        self.bgview.layer.shadowOffset = CGSize.zero // CGSize(width: shadowOffsetWidth, height: shadowOffsetHeight);
        self.bgview.layer.shadowOpacity = 0.11
        self.bgview.layer.shadowPath = shadowPath.cgPath
        self.bgview.layer.borderColor = UIColor.colorWithHex(hexColor: 0x32bd73).cgColor
        self.bgview.layer.borderWidth = 0.08
        self.backgroundColor = UIColor.colorWithHex(hexColor: 0xfafafa)
        
        self.describe_text.isEnabled = false
        
        let line1 = self.drawline(lab: bottomview)
        bottomview.layer.addSublayer(line1)
        
        let line2 = self.drawline1(lab: bottomview, wid: (width - 20) / 3)
        bottomview.layer.addSublayer(line2)
        
        let line3 = self.drawline1(lab: bottomview, wid: (width - 20) / 3 * 2)
        bottomview.layer.addSublayer(line3)
    }

    override func layoutSubviews() {
        editor.layer.borderColor = UIColor.colorWithHex(hexColor: 0xFF27BE71).cgColor
        editor.layer.borderWidth = 1;
        editor.layer.cornerRadius = 6;
        
        isenable.layer.cornerRadius = 5;
        isenable.layer.masksToBounds = true
    }
    override func setSelected(_ selected: Bool, animated: Bool) {
        super.setSelected(selected, animated: animated)

        // Configure the view for the selected state
    }
    func setjson(json:JSON){
        self.tittle.text = json["title"].stringValue
        switch json["homeworkType"].intValue {
      
        case 1:

            
            
             if json["ztWay"].intValue == 5{
                self.attachment_text.text = "作业类型：在线作业(小组作业)"
             }else if json["ztWay"].intValue == 4{
                self.attachment_text.text = "作业类型：在线作业(智能选题)"
             }else if json["ztWay"].intValue == 1 || json["ztWay"].intValue == 2{
                self.attachment_text.text = "作业类型：在线作业(题库选题)"
             }else{
                self.attachment_text.text = "在线作业"
             }
        case 2:
             self.attachment_text.text = "登分作业"
        case 3:
            self.attachment_text.text = "外部作业"
        case 4:
            if json["ztWay"].intValue == 5{
                self.attachment_text.text = "附件作业(小组作业)"
            }else{
                self.attachment_text.text = "附件作业(个人作业)"
            }
        default:
            self.attachment_text.text = "在线作业"
        }
        self.start_endtime.text = "\(json["startDate"].stringValue)~\(json["endDate"].stringValue)"
        
        if(json["remark"].stringValue != ""){
            //计算字的宽度
            let messtr = "\(json["remark"].stringValue)" as NSString
            let width = messtr.size(withAttributes: [NSAttributedStringKey.font:UIFont.systemFont(ofSize: 13)]).width
            self.describe_text.text = json["remark"].stringValue
            if width > self.width - 235{
                self.IsMoreBtn.isHidden = false
            }else{
                self.IsMoreBtn.isHidden = true
            }
        }else{
            self.describe_text.text = "该作业暂无要求"
            self.IsMoreBtn.isHidden = true
        }
        if json["isSetTime"].intValue == 0 {
                self.isenable.text = "未启用"
                self.isenable.backgroundColor = UIColor.colorWithHex(hexColor: 0x8F8F8F)
                self.isenable.textColor = UIColor.white
        }else{
            if json["isForbid"].intValue == 1{
                self.isenable.text = "已禁止"
                self.isenable.backgroundColor = UIColor.colorWithHex(hexColor: 0xE07863)
                self.isenable.textColor = UIColor.white
            }else{
                self.isenable.text = "已启用"
                self.isenable.backgroundColor = UIColor.colorWithHex(hexColor: 0x27BE71)
                self.isenable.textColor = UIColor.white
            }
        }
        if json["ztWay"].intValue == 5{
            self.approved.attributedText = common.share.changeTextChange(regex:.d, text: "\(json["readStuCount"].intValue)\n已批(组)", color: UIColor.colorWithHex(hexColor: 0x27BE71))
            self.Nobatch.attributedText = common.share.changeTextChange(regex:.d, text: "\(json["unReadStuCount"].intValue)\n未批(组)", color: UIColor.colorWithHex(hexColor: 0xFF5454))
            self.Notpay.attributedText = common.share.changeTextChange(regex:.d, text: "\(json["unSubmitCount"].intValue)\n未交(组)", color: UIColor.colorWithHex(hexColor: 0xE27100))
        }else{
            self.approved.attributedText = common.share.changeTextChange(regex:.d, text: "\(json["readStuCount"].intValue)\n已批(人)", color: UIColor.colorWithHex(hexColor: 0x27BE71))
            self.Nobatch.attributedText = common.share.changeTextChange(regex:.d, text: "\(json["unReadStuCount"].intValue)\n未批(人)", color: UIColor.colorWithHex(hexColor: 0xFF5454))
            self.Notpay.attributedText = common.share.changeTextChange(regex:.d, text: "\(json["unSubmitCount"].intValue)\n未交(人)", color: UIColor.colorWithHex(hexColor: 0xE27100))
        }
    
    }
    
    
    func setexamjson(json:JSON){
        self.IsMoreBtn.isHidden = true
        self.describe_ht.constant = 0.0
        self.type_top.constant = 0.0
        self.describe_text.isHidden = true
        self.attachment.text = "考试类型"
        self.type.text = "考试日期"
        self.tittle.text = json["title"].stringValue
        switch json["examType"].intValue {
        case 1:
            self.attachment_text.text = "在线考试"
        case 2:
            self.attachment_text.text = "登分考试"
        default:
            self.attachment_text.text = "在线作业"
        }
        self.start_endtime.text = "\(json["startDate"].stringValue)~\(json["endDate"].stringValue)"
        

        if json["isSetTime"].intValue == 0{
            self.isenable.text = "未启用"
            self.isenable.backgroundColor = UIColor.colorWithHex(hexColor: 0x8F8F8F)
            self.isenable.textColor = UIColor.white
        }else{
            if json["isForbid"].intValue == 1{
                self.isenable.text = "已禁止"
                self.isenable.backgroundColor = UIColor.colorWithHex(hexColor: 0xE07863)
                self.isenable.textColor = UIColor.white
            }else{
                self.isenable.text = "已启用"
                self.isenable.backgroundColor = UIColor.colorWithHex(hexColor: 0x27BE71)
                self.isenable.textColor = UIColor.white
                
            }
            
        }
        
        self.approved.attributedText = common.share.changeTextChange(regex:.d, text: "\(json["unTakeCount"].intValue)\n未交", color:UIColor.colorWithHex(hexColor: 0x27BE71))
        self.Nobatch.attributedText = common.share.changeTextChange(regex:.d, text: "\(json["unReadStuCount"].intValue)\n未批", color:UIColor.colorWithHex(hexColor: 0xFF5454))
        self.Notpay.attributedText = common.share.changeTextChange(regex:.d, text: "\(json["readStuCount"].intValue)\n已批", color:UIColor.colorWithHex(hexColor: 0xE27100))
    
        
        
    }
    func drawline(lab:UILabel)->CAShapeLayer{
        let shapeLayer:CAShapeLayer = CAShapeLayer()
        shapeLayer.bounds = lab.bounds
        shapeLayer.position = CGPoint(x: lab.frame.width / 2, y: lab.frame.height / 2)
        shapeLayer.fillColor = UIColor.clear.cgColor
        shapeLayer.strokeColor = UIColor.colorWithHex(hexColor: 0x8F8F8F).cgColor
        shapeLayer.lineWidth = 0.3
        shapeLayer.lineJoin = kCALineJoinRound
        shapeLayer.lineDashPhase = 0
        shapeLayer.lineDashPattern = [NSNumber(value: 2), NSNumber(value: 2)]
        let path:CGMutablePath = CGMutablePath()
        path.move(to: CGPoint(x: 0, y: 0))
        path.addLine(to: CGPoint(x: width - 20, y: 0))
        shapeLayer.path = path
        return shapeLayer
    }
    
    func drawline1(lab:UILabel,wid:CGFloat)->CAShapeLayer{
        let shapeLayer:CAShapeLayer = CAShapeLayer()
        shapeLayer.bounds = lab.bounds
        shapeLayer.position = CGPoint(x: lab.frame.width / 2, y: lab.frame.height / 2)
        shapeLayer.fillColor = UIColor.clear.cgColor
        shapeLayer.strokeColor = UIColor.colorWithHex(hexColor: 0x8F8F8F).cgColor
        shapeLayer.lineWidth = 0.3
        shapeLayer.lineJoin = kCALineJoinRound
        shapeLayer.lineDashPhase = 0
        shapeLayer.lineDashPattern = [NSNumber(value: 2), NSNumber(value: 2)]
        let path:CGMutablePath = CGMutablePath()
        path.move(to: CGPoint(x: wid, y: 0))
        path.addLine(to: CGPoint(x: wid, y: 40))
        shapeLayer.path = path
        return shapeLayer
    }
}
