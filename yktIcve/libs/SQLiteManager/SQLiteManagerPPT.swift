//
//  SQLiteManagerPPT.swift
//  云课堂2
//
//  Created by 志辉教育 on 2018/6/7.
//  Copyright © 2018年 zqyou. All rights reserved.
//

import UIKit
import SQLite
struct SQLiteManagerKJrecord{
    
    private var db: Connection!
    private let PPTpage = Table("PPTpage") //表名
    private let id = Expression<String>("id")      //主键（cellid）视屏，PPT文档的cellid
    private let userId = Expression<String>("userId")  //用户ID
    private let location = Expression<Int>("location") //看到多少页,离开时视频观看的位置

    
    init() {
        createdsqlite3()
    }
    
    //创建数据库文件
    mutating func createdsqlite3(filePath: String = "/Documents")  {
        
        let sqlFilePath = NSHomeDirectory() + filePath + "/db.sqlite3"
        do {
            db = try Connection(sqlFilePath)
            try db.run(PPTpage.create { t in
                t.column(id, primaryKey: true)
                t.column(userId)
                t.column(location)
            })
        } catch { print(error) }
        print(sqlFilePath)
    }
    
    //插入数据
    func insertData(_id:String ,_userId: String, _location: Int){
        do {
            let insert = PPTpage.insert(id <- _id, userId <- _userId,location <- _location)
            try db.run(insert)
        } catch {
            print(error)
        }
    }
    
 
    
    func readOneData(_userId:String,docId:String) -> KJloctoionModel {
        let PPTData = KJloctoionModel.init(Id: "", userId: "", location: 0)
        
        for doc in try! db.prepare(PPTpage.filter(userId == _userId && id == docId)) {
            PPTData.id = doc[id]
            PPTData.userId = doc[userId]
            PPTData.location = doc[location]
           
        }
        return PPTData
    }
    
    //更新数据
    func updateData(Id: String , _location: Int ) {
        let currCacheDoc = PPTpage.filter(id == Id)
        do {
            try db.run(currCacheDoc.update(location <- _location))
        } catch {
            print(error)
        }

    }
    
  
    
    //删除数据
    func delData(Id: String) {
        let currCacheDoc = PPTpage.filter(id == Id)
        do {
            try db.run(currCacheDoc.delete())
        } catch {
            print(error)
        }
    }
}



